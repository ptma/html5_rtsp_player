{"version":3,"file":"streamedian.min.js","sources":["../node_modules/bp_logger/logger.js","../src/deps/bp_logger.js","../src/core/util/url.js","../node_modules/bp_event/event.js","../src/deps/bp_event.js","../src/core/iso-bmff/mp4-generator.js","../src/core/presentation/mse.js","../src/core/remuxer/base.js","../src/core/remuxer/aac.js","../src/core/util/exp-golomb.js","../src/core/util/binary.js","../src/core/elementary/NALU.js","../src/core/parsers/h264.js","../src/core/remuxer/h264.js","../src/core/defs.js","../src/core/remuxer/remuxer.js","../node_modules/bp_statemachine/statemachine.js","../src/deps/bp_statemachine.js","../src/core/parsers/sdp.js","../src/client/rtsp/stream.js","../src/core/util/md5.js","../src/client/rtsp/rtp/rtp.js","../src/client/rtsp/rtp/factory.js","../src/client/rtsp/message.js","../src/core/elementary/NALUAsm.js","../src/core/elementary/AACFrame.js","../src/core/elementary/AACAsm.js","../src/client/rtsp/rtp/payload/parser.js","../src/core/base_client.js","../src/core/parsers/aac.js","../src/client/rtsp/session.js","../src/client/rtsp/client.js","../node_modules/jsencrypt/lib/asn1js/asn1.js","../node_modules/jsencrypt/lib/jsbn/prng4.js","../node_modules/jsencrypt/lib/jsbn/rng.js","../node_modules/jsencrypt/lib/jsbn/jsbn.js","../node_modules/jsencrypt/lib/jsbn/jsbn2.js","../node_modules/jsencrypt/lib/jsbn/rsa.js","../node_modules/jsencrypt/lib/jsbn/rsa2.js","../node_modules/jsencrypt/lib/asn1js/base64.js","../node_modules/jsencrypt/lib/asn1js/hex.js","../node_modules/jsencrypt/lib/jsrsasign/asn1-1.0.js","../node_modules/jsencrypt/lib/jsbn/base64.js","../node_modules/jsencrypt/src/jsencrypt.js","../src/deps/jsencrypt.js","../src/core/base_transport.js","../src/core/util/browser.js","../src/transport/websocket.js","../src/player.js","../streamedian.js"],"sourcesContent":["// ERROR=0, WARN=1, LOG=2, DEBUG=3\nexport const LogLevel = {\n    Error: 0,\n    Warn: 1,\n    Log: 2,\n    Debug: 3\n};\n\nlet DEFAULT_LOG_LEVEL = LogLevel.Debug;\n\nexport function setDefaultLogLevel(level) {\n    DEFAULT_LOG_LEVEL = level;\n}\nexport class Logger {\n    constructor(level = DEFAULT_LOG_LEVEL, tag) {\n        this.tag = tag;\n        this.setLevel(level);\n    }\n    \n    setLevel(level) {\n        this.level = level;\n    }\n    \n    static get level_map() { return {\n        [LogLevel.Debug]:'log',\n        [LogLevel.Log]:'log',\n        [LogLevel.Warn]:'warn',\n        [LogLevel.Error]:'error'\n    }};\n\n    _log(lvl, args) {\n        args = Array.prototype.slice.call(args);\n        if (this.tag) {\n            args.unshift(`[${this.tag}]`);\n        }\n        if (this.level>=lvl) console[Logger.level_map[lvl]].apply(console, args);\n    }\n    log(){\n        this._log(LogLevel.Log, arguments)\n    }\n    debug(){\n        this._log(LogLevel.Debug, arguments)\n    }\n    error(){\n        this._log(LogLevel.Error, arguments)\n    }\n    warn(){\n        this._log(LogLevel.Warn, arguments)\n    }\n}\n\nconst taggedLoggers = new Map();\nexport function getTagged(tag) {\n    if (!taggedLoggers.has(tag)) {\n        taggedLoggers.set(tag, new Logger(DEFAULT_LOG_LEVEL, tag));\n    }\n    return taggedLoggers.get(tag);\n}\nexport const Log = new Logger();\n","// export * from 'bp_logger';\r\nexport * from '../../node_modules/bp_logger/logger.js';","export class Url {\r\n    static parse(url) {\r\n        let ret = {};\r\n\r\n        let regex = /^([^:]+):\\/\\/([^\\/]+)(.*)$/;  //protocol, login, urlpath\r\n        let result = regex.exec(url);\r\n\r\n        if (!result) {\r\n            throw new Error(\"bad url\");\r\n        }\r\n\r\n        ret.full = url;\r\n        ret.protocol = result[1];\r\n        ret.urlpath = result[3];\r\n\r\n        let parts = ret.urlpath.split('/');\r\n        ret.basename = parts.pop().split(/\\?|#/)[0];\r\n        ret.basepath = parts.join('/');\r\n\r\n        let loginSplit = result[2].split('@');\r\n        let hostport = loginSplit[0].split(':');\r\n        let userpass = [ null, null ];\r\n        if (loginSplit.length === 2) {\r\n            userpass = loginSplit[0].split(':');\r\n            hostport = loginSplit[1].split(':');\r\n        }\r\n\r\n        ret.user = userpass[0];\r\n        ret.pass = userpass[1];\r\n        ret.host = hostport[0];\r\n        ret.auth = (ret.user && ret.pass) ? `${ret.user}:${ret.pass}` : '';\r\n\r\n        ret.port = (null == hostport[1]) ? Url.protocolDefaultPort(ret.protocol) : hostport[1];\r\n        ret.portDefined = (null != hostport[1]);\r\n        ret.location = `${ret.host}:${ret.port}`;\r\n\r\n        if (ret.protocol == 'unix') {\r\n            ret.socket = ret.port;\r\n            ret.port = undefined;\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    static full(parsed) {\r\n        return `${parsed.protocol}://${parsed.location}/${parsed.urlpath}`;\r\n    }\r\n\r\n    static isAbsolute(url) {\r\n        return /^[^:]+:\\/\\//.test(url);\r\n    }\r\n\r\n    static protocolDefaultPort(protocol) {\r\n        switch (protocol) {\r\n            case 'rtsp': return 554;\r\n            case 'http': return 80;\r\n            case 'https': return 443;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n}","const listener = Symbol(\"event_listener\");\nconst listeners = Symbol(\"event_listeners\");\n\nexport class DestructibleEventListener {\n    constructor(eventListener) {\n        this[listener] = eventListener;\n        this[listeners] = new Map();\n    }\n\n    clear() {\n        if (this[listeners]) {\n            for (let entry of this[listeners]) {\n                for (let fn of entry[1]) {\n                    this[listener].removeEventListener(entry[0], fn);\n                }\n            };\n        }\n        this[listeners].clear();\n    }\n\n    destroy() {\n        this.clear();\n        this[listeners] = null;\n    }\n\n    on(event, selector, fn) {\n        if (fn == undefined) {\n            fn = selector;\n            selector = null;\n        }\n        if (selector) {\n            return this.addEventListener(event, (e) => {\n                if (e.target.matches(selector)) {\n                    fn(e)\n                }\n            });\n        } else {\n            return this.addEventListener(event, fn);\n        }\n    }\n\n    addEventListener(event, fn) {\n        if (!this[listeners].has(event)) {\n            this[listeners].set(event, new Set());\n        }\n        this[listeners].get(event).add(fn);\n        this[listener].addEventListener(event, fn, false);\n        return fn;\n    }\n\n    removeEventListener(event, fn) {\n        this[listener].removeEventListener(event, fn, false);\n        if (this[listeners].has(event)) {\n            //this[listeners].set(event, new Set());\n            let ev = this[listeners].get(event);\n            ev.delete(fn);\n            if (!ev.size) {\n                this[listeners].delete(event);\n            }\n        }\n    }\n\n    dispatchEvent(event) {\n        if (this[listener]) {\n            this[listener].dispatchEvent(event);\n        }\n    }\n}\n\nexport class EventEmitter {\n    constructor(element=null) {\n        this[listener] = new DestructibleEventListener(element || document.createElement('div'));\n    }\n\n    clear() {\n        if (this[listener]) {\n            this[listener].clear();\n        }\n    }\n\n    destroy() {\n        if (this[listener]) {\n            this[listener].destroy();\n            this[listener] = null;\n        }\n    }\n\n    on(event, selector, fn) {\n        if (this[listener]) {\n            return this[listener].on(event, selector, fn);\n        }\n        return null;\n    }\n\n    addEventListener(event, fn) {\n        if (this[listener]) {\n            return this[listener].addEventListener(event, fn, false);\n        }\n        return null;\n    }\n\n    removeEventListener(event, fn) {\n        if (this[listener]) {\n            this[listener].removeEventListener(event, fn, false);\n        }\n    }\n\n    dispatchEvent(event, data) {\n        if (this[listener]) {\n            this[listener].dispatchEvent(new CustomEvent(event, {detail: data}));\n        }\n    }\n}\n\nexport class EventSourceWrapper {\n    constructor(eventSource) {\n        this.eventSource = eventSource;\n        this[listeners] = new Map();\n    }\n\n    on(event, selector, fn) {\n        if (!this[listeners].has(event)) {\n            this[listeners].set(event, new Set());\n        }\n        let listener = this.eventSource.on(event, selector, fn);\n        if (listener) {\n            this[listeners].get(event).add(listener);\n        }\n    }\n\n    off(event, fn){\n        this.eventSource.removeEventListener(event, fn);\n    }\n\n    clear() {\n        this.eventSource.clear();\n        this[listeners].clear();\n    }\n\n    destroy() {\n        this.eventSource.clear();\n        this[listeners] = null;\n        this.eventSource = null;\n    }\n}\n","// export * from 'bp_event';\r\nexport * from '../../node_modules/bp_event/event.js';","/**\r\n * Generate MP4 Box\r\n * got from: https://github.com/dailymotion/hls.js\r\n */\r\n\r\nexport class MP4 {\r\n    static init() {\r\n        MP4.types = {\r\n            avc1: [], // codingname\r\n            avcC: [],\r\n            btrt: [],\r\n            dinf: [],\r\n            dref: [],\r\n            esds: [],\r\n            ftyp: [],\r\n            hdlr: [],\r\n            mdat: [],\r\n            mdhd: [],\r\n            mdia: [],\r\n            mfhd: [],\r\n            minf: [],\r\n            moof: [],\r\n            moov: [],\r\n            mp4a: [],\r\n            mvex: [],\r\n            mvhd: [],\r\n            sdtp: [],\r\n            stbl: [],\r\n            stco: [],\r\n            stsc: [],\r\n            stsd: [],\r\n            stsz: [],\r\n            stts: [],\r\n            tfdt: [],\r\n            tfhd: [],\r\n            traf: [],\r\n            trak: [],\r\n            trun: [],\r\n            trex: [],\r\n            tkhd: [],\r\n            vmhd: [],\r\n            smhd: []\r\n        };\r\n\r\n        var i;\r\n        for (i in MP4.types) {\r\n            if (MP4.types.hasOwnProperty(i)) {\r\n                MP4.types[i] = [\r\n                    i.charCodeAt(0),\r\n                    i.charCodeAt(1),\r\n                    i.charCodeAt(2),\r\n                    i.charCodeAt(3)\r\n                ];\r\n            }\r\n        }\r\n\r\n        var videoHdlr = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00, // pre_defined\r\n            0x76, 0x69, 0x64, 0x65, // handler_type: 'vide'\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x56, 0x69, 0x64, 0x65,\r\n            0x6f, 0x48, 0x61, 0x6e,\r\n            0x64, 0x6c, 0x65, 0x72, 0x00 // name: 'VideoHandler'\r\n        ]);\r\n\r\n        var audioHdlr = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00, // pre_defined\r\n            0x73, 0x6f, 0x75, 0x6e, // handler_type: 'soun'\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x53, 0x6f, 0x75, 0x6e,\r\n            0x64, 0x48, 0x61, 0x6e,\r\n            0x64, 0x6c, 0x65, 0x72, 0x00 // name: 'SoundHandler'\r\n        ]);\r\n\r\n        MP4.HDLR_TYPES = {\r\n            'video': videoHdlr,\r\n            'audio': audioHdlr\r\n        };\r\n\r\n        var dref = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x01, // entry_count\r\n            0x00, 0x00, 0x00, 0x0c, // entry_size\r\n            0x75, 0x72, 0x6c, 0x20, // 'url' type\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x01 // entry_flags\r\n        ]);\r\n\r\n        var stco = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00 // entry_count\r\n        ]);\r\n\r\n        MP4.STTS = MP4.STSC = MP4.STCO = stco;\r\n\r\n        MP4.STSZ = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00, // sample_size\r\n            0x00, 0x00, 0x00, 0x00, // sample_count\r\n        ]);\r\n        MP4.VMHD = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x01, // flags\r\n            0x00, 0x00, // graphicsmode\r\n            0x00, 0x00,\r\n            0x00, 0x00,\r\n            0x00, 0x00 // opcolor\r\n        ]);\r\n        MP4.SMHD = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, // balance\r\n            0x00, 0x00 // reserved\r\n        ]);\r\n\r\n        MP4.STSD = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x01]);// entry_count\r\n\r\n        var majorBrand = new Uint8Array([105,115,111,109]); // isom\r\n        var avc1Brand = new Uint8Array([97,118,99,49]); // avc1\r\n        var minorVersion = new Uint8Array([0, 0, 0, 1]);\r\n\r\n        MP4.FTYP = MP4.box(MP4.types.ftyp, majorBrand, minorVersion, majorBrand, avc1Brand);\r\n        MP4.DINF = MP4.box(MP4.types.dinf, MP4.box(MP4.types.dref, dref));\r\n    }\r\n\r\n    static box(type, ...payload) {\r\n        var size = 8,\r\n            i = payload.length,\r\n            len = i,\r\n            result;\r\n        // calculate the total size we need to allocate\r\n        while (i--) {\r\n            size += payload[i].byteLength;\r\n        }\r\n        result = new Uint8Array(size);\r\n        result[0] = (size >> 24) & 0xff;\r\n        result[1] = (size >> 16) & 0xff;\r\n        result[2] = (size >> 8) & 0xff;\r\n        result[3] = size  & 0xff;\r\n        result.set(type, 4);\r\n        // copy the payload into the result\r\n        for (i = 0, size = 8; i < len; ++i) {\r\n            // copy payload[i] array @ offset size\r\n            result.set(payload[i], size);\r\n            size += payload[i].byteLength;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static hdlr(type) {\r\n        return MP4.box(MP4.types.hdlr, MP4.HDLR_TYPES[type]);\r\n    }\r\n\r\n    static mdat(data) {\r\n        return MP4.box(MP4.types.mdat, data);\r\n    }\r\n\r\n    static mdhd(timescale, duration) {\r\n        return MP4.box(MP4.types.mdhd, new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x02, // creation_time\r\n            0x00, 0x00, 0x00, 0x03, // modification_time\r\n            (timescale >> 24) & 0xFF,\r\n            (timescale >> 16) & 0xFF,\r\n            (timescale >>  8) & 0xFF,\r\n            timescale & 0xFF, // timescale\r\n            (duration >> 24),\r\n            (duration >> 16) & 0xFF,\r\n            (duration >>  8) & 0xFF,\r\n            duration & 0xFF, // duration\r\n            0x55, 0xc4, // 'und' language (undetermined)\r\n            0x00, 0x00\r\n        ]));\r\n    }\r\n\r\n    static mdia(track) {\r\n        return MP4.box(MP4.types.mdia, MP4.mdhd(track.timescale, track.duration), MP4.hdlr(track.type), MP4.minf(track));\r\n    }\r\n\r\n    static mfhd(sequenceNumber) {\r\n        return MP4.box(MP4.types.mfhd, new Uint8Array([\r\n            0x00,\r\n            0x00, 0x00, 0x00, // flags\r\n            (sequenceNumber >> 24),\r\n            (sequenceNumber >> 16) & 0xFF,\r\n            (sequenceNumber >>  8) & 0xFF,\r\n            sequenceNumber & 0xFF, // sequence_number\r\n        ]));\r\n    }\r\n\r\n    static minf(track) {\r\n        if (track.type === 'audio') {\r\n            return MP4.box(MP4.types.minf, MP4.box(MP4.types.smhd, MP4.SMHD), MP4.DINF, MP4.stbl(track));\r\n        } else {\r\n            return MP4.box(MP4.types.minf, MP4.box(MP4.types.vmhd, MP4.VMHD), MP4.DINF, MP4.stbl(track));\r\n        }\r\n    }\r\n\r\n    static moof(sn, baseMediaDecodeTime, track) {\r\n        return MP4.box(MP4.types.moof, MP4.mfhd(sn), MP4.traf(track,baseMediaDecodeTime));\r\n    }\r\n    /**\r\n     * @param tracks... (optional) {array} the tracks associated with this movie\r\n     */\r\n    static moov(tracks, duration, timescale) {\r\n        var\r\n            i = tracks.length,\r\n            boxes = [];\r\n\r\n        while (i--) {\r\n            boxes[i] = MP4.trak(tracks[i]);\r\n        }\r\n\r\n        return MP4.box.apply(null, [MP4.types.moov, MP4.mvhd(timescale, duration)].concat(boxes).concat(MP4.mvex(tracks)));\r\n    }\r\n\r\n    static mvex(tracks) {\r\n        var\r\n            i = tracks.length,\r\n            boxes = [];\r\n\r\n        while (i--) {\r\n            boxes[i] = MP4.trex(tracks[i]);\r\n        }\r\n        return MP4.box.apply(null, [MP4.types.mvex].concat(boxes));\r\n    }\r\n\r\n    static mvhd(timescale,duration) {\r\n        var\r\n            bytes = new Uint8Array([\r\n                0x00, // version 0\r\n                0x00, 0x00, 0x00, // flags\r\n                0x00, 0x00, 0x00, 0x01, // creation_time\r\n                0x00, 0x00, 0x00, 0x02, // modification_time\r\n                (timescale >> 24) & 0xFF,\r\n                (timescale >> 16) & 0xFF,\r\n                (timescale >>  8) & 0xFF,\r\n                timescale & 0xFF, // timescale\r\n                (duration >> 24) & 0xFF,\r\n                (duration >> 16) & 0xFF,\r\n                (duration >>  8) & 0xFF,\r\n                duration & 0xFF, // duration\r\n                0x00, 0x01, 0x00, 0x00, // 1.0 rate\r\n                0x01, 0x00, // 1.0 volume\r\n                0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x01, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x40, 0x00, 0x00, 0x00, // transformation: unity matrix\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00, // pre_defined\r\n                0xff, 0xff, 0xff, 0xff // next_track_ID\r\n            ]);\r\n        return MP4.box(MP4.types.mvhd, bytes);\r\n    }\r\n\r\n    static sdtp(track) {\r\n        var\r\n            samples = track.samples || [],\r\n            bytes = new Uint8Array(4 + samples.length),\r\n            flags,\r\n            i;\r\n        // leave the full box header (4 bytes) all zero\r\n        // write the sample table\r\n        for (i = 0; i < samples.length; i++) {\r\n            flags = samples[i].flags;\r\n            bytes[i + 4] = (flags.dependsOn << 4) |\r\n                (flags.isDependedOn << 2) |\r\n                (flags.hasRedundancy);\r\n        }\r\n\r\n        return MP4.box(MP4.types.sdtp, bytes);\r\n    }\r\n\r\n    static stbl(track) {\r\n        return MP4.box(MP4.types.stbl, MP4.stsd(track), MP4.box(MP4.types.stts, MP4.STTS), MP4.box(MP4.types.stsc, MP4.STSC), MP4.box(MP4.types.stsz, MP4.STSZ), MP4.box(MP4.types.stco, MP4.STCO));\r\n    }\r\n\r\n    static avc1(track) {\r\n        var sps = [], pps = [], i, data, len;\r\n        // assemble the SPSs\r\n\r\n        for (i = 0; i < track.sps.length; i++) {\r\n            data = track.sps[i];\r\n            len = data.byteLength;\r\n            sps.push((len >>> 8) & 0xFF);\r\n            sps.push((len & 0xFF));\r\n            sps = sps.concat(Array.prototype.slice.call(data)); // SPS\r\n        }\r\n\r\n        // assemble the PPSs\r\n        for (i = 0; i < track.pps.length; i++) {\r\n            data = track.pps[i];\r\n            len = data.byteLength;\r\n            pps.push((len >>> 8) & 0xFF);\r\n            pps.push((len & 0xFF));\r\n            pps = pps.concat(Array.prototype.slice.call(data));\r\n        }\r\n\r\n        var avcc = MP4.box(MP4.types.avcC, new Uint8Array([\r\n                0x01,   // version\r\n                sps[3], // profile\r\n                sps[4], // profile compat\r\n                sps[5], // level\r\n                0xfc | 3, // lengthSizeMinusOne, hard-coded to 4 bytes\r\n                0xE0 | track.sps.length // 3bit reserved (111) + numOfSequenceParameterSets\r\n            ].concat(sps).concat([\r\n                track.pps.length // numOfPictureParameterSets\r\n            ]).concat(pps))), // \"PPS\"\r\n            width = track.width,\r\n            height = track.height;\r\n        //console.log('avcc:' + Hex.hexDump(avcc));\r\n        return MP4.box(MP4.types.avc1, new Uint8Array([\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, // data_reference_index\r\n                0x00, 0x00, // pre_defined\r\n                0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00, // pre_defined\r\n                (width >> 8) & 0xFF,\r\n                width & 0xff, // width\r\n                (height >> 8) & 0xFF,\r\n                height & 0xff, // height\r\n                0x00, 0x48, 0x00, 0x00, // horizresolution\r\n                0x00, 0x48, 0x00, 0x00, // vertresolution\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, // frame_count\r\n                0x12,\r\n                0x62, 0x69, 0x6E, 0x65, //binelpro.ru\r\n                0x6C, 0x70, 0x72, 0x6F,\r\n                0x2E, 0x72, 0x75, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, // compressorname\r\n                0x00, 0x18,   // depth = 24\r\n                0x11, 0x11]), // pre_defined = -1\r\n            avcc,\r\n            MP4.box(MP4.types.btrt, new Uint8Array([\r\n                0x00, 0x1c, 0x9c, 0x80, // bufferSizeDB\r\n                0x00, 0x2d, 0xc6, 0xc0, // maxBitrate\r\n                0x00, 0x2d, 0xc6, 0xc0])) // avgBitrate\r\n        );\r\n    }\r\n\r\n    static esds(track) {\r\n        var configlen = track.config.byteLength;\r\n        let data = new Uint8Array(26+configlen+3);\r\n        data.set([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n\r\n            0x03, // descriptor_type\r\n            0x17+configlen, // length\r\n            0x00, 0x01, //es_id\r\n            0x00, // stream_priority\r\n\r\n            0x04, // descriptor_type\r\n            0x0f+configlen, // length\r\n            0x40, //codec : mpeg4_audio\r\n            0x15, // stream_type\r\n            0x00, 0x00, 0x00, // buffer_size\r\n            0x00, 0x00, 0x00, 0x00, // maxBitrate\r\n            0x00, 0x00, 0x00, 0x00, // avgBitrate\r\n\r\n            0x05, // descriptor_type\r\n            configlen\r\n        ]);\r\n        data.set(track.config, 26);\r\n        data.set([0x06, 0x01, 0x02], 26+configlen);\r\n        // return new Uint8Array([\r\n        //     0x00, // version 0\r\n        //     0x00, 0x00, 0x00, // flags\r\n        //\r\n        //     0x03, // descriptor_type\r\n        //     0x17+configlen, // length\r\n        //     0x00, 0x01, //es_id\r\n        //     0x00, // stream_priority\r\n        //\r\n        //     0x04, // descriptor_type\r\n        //     0x0f+configlen, // length\r\n        //     0x40, //codec : mpeg4_audio\r\n        //     0x15, // stream_type\r\n        //     0x00, 0x00, 0x00, // buffer_size\r\n        //     0x00, 0x00, 0x00, 0x00, // maxBitrate\r\n        //     0x00, 0x00, 0x00, 0x00, // avgBitrate\r\n        //\r\n        //     0x05 // descriptor_type\r\n        // ].concat([configlen]).concat(track.config).concat([0x06, 0x01, 0x02])); // GASpecificConfig)); // length + audio config descriptor\r\n        return data;\r\n    }\r\n\r\n    static mp4a(track) {\r\n        var audiosamplerate = track.audiosamplerate;\r\n        return MP4.box(MP4.types.mp4a, new Uint8Array([\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, // data_reference_index\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, track.channelCount, // channelcount\r\n                0x00, 0x10, // sampleSize:16bits\r\n                0x00, 0x00, // pre_defined\r\n                0x00, 0x00, // reserved2\r\n                (audiosamplerate >> 8) & 0xFF,\r\n                audiosamplerate & 0xff, //\r\n                0x00, 0x00]),\r\n            MP4.box(MP4.types.esds, MP4.esds(track)));\r\n    }\r\n\r\n    static stsd(track) {\r\n        if (track.type === 'audio') {\r\n            return MP4.box(MP4.types.stsd, MP4.STSD, MP4.mp4a(track));\r\n        } else {\r\n            return MP4.box(MP4.types.stsd, MP4.STSD, MP4.avc1(track));\r\n        }\r\n    }\r\n\r\n    static tkhd(track) {\r\n        var id = track.id,\r\n            duration = track.duration,\r\n            width = track.width,\r\n            height = track.height,\r\n            volume = track.volume;\r\n        return MP4.box(MP4.types.tkhd, new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x07, // flags\r\n            0x00, 0x00, 0x00, 0x00, // creation_time\r\n            0x00, 0x00, 0x00, 0x00, // modification_time\r\n            (id >> 24) & 0xFF,\r\n            (id >> 16) & 0xFF,\r\n            (id >> 8) & 0xFF,\r\n            id & 0xFF, // track_ID\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            (duration >> 24),\r\n            (duration >> 16) & 0xFF,\r\n            (duration >>  8) & 0xFF,\r\n            duration & 0xFF, // duration\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, // layer\r\n            0x00, 0x00, // alternate_group\r\n            (volume>>0)&0xff, (((volume%1)*10)>>0)&0xff, // track volume // FIXME\r\n            0x00, 0x00, // reserved\r\n            0x00, 0x01, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x01, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x40, 0x00, 0x00, 0x00, // transformation: unity matrix\r\n            (width >> 8) & 0xFF,\r\n            width & 0xFF,\r\n            0x00, 0x00, // width\r\n            (height >> 8) & 0xFF,\r\n            height & 0xFF,\r\n            0x00, 0x00 // height\r\n        ]));\r\n    }\r\n\r\n    static traf(track,baseMediaDecodeTime) {\r\n        var sampleDependencyTable = MP4.sdtp(track),\r\n            id = track.id;\r\n        return MP4.box(MP4.types.traf,\r\n            MP4.box(MP4.types.tfhd, new Uint8Array([\r\n                0x00, // version 0\r\n                0x00, 0x00, 0x00, // flags\r\n                (id >> 24),\r\n                (id >> 16) & 0XFF,\r\n                (id >> 8) & 0XFF,\r\n                (id & 0xFF) // track_ID\r\n            ])),\r\n            MP4.box(MP4.types.tfdt, new Uint8Array([\r\n                0x00, // version 0\r\n                0x00, 0x00, 0x00, // flags\r\n                (baseMediaDecodeTime >>24),\r\n                (baseMediaDecodeTime >> 16) & 0XFF,\r\n                (baseMediaDecodeTime >> 8) & 0XFF,\r\n                (baseMediaDecodeTime & 0xFF) // baseMediaDecodeTime\r\n            ])),\r\n            MP4.trun(track,\r\n                sampleDependencyTable.length +\r\n                16 + // tfhd\r\n                16 + // tfdt\r\n                8 +  // traf header\r\n                16 + // mfhd\r\n                8 +  // moof header\r\n                8),  // mdat header\r\n            sampleDependencyTable);\r\n    }\r\n\r\n    /**\r\n     * Generate a track box.\r\n     * @param track {object} a track definition\r\n     * @return {Uint8Array} the track box\r\n     */\r\n    static trak(track) {\r\n        track.duration = track.duration || 0xffffffff;\r\n        return MP4.box(MP4.types.trak, MP4.tkhd(track), MP4.mdia(track));\r\n    }\r\n\r\n    static trex(track) {\r\n        var id = track.id;\r\n        return MP4.box(MP4.types.trex, new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            (id >> 24),\r\n            (id >> 16) & 0XFF,\r\n            (id >> 8) & 0XFF,\r\n            (id & 0xFF), // track_ID\r\n            0x00, 0x00, 0x00, 0x01, // default_sample_description_index\r\n            0x00, 0x00, 0x00, 0x00, // default_sample_duration\r\n            0x00, 0x00, 0x00, 0x00, // default_sample_size\r\n            0x00, 0x01, 0x00, 0x01 // default_sample_flags\r\n        ]));\r\n    }\r\n\r\n    static trun(track, offset) {\r\n        var samples= track.samples || [],\r\n            len = samples.length,\r\n            arraylen = 12 + (16 * len),\r\n            array = new Uint8Array(arraylen),\r\n            i,sample,duration,size,flags,cts;\r\n        offset += 8 + arraylen;\r\n        array.set([\r\n            0x00, // version 0\r\n            0x00, 0x0f, 0x01, // flags\r\n            (len >>> 24) & 0xFF,\r\n            (len >>> 16) & 0xFF,\r\n            (len >>> 8) & 0xFF,\r\n            len & 0xFF, // sample_count\r\n            (offset >>> 24) & 0xFF,\r\n            (offset >>> 16) & 0xFF,\r\n            (offset >>> 8) & 0xFF,\r\n            offset & 0xFF // data_offset\r\n        ],0);\r\n        for (i = 0; i < len; i++) {\r\n            sample = samples[i];\r\n            duration = sample.duration;\r\n            size = sample.size;\r\n            flags = sample.flags;\r\n            cts = sample.cts;\r\n            array.set([\r\n                (duration >>> 24) & 0xFF,\r\n                (duration >>> 16) & 0xFF,\r\n                (duration >>> 8) & 0xFF,\r\n                duration & 0xFF, // sample_duration\r\n                (size >>> 24) & 0xFF,\r\n                (size >>> 16) & 0xFF,\r\n                (size >>> 8) & 0xFF,\r\n                size & 0xFF, // sample_size\r\n                (flags.isLeading << 2) | flags.dependsOn,\r\n                (flags.isDependedOn << 6) |\r\n                (flags.hasRedundancy << 4) |\r\n                (flags.paddingValue << 1) |\r\n                flags.isNonSync,\r\n                flags.degradPrio & 0xF0 << 8,\r\n                flags.degradPrio & 0x0F, // sample_flags\r\n                (cts >>> 24) & 0xFF,\r\n                (cts >>> 16) & 0xFF,\r\n                (cts >>> 8) & 0xFF,\r\n                cts & 0xFF // sample_composition_time_offset\r\n            ],12+16*i);\r\n        }\r\n        return MP4.box(MP4.types.trun, array);\r\n    }\r\n\r\n    static initSegment(tracks, duration, timescale) {\r\n        if (!MP4.types) {\r\n            MP4.init();\r\n        }\r\n        var movie = MP4.moov(tracks, duration, timescale), result;\r\n        result = new Uint8Array(MP4.FTYP.byteLength + movie.byteLength);\r\n        result.set(MP4.FTYP);\r\n        result.set(movie, MP4.FTYP.byteLength);\r\n        return result;\r\n    }\r\n}\r\n","import {EventEmitter} from '../../deps/bp_event.js';\r\nimport {getTagged} from '../../deps/bp_logger.js';\r\n//import {MP4Inspect} from '../iso-bmff/mp4-inspector.js';\r\n\r\nconst LOG_TAG = \"mse\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class MSEBuffer {\r\n    constructor(parent, codec) {\r\n        this.mediaSource = parent.mediaSource;\r\n        this.players = parent.players;\r\n        this.cleaning = false;\r\n        this.parent = parent;\r\n        this.queue = [];\r\n        this.cleanResolvers = [];\r\n        this.codec = codec;\r\n        this.cleanRanges = [];\r\n\r\n        Log.debug(`Use codec: ${codec}`);\r\n\r\n        this.sourceBuffer = this.mediaSource.addSourceBuffer(codec);\r\n        this.eventSource = new EventEmitter(this.sourceBuffer);\r\n\r\n        this.eventSource.addEventListener('updatestart', (e)=> {\r\n            // this.updating = true;\r\n            // Log.debug('update start');\r\n            if (this.cleaning) {\r\n                Log.debug(`${this.codec} cleaning start`);\r\n            }\r\n        });\r\n\r\n        this.eventSource.addEventListener('update', (e)=> {\r\n            // this.updating = true;\r\n            if (this.cleaning) {\r\n                Log.debug(`${this.codec} cleaning update`);\r\n            }\r\n        });\r\n\r\n        this.eventSource.addEventListener('updateend', (e)=> {\r\n            // Log.debug('update end');\r\n            // this.updating = false;\r\n            if (this.cleaning) {\r\n                Log.debug(`${this.codec} cleaning end`);\r\n\r\n                try {\r\n                    if (this.sourceBuffer.buffered.length && this.players[0].currentTime < this.sourceBuffer.buffered.start(0)) {\r\n                        this.players[0].currentTime = this.sourceBuffer.buffered.start(0);\r\n                    }\r\n                } catch (e) {\r\n                    // TODO: do something?\r\n                }\r\n                while (this.cleanResolvers.length) {\r\n                    let resolver = this.cleanResolvers.shift();\r\n                    resolver();\r\n                }\r\n                this.cleaning = false;\r\n\r\n                if (this.cleanRanges.length) {\r\n                    this.doCleanup();\r\n                    return;\r\n                }\r\n            } else {\r\n                // Log.debug(`buffered: ${this.sourceBuffer.buffered.end(0)}, current ${this.players[0].currentTime}`);\r\n            }\r\n            this.feedNext();\r\n        });\r\n\r\n        this.eventSource.addEventListener('error', (e)=> {\r\n            Log.debug(`Source buffer error: ${this.mediaSource.readyState}`);\r\n            if (this.mediaSource.sourceBuffers.length) {\r\n                this.mediaSource.removeSourceBuffer(this.sourceBuffer);\r\n            }\r\n            this.parent.eventSource.dispatchEvent('error');\r\n        });\r\n\r\n        this.eventSource.addEventListener('abort', (e)=> {\r\n            Log.debug(`Source buffer aborted: ${this.mediaSource.readyState}`);\r\n            if (this.mediaSource.sourceBuffers.length) {\r\n                this.mediaSource.removeSourceBuffer(this.sourceBuffer);\r\n            }\r\n            this.parent.eventSource.dispatchEvent('error');\r\n        });\r\n\r\n        if (!this.sourceBuffer.updating) {\r\n            this.feedNext();\r\n        }\r\n        // TODO: cleanup every hour for live streams\r\n    }\r\n\r\n    destroy() {\r\n        this.eventSource.destroy();\r\n        this.clear();\r\n        this.queue = [];\r\n        this.mediaSource.removeSourceBuffer(this.sourceBuffer);\r\n    }\r\n\r\n    clear() {\r\n        this.queue = [];\r\n        let promises = [];\r\n        for (let i=0; i< this.sourceBuffer.buffered.length; ++i) {\r\n            // TODO: await remove\r\n            this.cleaning = true;\r\n            promises.push(new Promise((resolve, reject)=>{\r\n                this.cleanResolvers.push(resolve);\r\n                if (!this.sourceBuffer.updating) {\r\n                    this.sourceBuffer.remove(this.sourceBuffer.buffered.start(i), this.sourceBuffer.buffered.end(i));\r\n                    resolve();\r\n                } else {\r\n                    this.sourceBuffer.onupdateend = () => {\r\n                        if (this.sourceBuffer) {\r\n                            this.sourceBuffer.remove(this.sourceBuffer.buffered.start(i), this.sourceBuffer.buffered.end(i));\r\n                        }\r\n                        resolve();\r\n                    };\r\n                }\r\n            }));\r\n        }\r\n        return Promise.all(promises);\r\n    }\r\n\r\n    setLive(is_live) {\r\n        this.is_live = is_live;\r\n    }\r\n\r\n    feedNext() {\r\n        // Log.debug(\"feed next \", this.sourceBuffer.updating);\r\n        if (!this.sourceBuffer.updating && !this.cleaning && this.queue.length) {\r\n            this.doAppend(this.queue.shift());\r\n            // TODO: if is live and current position > 1hr => clean all and restart\r\n        }\r\n    }\r\n\r\n    doCleanup() {\r\n        if (!this.cleanRanges.length) {\r\n            this.cleaning = false;\r\n            this.feedNext();\r\n            return;\r\n        }\r\n        let range = this.cleanRanges.shift();\r\n        Log.debug(`${this.codec} remove range [${range[0]} - ${range[1]}). \r\n                    \\nUpdating: ${this.sourceBuffer.updating}\r\n                    `);\r\n        this.cleaning = true;\r\n        this.sourceBuffer.remove(range[0], range[1]);\r\n    }\r\n\r\n    initCleanup() {\r\n        if (this.sourceBuffer.buffered.length && !this.sourceBuffer.updating && !this.cleaning) {\r\n            Log.debug(`${this.codec} cleanup`);\r\n            let removeBound = this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1) - 2;\r\n\r\n            for (let i=0; i< this.sourceBuffer.buffered.length; ++i) {\r\n                let removeStart = this.sourceBuffer.buffered.start(i);\r\n                let removeEnd = this.sourceBuffer.buffered.end(i);\r\n                if ((this.players[0].currentTime <= removeStart) || (removeBound <= removeStart)) continue;\r\n\r\n                if ((removeBound <= removeEnd) && (removeBound >= removeStart)) {\r\n                    Log.debug(`Clear [${removeStart}, ${removeBound}), leave [${removeBound}, ${removeEnd}]`);\r\n                    removeEnd = removeBound;\r\n                    if (removeEnd!=removeStart) {\r\n                        this.cleanRanges.push([removeStart, removeEnd]);\r\n                    }\r\n                    continue; // Do not cleanup buffered range after current position\r\n                }\r\n                this.cleanRanges.push([removeStart, removeEnd]);\r\n            }\r\n\r\n            this.doCleanup();\r\n\r\n            // let bufferStart = this.sourceBuffer.buffered.start(0);\r\n            // let removeEnd = this.sourceBuffer.buffered.start(0) + (this.sourceBuffer.buffered.end(0) - this.sourceBuffer.buffered.start(0))/2;\r\n            // if (this.players[0].currentTime < removeEnd) {\r\n            //     this.players[0].currentTime = removeEnd;\r\n            // }\r\n            // let removeEnd = Math.max(this.players[0].currentTime - 3, this.sourceBuffer.buffered.end(0) - 3);\r\n            //\r\n            // if (removeEnd < bufferStart) {\r\n            //     removeEnd = this.sourceBuffer.buffered.start(0) + (this.sourceBuffer.buffered.end(0) - this.sourceBuffer.buffered.start(0))/2;\r\n            //     if (this.players[0].currentTime < removeEnd) {\r\n            //         this.players[0].currentTime = removeEnd;\r\n            //     }\r\n            // }\r\n\r\n            // if (removeEnd > bufferStart && (removeEnd - bufferStart > 0.5 )) {\r\n            //     // try {\r\n            //         Log.debug(`${this.codec} remove range [${bufferStart} - ${removeEnd}).\r\n            //         \\nBuffered end: ${this.sourceBuffer.buffered.end(0)}\r\n            //         \\nUpdating: ${this.sourceBuffer.updating}\r\n            //         `);\r\n            //         this.cleaning = true;\r\n            //         this.sourceBuffer.remove(bufferStart, removeEnd);\r\n            //     // } catch (e) {\r\n            //     //     // TODO: implement\r\n            //     //     Log.error(e);\r\n            //     // }\r\n            // } else {\r\n            //     this.feedNext();\r\n            // }\r\n        } else {\r\n            this.feedNext();\r\n        }\r\n    }\r\n\r\n    doAppend(data) {\r\n        // console.log(MP4Inspect.mp4toJSON(data));\r\n        let err = this.players[0].error;\r\n        if (err) {\r\n            Log.error(`Error occured: ${MSE.ErrorNotes[err.code]}`);\r\n            try {\r\n                this.players.forEach((video)=>{video.stop();});\r\n                this.mediaSource.endOfStream();\r\n            } catch (e){\r\n\r\n            }\r\n            this.parent.eventSource.dispatchEvent('error');\r\n        } else {\r\n            try {\r\n                this.sourceBuffer.appendBuffer(data);\r\n            } catch (e) {\r\n                if (e.name === 'QuotaExceededError') {\r\n                    Log.debug(`${this.codec} quota fail`);\r\n                    this.queue.unshift(data);\r\n                    this.initCleanup();\r\n                    return;\r\n                }\r\n\r\n                // reconnect on fail\r\n                Log.error(`Error occured while appending buffer. ${e.name}: ${e.message}`);\r\n                this.parent.eventSource.dispatchEvent('error');\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    feed(data) {\r\n        this.queue = this.queue.concat(data);\r\n        // Log.debug(this.sourceBuffer.updating, this.updating, this.queue.length);\r\n        if (this.sourceBuffer && !this.sourceBuffer.updating && !this.cleaning) {\r\n            // Log.debug('enq feed');\r\n            this.feedNext();\r\n        }\r\n    }\r\n}\r\n\r\nexport class MSE {\r\n    // static CODEC_AVC_BASELINE = \"avc1.42E01E\";\r\n    // static CODEC_AVC_MAIN = \"avc1.4D401E\";\r\n    // static CODEC_AVC_HIGH = \"avc1.64001E\";\r\n    // static CODEC_VP8 = \"vp8\";\r\n    // static CODEC_AAC = \"mp4a.40.2\";\r\n    // static CODEC_VORBIS = \"vorbis\";\r\n    // static CODEC_THEORA = \"theora\";\r\n\r\n    static get ErrorNotes() {return  {\r\n        [MediaError.MEDIA_ERR_ABORTED]: 'fetching process aborted by user',\r\n        [MediaError.MEDIA_ERR_NETWORK]: 'error occurred when downloading',\r\n        [MediaError.MEDIA_ERR_DECODE]: 'error occurred when decoding',\r\n        [MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]: 'audio/video not supported'\r\n    }};\r\n\r\n    static isSupported(codecs) {\r\n        return (window.MediaSource && window.MediaSource.isTypeSupported(`video/mp4; codecs=\"${codecs.join(',')}\"`));\r\n    }\r\n\r\n    constructor (players) {\r\n        this.players = players;\r\n        const playing = this.players.map((video, idx) => {\r\n            video.onplaying = function () {\r\n                playing[idx] = true;\r\n            };\r\n            video.onpause = function () {\r\n                playing[idx] = false;\r\n            };\r\n            return !video.paused;\r\n        });\r\n        this.playing = playing;\r\n        this.mediaSource = new MediaSource();\r\n        this.eventSource = new EventEmitter(this.mediaSource);\r\n        this.reset();\r\n    }\r\n\r\n    destroy() {\r\n        this.reset();\r\n        this.eventSource.destroy();\r\n        this.mediaSource = null;\r\n        this.eventSource = null;\r\n    }\r\n\r\n    play() {\r\n        this.players.forEach((video, idx)=>{\r\n            if (video.paused && !this.playing[idx]) {\r\n                Log.debug(`player ${idx}: play`);\r\n                video.play();\r\n            }\r\n        });\r\n    }\r\n\r\n    setLive(is_live) {\r\n        for (let idx in this.buffers) {\r\n            this.buffers[idx].setLive(is_live);\r\n        }\r\n        this.is_live = is_live;\r\n    }\r\n\r\n    resetBuffers() {\r\n        this.players.forEach((video, idx)=>{\r\n            if (!video.paused && this.playing[idx]) {\r\n                video.pause();\r\n                video.currentTime = 0;\r\n            }\r\n        });\r\n\r\n        let promises = [];\r\n        for (let buffer of this.buffers.values()) {\r\n            promises.push(buffer.clear());\r\n        }\r\n        return Promise.all(promises).then(()=>{\r\n            this.mediaSource.endOfStream();\r\n            this.mediaSource.duration = 0;\r\n            this.mediaSource.clearLiveSeekableRange();\r\n            this.play();\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        this.reset();\r\n        this.players.forEach((video)=>{video.src = URL.createObjectURL(this.mediaSource)});\r\n\r\n        return this.setupEvents();\r\n    }\r\n\r\n    setupEvents() {\r\n        this.eventSource.clear();\r\n        this.resolved = false;\r\n        this.mediaReady = new Promise((resolve, reject)=> {\r\n            this._sourceOpen = ()=> {\r\n                Log.debug(`Media source opened: ${this.mediaSource.readyState}`);\r\n                if (!this.resolved) {\r\n                    this.resolved = true;\r\n                    resolve();\r\n                }\r\n            };\r\n            this._sourceEnded = ()=>{\r\n                Log.debug(`Media source ended: ${this.mediaSource.readyState}`);\r\n            };\r\n            this._sourceClose = ()=>{\r\n                Log.debug(`Media source closed: ${this.mediaSource.readyState}`);\r\n                if (this.resolved) {\r\n                    this.eventSource.dispatchEvent('sourceclosed');\r\n                }\r\n            };\r\n            this.eventSource.addEventListener('sourceopen', this._sourceOpen);\r\n            this.eventSource.addEventListener('sourceended', this._sourceEnded);\r\n            this.eventSource.addEventListener('sourceclose', this._sourceClose);\r\n        });\r\n        return this.mediaReady;\r\n    }\r\n\r\n    reset() {\r\n        this.ready = false;\r\n        for (let track in this.buffers) {\r\n            this.buffers[track].destroy();\r\n            delete this.buffers[track];\r\n        }\r\n        if (this.mediaSource.readyState == 'open') {\r\n            this.mediaSource.duration = 0;\r\n            this.mediaSource.endOfStream();\r\n        }\r\n        this.updating = false;\r\n        this.resolved = false;\r\n        this.buffers = {};\r\n        // this.players.forEach((video)=>{video.src = URL.createObjectURL(this.mediaSource)});\r\n        // TODO: remove event listeners for existing media source\r\n        // this.setupEvents();\r\n        // this.clear();\r\n    }\r\n\r\n    setCodec(track, mimeCodec) {\r\n        return this.mediaReady.then(()=>{\r\n            this.buffers[track] = new MSEBuffer(this, mimeCodec);\r\n            this.buffers[track].setLive(this.is_live);\r\n        });\r\n    }\r\n\r\n    feed(track, data) {\r\n        if (this.buffers[track]) {\r\n            this.buffers[track].feed(data);\r\n        }\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\n\r\nconst Log = getTagged('remuxer:base');\r\nlet track_id = 1;\r\nexport class BaseRemuxer {\r\n\r\n    static get MP4_TIMESCALE() { return 90000;}\r\n\r\n    // TODO: move to ts parser\r\n    // static PTSNormalize(value, reference) {\r\n    //\r\n    //     let offset;\r\n    //     if (reference === undefined) {\r\n    //         return value;\r\n    //     }\r\n    //     if (reference < value) {\r\n    //         // - 2^33\r\n    //         offset = -8589934592;\r\n    //     } else {\r\n    //         // + 2^33\r\n    //         offset = 8589934592;\r\n    //     }\r\n    //     /* PTS is 33bit (from 0 to 2^33 -1)\r\n    //      if diff between value and reference is bigger than half of the amplitude (2^32) then it means that\r\n    //      PTS looping occured. fill the gap */\r\n    //     while (Math.abs(value - reference) > 4294967296) {\r\n    //         value += offset;\r\n    //     }\r\n    //     return value;\r\n    // }\r\n\r\n    static getTrackID() {\r\n        return track_id++;\r\n    }\r\n\r\n    constructor(timescale, scaleFactor, params) {\r\n        this.timeOffset = 0;\r\n        this.timescale = timescale;\r\n        this.scaleFactor = scaleFactor;\r\n        this.readyToDecode = false;\r\n        this.samples = [];\r\n        this.seq = 1;\r\n        this.tsAlign = 1;\r\n    }\r\n\r\n    scaled(timestamp) {\r\n        return timestamp / this.scaleFactor;\r\n    }\r\n\r\n    unscaled(timestamp) {\r\n        return timestamp * this.scaleFactor;\r\n    }\r\n\r\n    remux(unit) {\r\n        if (unit) {\r\n            this.samples.push({\r\n                unit: unit,\r\n                pts: unit.pts,\r\n                dts: unit.dts\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    static toMS(timestamp) {\r\n        return timestamp/90;\r\n    }\r\n    \r\n    setConfig(config) {\r\n        \r\n    }\r\n\r\n    insertDscontinuity() {\r\n        this.samples.push(null);\r\n    }\r\n\r\n    init(initPTS, initDTS, shouldInitialize=true) {\r\n        this.initPTS = Math.min(initPTS, this.samples[0].dts /*- this.unscaled(this.timeOffset)*/);\r\n        this.initDTS = Math.min(initDTS, this.samples[0].dts /*- this.unscaled(this.timeOffset)*/);\r\n        Log.debug(`Initial pts=${this.initPTS} dts=${this.initDTS} offset=${this.unscaled(this.timeOffset)}`);\r\n        this.initialized = shouldInitialize;\r\n    }\r\n\r\n    flush() {\r\n        this.seq++;\r\n        this.mp4track.len = 0;\r\n        this.mp4track.samples = [];\r\n    }\r\n\r\n    static dtsSortFunc(a,b) {\r\n        return (a.dts-b.dts);\r\n    }\r\n\r\n    static groupByDts(gop) {\r\n        const groupBy = (xs, key) => {\r\n            return xs.reduce((rv, x) => {\r\n                (rv[x[key]] = rv[x[key]] || []).push(x);\r\n                return rv;\r\n            }, {});\r\n        };\r\n        return groupBy(gop, 'dts');\r\n    }\r\n\r\n    getPayloadBase(sampleFunction, setupSample) {\r\n        if (!this.readyToDecode || !this.initialized || !this.samples.length) return null;\r\n        this.samples.sort(BaseRemuxer.dtsSortFunc);\r\n        return true;\r\n        //\r\n        // let payload = new Uint8Array(this.mp4track.len);\r\n        // let offset = 0;\r\n        // let samples=this.mp4track.samples;\r\n        // let mp4Sample, lastDTS, pts, dts;\r\n        //\r\n        // while (this.samples.length) {\r\n        //     let sample = this.samples.shift();\r\n        //     if (sample === null) {\r\n        //         // discontinuity\r\n        //         this.nextDts = undefined;\r\n        //         break;\r\n        //     }\r\n        //\r\n        //     let unit = sample.unit;\r\n        //\r\n        //     pts = Math.round((sample.pts - this.initDTS)/this.tsAlign)*this.tsAlign;\r\n        //     dts = Math.round((sample.dts - this.initDTS)/this.tsAlign)*this.tsAlign;\r\n        //     // ensure DTS is not bigger than PTS\r\n        //     dts = Math.min(pts, dts);\r\n        //\r\n        //     // sampleFunction(pts, dts);   // TODO:\r\n        //\r\n        //     // mp4Sample = setupSample(unit, pts, dts);    // TODO:\r\n        //\r\n        //     payload.set(unit.getData(), offset);\r\n        //     offset += unit.getSize();\r\n        //\r\n        //     samples.push(mp4Sample);\r\n        //     lastDTS = dts;\r\n        // }\r\n        // if (!samples.length) return null;\r\n        //\r\n        // // samplesPostFunction(samples); // TODO:\r\n        //\r\n        // return new Uint8Array(payload.buffer, 0, this.mp4track.len);\r\n    }\r\n}","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {MSE} from '../presentation/mse.js';\r\nimport {BaseRemuxer} from './base.js';\r\n\r\nconst Log = getTagged(\"remuxer:aac\");\r\n// TODO: asm.js\r\nexport class AACRemuxer extends BaseRemuxer {\r\n\r\n    constructor(timescale, scaleFactor = 1, params={}) {\r\n        super(timescale, scaleFactor);\r\n\r\n        this.codecstring=MSE.CODEC_AAC;\r\n        this.units = [];\r\n        this.initDTS = undefined;\r\n        this.nextAacPts = undefined;\r\n        this.lastPts = 0;\r\n        this.firstDTS = 0;\r\n        this.firstPTS = 0;\r\n        this.duration = params.duration || 1;\r\n        this.initialized = false;\r\n\r\n        this.mp4track={\r\n            id:BaseRemuxer.getTrackID(),\r\n            type: 'audio',\r\n            fragmented:true,\r\n            channelCount:0,\r\n            audiosamplerate: this.timescale,\r\n            duration: 0,\r\n            timescale: this.timescale,\r\n            volume: 1,\r\n            samples: [],\r\n            config: '',\r\n            len: 0\r\n        };\r\n        if (params.config) {\r\n            this.setConfig(params.config);\r\n        }\r\n    }\r\n\r\n    setConfig(config) {\r\n        this.mp4track.channelCount = config.channels;\r\n        this.mp4track.audiosamplerate = config.samplerate;\r\n        if (!this.mp4track.duration) {\r\n            this.mp4track.duration = (this.duration?this.duration:1)*config.samplerate;\r\n        }\r\n        this.mp4track.timescale = config.samplerate;\r\n        this.mp4track.config = config.config;\r\n        this.mp4track.codec = config.codec;\r\n        this.timescale = config.samplerate;\r\n        this.scaleFactor = BaseRemuxer.MP4_TIMESCALE / config.samplerate;\r\n        this.expectedSampleDuration = 1024 * this.scaleFactor;\r\n        this.readyToDecode = true;\r\n    }\r\n\r\n    remux(aac) {\r\n        if (super.remux.call(this, aac)) {\r\n            this.mp4track.len += aac.getSize();\r\n        }\r\n    }\r\n\r\n    getPayload() {\r\n        if (!this.readyToDecode || !this.samples.length) return null;\r\n        this.samples.sort(function(a, b) {\r\n            return (a.dts-b.dts);\r\n        });\r\n\r\n        let payload = new Uint8Array(this.mp4track.len);\r\n        let offset = 0;\r\n        let samples=this.mp4track.samples;\r\n        let mp4Sample, lastDTS, pts, dts;\r\n\r\n        while (this.samples.length) {\r\n            let sample = this.samples.shift();\r\n            if (sample === null) {\r\n                // discontinuity\r\n                this.nextDts = undefined;\r\n                break;\r\n            }\r\n            let unit = sample.unit;\r\n            pts = sample.pts - this.initDTS;\r\n            dts = sample.dts - this.initDTS;\r\n\r\n            if (lastDTS === undefined) {\r\n                if (this.nextDts) {\r\n                    let delta = Math.round(this.scaled(pts - this.nextAacPts));\r\n                    // if fragment are contiguous, or delta less than 600ms, ensure there is no overlap/hole between fragments\r\n                    if (/*contiguous || */Math.abs(delta) < 600) {\r\n                        // log delta\r\n                        if (delta) {\r\n                            if (delta > 0) {\r\n                                Log.log(`${delta} ms hole between AAC samples detected,filling it`);\r\n                                // if we have frame overlap, overlapping for more than half a frame duraion\r\n                            } else if (delta < -12) {\r\n                                // drop overlapping audio frames... browser will deal with it\r\n                                Log.log(`${(-delta)} ms overlapping between AAC samples detected, drop frame`);\r\n                                this.mp4track.len -= unit.getSize();\r\n                                continue;\r\n                            }\r\n                            // set DTS to next DTS\r\n                            pts = dts = this.nextAacPts;\r\n                        }\r\n                    }\r\n                }\r\n                // remember first PTS of our aacSamples, ensure value is positive\r\n                this.firstDTS = Math.max(0, dts);\r\n            }\r\n\r\n            mp4Sample = {\r\n                size: unit.getSize(),\r\n                cts: 0,\r\n                duration:1024,\r\n                flags: {\r\n                    isLeading: 0,\r\n                    isDependedOn: 0,\r\n                    hasRedundancy: 0,\r\n                    degradPrio: 0,\r\n                    dependsOn: 1\r\n                }\r\n            };\r\n\r\n            payload.set(unit.getData(), offset);\r\n            offset += unit.getSize();\r\n            samples.push(mp4Sample);\r\n            lastDTS = dts;\r\n        }\r\n        if (!samples.length) return null;\r\n        this.nextDts =pts+this.expectedSampleDuration;\r\n        return new Uint8Array(payload.buffer, 0, this.mp4track.len);\r\n    }\r\n}\r\n//test.bundle.js:42 [remuxer:h264] skip frame from the past at DTS=18397972271140676 with expected DTS=18397998040950484","/**\r\n * Parser for exponential Golomb codes, a variable-bitwidth number encoding scheme used by h264.\r\n*/\r\n// TODO: asm.js\r\nimport {Log as logger} from '../../deps/bp_logger.js';\r\n\r\nexport class ExpGolomb {\r\n\r\n  constructor(data) {\r\n    this.data = data;\r\n    // the number of bytes left to examine in this.data\r\n    this.bytesAvailable = this.data.byteLength;\r\n    // the current word being examined\r\n    this.word = 0; // :uint\r\n    // the number of bits left to examine in the current word\r\n    this.bitsAvailable = 0; // :uint\r\n  }\r\n\r\n  // ():void\r\n  loadWord() {\r\n    var\r\n      position = this.data.byteLength - this.bytesAvailable,\r\n      workingBytes = new Uint8Array(4),\r\n      availableBytes = Math.min(4, this.bytesAvailable);\r\n    if (availableBytes === 0) {\r\n      throw new Error('no bytes available');\r\n    }\r\n    workingBytes.set(this.data.subarray(position, position + availableBytes));\r\n    this.word = new DataView(workingBytes.buffer, workingBytes.byteOffset, workingBytes.byteLength).getUint32(0);\r\n    // track the amount of this.data that has been processed\r\n    this.bitsAvailable = availableBytes * 8;\r\n    this.bytesAvailable -= availableBytes;\r\n  }\r\n\r\n  // (count:int):void\r\n  skipBits(count) {\r\n    var skipBytes; // :int\r\n    if (this.bitsAvailable > count) {\r\n      this.word <<= count;\r\n      this.bitsAvailable -= count;\r\n    } else {\r\n      count -= this.bitsAvailable;\r\n      skipBytes = count >> 3;\r\n      count -= (skipBytes << 3);\r\n      this.bytesAvailable -= skipBytes;\r\n      this.loadWord();\r\n      this.word <<= count;\r\n      this.bitsAvailable -= count;\r\n    }\r\n  }\r\n\r\n  // (size:int):uint\r\n  readBits(size) {\r\n    var\r\n      bits = Math.min(this.bitsAvailable, size), // :uint\r\n      valu = this.word >>> (32 - bits); // :uint\r\n    if (size > 32) {\r\n      logger.error('Cannot read more than 32 bits at a time');\r\n    }\r\n    this.bitsAvailable -= bits;\r\n    if (this.bitsAvailable > 0) {\r\n      this.word <<= bits;\r\n    } else if (this.bytesAvailable > 0) {\r\n      this.loadWord();\r\n    }\r\n    bits = size - bits;\r\n    if (bits > 0) {\r\n      return valu << bits | this.readBits(bits);\r\n    } else {\r\n      return valu;\r\n    }\r\n  }\r\n\r\n  // ():uint\r\n  skipLZ() {\r\n    var leadingZeroCount; // :uint\r\n    for (leadingZeroCount = 0; leadingZeroCount < this.bitsAvailable; ++leadingZeroCount) {\r\n      if (0 !== (this.word & (0x80000000 >>> leadingZeroCount))) {\r\n        // the first bit of working word is 1\r\n        this.word <<= leadingZeroCount;\r\n        this.bitsAvailable -= leadingZeroCount;\r\n        return leadingZeroCount;\r\n      }\r\n    }\r\n    // we exhausted word and still have not found a 1\r\n    this.loadWord();\r\n    return leadingZeroCount + this.skipLZ();\r\n  }\r\n\r\n  // ():void\r\n  skipUEG() {\r\n    this.skipBits(1 + this.skipLZ());\r\n  }\r\n\r\n  // ():void\r\n  skipEG() {\r\n    this.skipBits(1 + this.skipLZ());\r\n  }\r\n\r\n  // ():uint\r\n  readUEG() {\r\n    var clz = this.skipLZ(); // :uint\r\n    return this.readBits(clz + 1) - 1;\r\n  }\r\n\r\n  // ():int\r\n  readEG() {\r\n    var valu = this.readUEG(); // :int\r\n    if (0x01 & valu) {\r\n      // the number is odd if the low order bit is set\r\n      return (1 + valu) >>> 1; // add 1 to make it even, and divide by 2\r\n    } else {\r\n      return -1 * (valu >>> 1); // divide by two then make it negative\r\n    }\r\n  }\r\n\r\n  // Some convenience functions\r\n  // :Boolean\r\n  readBoolean() {\r\n    return 1 === this.readBits(1);\r\n  }\r\n\r\n  // ():int\r\n  readUByte() {\r\n    return this.readBits(8);\r\n  }\r\n\r\n  // ():int\r\n  readUShort() {\r\n    return this.readBits(16);\r\n  }\r\n    // ():int\r\n  readUInt() {\r\n    return this.readBits(32);\r\n  }  \r\n}\r\n","// TODO: asm.js\r\n\r\nexport function appendByteArray(buffer1, buffer2) {\r\n    let tmp = new Uint8Array((buffer1.byteLength|0) + (buffer2.byteLength|0));\r\n    tmp.set(buffer1, 0);\r\n    tmp.set(buffer2, buffer1.byteLength|0);\r\n    return tmp;\r\n}\r\n\r\nexport function appendByteArrayAsync(buffer1, buffer2) {\r\n    return new Promise((resolve, reject)=>{\r\n        let blob = new Blob([buffer1, buffer2]);\r\n        let reader = new FileReader();\r\n        reader.addEventListener(\"loadend\", function() {\r\n            resolve();\r\n        });\r\n        reader.readAsArrayBuffer(blob);\r\n    });\r\n}\r\nexport function base64ToArrayBuffer(base64) {\r\n    var binary_string =  window.atob(base64);\r\n    var len = binary_string.length;\r\n    var bytes = new Uint8Array( len );\r\n    var i;\r\n    for (i = 0; i < len; i++)        {\r\n        bytes[i] = binary_string.charCodeAt(i);\r\n    }\r\n    return bytes.buffer;\r\n}\r\n\r\nexport function hexToByteArray(hex) {\r\n    let len = hex.length >> 1;\r\n    var bufView = new Uint8Array(len);\r\n    var i;\r\n    for (i = 0; i < len; i++) {\r\n        bufView[i] = parseInt(hex.substr(i<<1,2),16);\r\n    }\r\n    return bufView;\r\n}\r\n\r\nexport function concatenate(resultConstructor, ...arrays) {\r\n    let totalLength = 0;\r\n    for (let arr of arrays) {\r\n        totalLength += arr.length;\r\n    }\r\n    let result = new resultConstructor(totalLength);\r\n    let offset = 0;\r\n    for (let arr of arrays) {\r\n        result.set(arr, offset);\r\n        offset += arr.length;\r\n    }\r\n    return result;\r\n}\r\n\r\nexport function bitSlice(bytearray, start=0, end=bytearray.byteLength*8) {\r\n    let byteLen = Math.ceil((end-start)/8);\r\n    let res = new Uint8Array(byteLen);\r\n    let startByte = start >>> 3;   // /8\r\n    let endByte = (end>>>3) - 1;    // /8\r\n    let bitOffset = start & 0x7;     // %8\r\n    let nBitOffset = 8 - bitOffset;\r\n    let endOffset = 8 - end & 0x7;   // %8\r\n    for (let i=0; i<byteLen; ++i) {\r\n        let tail = 0;\r\n        if (i<endByte) {\r\n            tail = bytearray[startByte+i+1] >> nBitOffset;\r\n            if (i == endByte-1 && endOffset < 8) {\r\n                tail >>= endOffset;\r\n                tail <<= endOffset;\r\n            }\r\n        }\r\n        res[i]=(bytearray[startByte+i]<<bitOffset) | tail;\r\n    }\r\n    return res;\r\n}\r\n\r\nexport class BitArray {\r\n\r\n    constructor(src) {\r\n        this.src    = new DataView(src.buffer, src.byteOffset, src.byteLength);\r\n        this.bitpos = 0;\r\n        this.byte   = this.src.getUint8(0); /* This should really be undefined, uint wont allow it though */\r\n        this.bytepos = 0;\r\n    }\r\n\r\n    readBits(length) {\r\n        if (32 < (length|0) || 0 === (length|0)) {\r\n            /* To big for an uint */\r\n            throw new Error(\"too big\");\r\n        }\r\n\r\n        let result = 0;\r\n        for (let i = length; i > 0; --i) {\r\n\r\n            /* Shift result one left to make room for another bit,\r\n             then add the next bit on the stream. */\r\n            result = ((result|0) << 1) | (((this.byte|0) >> (8 - (++this.bitpos))) & 0x01);\r\n            if ((this.bitpos|0)>=8) {\r\n                this.byte = this.src.getUint8(++this.bytepos);\r\n                this.bitpos &= 0x7;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n    skipBits(length) {\r\n        this.bitpos += (length|0) & 0x7; // %8\r\n        this.bytepos += (length|0) >>> 3;  // *8\r\n        if (this.bitpos > 7) {\r\n            this.bitpos &= 0x7;\r\n            ++this.bytepos;\r\n        }\r\n\r\n        if (!this.finished()) {\r\n            this.byte = this.src.getUint8(this.bytepos);\r\n            return 0;\r\n        } else {\r\n            return this.bytepos-this.src.byteLength-this.src.bitpos;\r\n        }\r\n    }\r\n    \r\n    finished() {\r\n        return this.bytepos >= this.src.byteLength;\r\n    }\r\n}","import {appendByteArray} from '../util/binary.js';\r\n\r\nexport class NALU {\r\n\r\n    static get NDR() {return 1;}\r\n    static get SLICE_PART_A() {return 2;}\r\n    static get SLICE_PART_B() {return 3;}\r\n    static get SLICE_PART_C() {return 4;}\r\n    static get IDR() {return 5;}\r\n    static get SEI() {return 6;}\r\n    static get SPS() {return 7;}\r\n    static get PPS() {return 8;}\r\n    static get DELIMITER() {return 9;}\r\n    static get EOSEQ() {return 10;}\r\n    static get EOSTR() {return 11;}\r\n    static get FILTER() {return 12;}\r\n    static get STAP_A() {return 24;}\r\n    static get STAP_B() {return 25;}\r\n    static get FU_A() {return 28;}\r\n    static get FU_B() {return 29;}\r\n\r\n    static get TYPES() {return {\r\n        [NALU.IDR]: 'IDR',\r\n        [NALU.SEI]: 'SEI',\r\n        [NALU.SPS]: 'SPS',\r\n        [NALU.PPS]: 'PPS',\r\n        [NALU.NDR]: 'NDR'\r\n    }};\r\n\r\n    static type(nalu) {\r\n        if (nalu.ntype in NALU.TYPES) {\r\n            return NALU.TYPES[nalu.ntype];\r\n        } else {\r\n            return 'UNKNOWN';\r\n        }\r\n    }\r\n\r\n    constructor(ntype, nri, data, dts, pts) {\r\n\r\n        this.data = data;\r\n        this.ntype = ntype;\r\n        this.nri = nri;\r\n        this.dts = dts;\r\n        this.pts = pts ? pts : this.dts;\r\n        this.sliceType = null;\r\n    }\r\n\r\n    appendData(idata) {\r\n        this.data = appendByteArray(this.data, idata);\r\n    }\r\n\r\n    toString() {\r\n        return `${NALU.type(this)}(${this.data.byteLength}): NRI: ${this.getNri()}, PTS: ${this.pts}, DTS: ${this.dts}`;\r\n    }\r\n\r\n    getNri() {\r\n        return this.nri >> 5;\r\n    }\r\n\r\n    type() {\r\n        return this.ntype;\r\n    }\r\n\r\n    isKeyframe() {\r\n        return this.ntype === NALU.IDR || this.sliceType === 7;\r\n    }\r\n\r\n    getSize() {\r\n        return 4 + 1 + this.data.byteLength;\r\n    }\r\n\r\n    getData() {\r\n        let header = new Uint8Array(5 + this.data.byteLength);\r\n        let view = new DataView(header.buffer);\r\n        view.setUint32(0, this.data.byteLength + 1);\r\n        view.setUint8(4, (0x0 & 0x80) | (this.nri & 0x60) | (this.ntype & 0x1F));\r\n        header.set(this.data, 5);\r\n        return header;\r\n    }\r\n}\r\n","import {ExpGolomb} from '../util/exp-golomb.js';\r\nimport {NALU} from '../elementary/NALU.js';\r\n\r\nexport class H264Parser {\r\n\r\n    constructor(remuxer) {\r\n        this.remuxer = remuxer;\r\n        this.track = remuxer.mp4track;\r\n        this.firstFound = false;\r\n    }\r\n\r\n    msToScaled(timestamp) {\r\n        return (timestamp - this.remuxer.timeOffset) * this.remuxer.scaleFactor;\r\n    }\r\n\r\n    parseSPS(sps) {\r\n        var config = H264Parser.readSPS(new Uint8Array(sps));\r\n\r\n        this.track.width = config.width;\r\n        this.track.height = config.height;\r\n        this.track.sps = [new Uint8Array(sps)];\r\n        // this.track.timescale = this.remuxer.timescale;\r\n        // this.track.duration = this.remuxer.timescale; // TODO: extract duration for non-live client\r\n        this.track.codec = 'avc1.';\r\n\r\n        let codecarray = new DataView(sps.buffer, sps.byteOffset+1, 4);\r\n        for (let i = 0; i < 3; ++i) {\r\n            var h = codecarray.getUint8(i).toString(16);\r\n            if (h.length < 2) {\r\n                h = '0' + h;\r\n            }\r\n            this.track.codec  += h;\r\n        }\r\n    }\r\n\r\n    parsePPS(pps) {\r\n        this.track.pps = [new Uint8Array(pps)];\r\n    }\r\n\r\n    parseNAL(unit) {\r\n        if (!unit) return false;\r\n        \r\n        let push = null;\r\n        // console.log(unit.toString());\r\n        switch (unit.type()) {\r\n            case NALU.NDR:\r\n            case NALU.IDR:\r\n                unit.sliceType = H264Parser.parceSliceHeader(unit.data);\r\n                if (unit.isKeyframe() && !this.firstFound)  {\r\n                    this.firstFound = true;\r\n                }\r\n                if (this.firstFound) {\r\n                    push = true;\r\n                } else {\r\n                    push = false;\r\n                }\r\n                break;\r\n            case NALU.PPS:\r\n                push = false;\r\n                if (!this.track.pps) {\r\n                    this.parsePPS(unit.getData().subarray(4));\r\n                    if (!this.remuxer.readyToDecode && this.track.pps && this.track.sps) {\r\n                        this.remuxer.readyToDecode = true;\r\n                    }\r\n                }\r\n                break;\r\n            case NALU.SPS:\r\n                push = false;\r\n                if(!this.track.sps) {\r\n                    this.parseSPS(unit.getData().subarray(4));\r\n                    if (!this.remuxer.readyToDecode && this.track.pps && this.track.sps) {\r\n                        this.remuxer.readyToDecode = true;\r\n                    }\r\n                }\r\n                break;\r\n            case NALU.SEI:\r\n                push = false;\r\n                let data = new DataView(unit.data.buffer, unit.data.byteOffset, unit.data.byteLength);\r\n                let byte_idx = 0;\r\n                let pay_type = data.getUint8(byte_idx);\r\n                ++byte_idx;\r\n                let pay_size = 0;\r\n                let sz = data.getUint8(byte_idx);\r\n                ++byte_idx;\r\n                while (sz === 255) {\r\n                    pay_size+=sz;\r\n                    sz = data.getUint8(byte_idx);\r\n                    ++byte_idx;\r\n                }\r\n                pay_size+=sz;\r\n\r\n                let uuid = unit.data.subarray(byte_idx, byte_idx+16);\r\n                byte_idx+=16;\r\n                console.log(`PT: ${pay_type}, PS: ${pay_size}, UUID: ${Array.from(uuid).map(function(i) {\r\n                    return ('0' + i.toString(16)).slice(-2);\r\n                }).join('')}`);\r\n                // debugger;\r\n                break;\r\n            case NALU.EOSEQ:\r\n            case NALU.EOSTR:\r\n                push = false;\r\n            default:\r\n        }\r\n        if (push === null && unit.getNri() > 0 ) {\r\n            push=true;\r\n        }\r\n        return push;\r\n    }\r\n\r\n    static parceSliceHeader(data) {\r\n        let decoder = new ExpGolomb(data);\r\n        let first_mb = decoder.readUEG();\r\n        let slice_type = decoder.readUEG();\r\n        let ppsid = decoder.readUEG();\r\n        let frame_num = decoder.readUByte();\r\n        // console.log(`first_mb: ${first_mb}, slice_type: ${slice_type}, ppsid: ${ppsid}, frame_num: ${frame_num}`);\r\n        return slice_type;\r\n    }\r\n\r\n    /**\r\n     * Advance the ExpGolomb decoder past a scaling list. The scaling\r\n     * list is optionally transmitted as part of a sequence parameter\r\n     * set and is not relevant to transmuxing.\r\n     * @param decoder {ExpGolomb} exp golomb decoder\r\n     * @param count {number} the number of entries in this scaling list\r\n     * @see Recommendation ITU-T H.264, Section 7.3.2.1.1.1\r\n     */\r\n    static skipScalingList(decoder, count) {\r\n        let lastScale = 8,\r\n            nextScale = 8,\r\n            deltaScale;\r\n        for (let j = 0; j < count; j++) {\r\n            if (nextScale !== 0) {\r\n                deltaScale = decoder.readEG();\r\n                nextScale = (lastScale + deltaScale + 256) % 256;\r\n            }\r\n            lastScale = (nextScale === 0) ? lastScale : nextScale;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Read a sequence parameter set and return some interesting video\r\n     * properties. A sequence parameter set is the H264 metadata that\r\n     * describes the properties of upcoming video frames.\r\n     * @param data {Uint8Array} the bytes of a sequence parameter set\r\n     * @return {object} an object with configuration parsed from the\r\n     * sequence parameter set, including the dimensions of the\r\n     * associated video frames.\r\n     */\r\n    static readSPS(data) {\r\n        let decoder = new ExpGolomb(data);\r\n        let frameCropLeftOffset = 0,\r\n            frameCropRightOffset = 0,\r\n            frameCropTopOffset = 0,\r\n            frameCropBottomOffset = 0,\r\n            sarScale = 1,\r\n            profileIdc,profileCompat,levelIdc,\r\n            numRefFramesInPicOrderCntCycle, picWidthInMbsMinus1,\r\n            picHeightInMapUnitsMinus1,\r\n            frameMbsOnlyFlag,\r\n            scalingListCount;\r\n        decoder.readUByte();\r\n        profileIdc = decoder.readUByte(); // profile_idc\r\n        profileCompat = decoder.readBits(5); // constraint_set[0-4]_flag, u(5)\r\n        decoder.skipBits(3); // reserved_zero_3bits u(3),\r\n        levelIdc = decoder.readUByte(); //level_idc u(8)\r\n        decoder.skipUEG(); // seq_parameter_set_id\r\n        // some profiles have more optional data we don't need\r\n        if (profileIdc === 100 ||\r\n            profileIdc === 110 ||\r\n            profileIdc === 122 ||\r\n            profileIdc === 244 ||\r\n            profileIdc === 44  ||\r\n            profileIdc === 83  ||\r\n            profileIdc === 86  ||\r\n            profileIdc === 118 ||\r\n            profileIdc === 128) {\r\n            var chromaFormatIdc = decoder.readUEG();\r\n            if (chromaFormatIdc === 3) {\r\n                decoder.skipBits(1); // separate_colour_plane_flag\r\n            }\r\n            decoder.skipUEG(); // bit_depth_luma_minus8\r\n            decoder.skipUEG(); // bit_depth_chroma_minus8\r\n            decoder.skipBits(1); // qpprime_y_zero_transform_bypass_flag\r\n            if (decoder.readBoolean()) { // seq_scaling_matrix_present_flag\r\n                scalingListCount = (chromaFormatIdc !== 3) ? 8 : 12;\r\n                for (let i = 0; i < scalingListCount; ++i) {\r\n                    if (decoder.readBoolean()) { // seq_scaling_list_present_flag[ i ]\r\n                        if (i < 6) {\r\n                            H264Parser.skipScalingList(decoder, 16);\r\n                        } else {\r\n                            H264Parser.skipScalingList(decoder, 64);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        decoder.skipUEG(); // log2_max_frame_num_minus4\r\n        var picOrderCntType = decoder.readUEG();\r\n        if (picOrderCntType === 0) {\r\n            decoder.readUEG(); //log2_max_pic_order_cnt_lsb_minus4\r\n        } else if (picOrderCntType === 1) {\r\n            decoder.skipBits(1); // delta_pic_order_always_zero_flag\r\n            decoder.skipEG(); // offset_for_non_ref_pic\r\n            decoder.skipEG(); // offset_for_top_to_bottom_field\r\n            numRefFramesInPicOrderCntCycle = decoder.readUEG();\r\n            for(let i = 0; i < numRefFramesInPicOrderCntCycle; ++i) {\r\n                decoder.skipEG(); // offset_for_ref_frame[ i ]\r\n            }\r\n        }\r\n        decoder.skipUEG(); // max_num_ref_frames\r\n        decoder.skipBits(1); // gaps_in_frame_num_value_allowed_flag\r\n        picWidthInMbsMinus1 = decoder.readUEG();\r\n        picHeightInMapUnitsMinus1 = decoder.readUEG();\r\n        frameMbsOnlyFlag = decoder.readBits(1);\r\n        if (frameMbsOnlyFlag === 0) {\r\n            decoder.skipBits(1); // mb_adaptive_frame_field_flag\r\n        }\r\n        decoder.skipBits(1); // direct_8x8_inference_flag\r\n        if (decoder.readBoolean()) { // frame_cropping_flag\r\n            frameCropLeftOffset = decoder.readUEG();\r\n            frameCropRightOffset = decoder.readUEG();\r\n            frameCropTopOffset = decoder.readUEG();\r\n            frameCropBottomOffset = decoder.readUEG();\r\n        }\r\n        if (decoder.readBoolean()) {\r\n            // vui_parameters_present_flag\r\n            if (decoder.readBoolean()) {\r\n                // aspect_ratio_info_present_flag\r\n                let sarRatio;\r\n                const aspectRatioIdc = decoder.readUByte();\r\n                switch (aspectRatioIdc) {\r\n                    case 1: sarRatio = [1,1]; break;\r\n                    case 2: sarRatio = [12,11]; break;\r\n                    case 3: sarRatio = [10,11]; break;\r\n                    case 4: sarRatio = [16,11]; break;\r\n                    case 5: sarRatio = [40,33]; break;\r\n                    case 6: sarRatio = [24,11]; break;\r\n                    case 7: sarRatio = [20,11]; break;\r\n                    case 8: sarRatio = [32,11]; break;\r\n                    case 9: sarRatio = [80,33]; break;\r\n                    case 10: sarRatio = [18,11]; break;\r\n                    case 11: sarRatio = [15,11]; break;\r\n                    case 12: sarRatio = [64,33]; break;\r\n                    case 13: sarRatio = [160,99]; break;\r\n                    case 14: sarRatio = [4,3]; break;\r\n                    case 15: sarRatio = [3,2]; break;\r\n                    case 16: sarRatio = [2,1]; break;\r\n                    case 255: {\r\n                        sarRatio = [decoder.readUByte() << 8 | decoder.readUByte(), decoder.readUByte() << 8 | decoder.readUByte()];\r\n                        break;\r\n                    }\r\n                }\r\n                if (sarRatio) {\r\n                    sarScale = sarRatio[0] / sarRatio[1];\r\n                }\r\n            }\r\n            if (decoder.readBoolean()) {decoder.skipBits(1);}\r\n\r\n            if (decoder.readBoolean()) {\r\n                decoder.skipBits(4);\r\n                if (decoder.readBoolean()) {\r\n                    decoder.skipBits(24);\r\n                }\r\n            }\r\n            if (decoder.readBoolean()) {\r\n                decoder.skipUEG();\r\n                decoder.skipUEG();\r\n            }\r\n            if (decoder.readBoolean()) {\r\n                let unitsInTick = decoder.readUInt();\r\n                let timeScale = decoder.readUInt();\r\n                let fixedFrameRate = decoder.readBoolean();\r\n                let frameDuration = timeScale/(2*unitsInTick);\r\n                console.log(`timescale: ${timeScale}; unitsInTick: ${unitsInTick}; fixedFramerate: ${fixedFrameRate}; avgFrameDuration: ${frameDuration}`);\r\n            }\r\n        }\r\n        return {\r\n            width: Math.ceil((((picWidthInMbsMinus1 + 1) * 16) - frameCropLeftOffset * 2 - frameCropRightOffset * 2) * sarScale),\r\n            height: ((2 - frameMbsOnlyFlag) * (picHeightInMapUnitsMinus1 + 1) * 16) - ((frameMbsOnlyFlag? 2 : 4) * (frameCropTopOffset + frameCropBottomOffset))\r\n        };\r\n    }\r\n\r\n    static readSliceType(decoder) {\r\n        // skip NALu type\r\n        decoder.readUByte();\r\n        // discard first_mb_in_slice\r\n        decoder.readUEG();\r\n        // return slice_type\r\n        return decoder.readUEG();\r\n    }\r\n}","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {H264Parser} from '../parsers/h264.js';\r\nimport {BaseRemuxer} from './base.js';\r\n\r\nconst Log = getTagged(\"remuxer:h264\"); \r\n// TODO: asm.js\r\nexport class H264Remuxer extends BaseRemuxer {\r\n\r\n    constructor(timescale, scaleFactor=1, params={}) {\r\n        super(timescale, scaleFactor);\r\n\r\n        this.nextDts = undefined;\r\n        this.readyToDecode = false;\r\n        this.initialized = false;\r\n\r\n        this.firstDTS=0;\r\n        this.firstPTS=0;\r\n        this.lastDTS=undefined;\r\n        this.lastSampleDuration = 0;\r\n        this.lastDurations = [];\r\n        // this.timescale = 90000;\r\n        this.tsAlign = Math.round(this.timescale/60);\r\n\r\n        this.mp4track={\r\n            id:BaseRemuxer.getTrackID(),\r\n            type: 'video',\r\n            len:0,\r\n            fragmented:true,\r\n            sps:'',\r\n            pps:'',\r\n            width:0,\r\n            height:0,\r\n            timescale: timescale,\r\n            duration: timescale,\r\n            samples: []\r\n        };\r\n        this.samples = [];\r\n        this.lastGopDTS = -99999999999999;\r\n        this.gop=[];\r\n        this.firstUnit = true;\r\n\r\n        this.h264 = new H264Parser(this);\r\n\r\n        if (params.sps) {\r\n            let arr = new Uint8Array(params.sps);\r\n            if ((arr[0] & 0x1f) === 7) {\r\n                this.setSPS(arr);\r\n            } else {\r\n                Log.warn(\"bad SPS in SDP\")\r\n            }\r\n        }\r\n        if (params.pps) {\r\n            let arr = new Uint8Array(params.pps);\r\n            if ((arr[0] & 0x1f) === 8) {\r\n                this.setPPS(arr);\r\n            } else {\r\n                Log.warn(\"bad PPS in SDP\")\r\n            }\r\n        }\r\n\r\n        if (this.mp4track.pps && this.mp4track.sps) {\r\n            this.readyToDecode = true;\r\n        }\r\n    }\r\n\r\n    _scaled(timestamp) {\r\n        return timestamp >>> this.scaleFactor;\r\n    }\r\n\r\n    _unscaled(timestamp) {\r\n        return timestamp << this.scaleFactor;\r\n    }\r\n\r\n    setSPS(sps) {\r\n        this.h264.parseSPS(sps);\r\n    }\r\n\r\n    setPPS(pps) {\r\n        this.h264.parsePPS(pps);\r\n    }\r\n\r\n    remux(nalu) {\r\n        if (this.lastGopDTS < nalu.dts) {\r\n            this.gop.sort(BaseRemuxer.dtsSortFunc);\r\n\r\n            if (this.gop.length > 1) {\r\n                // Aggregate multi-slices which belong to one frame\r\n                const groupedGop = BaseRemuxer.groupByDts(this.gop);\r\n                this.gop = Object.values(groupedGop).map(group => {\r\n                    return group.reduce((preUnit, curUnit) => {\r\n                        const naluData = curUnit.getData();\r\n                        naluData.set(new Uint8Array([0x0, 0x0, 0x0, 0x1]));\r\n                        preUnit.appendData(naluData);\r\n                        return preUnit;\r\n                    });\r\n                });\r\n            }\r\n\r\n            for (let unit of this.gop) {\r\n                // if (this.firstUnit) {\r\n                //     unit.ntype = 5;//NALU.IDR;\r\n                //     this.firstUnit = false;\r\n                // }\r\n                if (super.remux.call(this, unit)) {\r\n                    this.mp4track.len += unit.getSize();\r\n                }\r\n            }\r\n            this.gop = [];\r\n            this.lastGopDTS = nalu.dts\r\n        }\r\n        if (this.h264.parseNAL(nalu)) {\r\n            this.gop.push(nalu);\r\n        }\r\n    }\r\n\r\n    getPayload() {\r\n        if (!this.getPayloadBase()) {\r\n            return null;\r\n        }\r\n\r\n        let payload = new Uint8Array(this.mp4track.len);\r\n        let offset = 0;\r\n        let samples=this.mp4track.samples;\r\n        let mp4Sample, lastDTS, pts, dts;\r\n\r\n\r\n        // Log.debug(this.samples.map((e)=>{\r\n        //     return Math.round((e.dts - this.initDTS));\r\n        // }));\r\n\r\n        // let minDuration = Number.MAX_SAFE_INTEGER;\r\n        while (this.samples.length) {\r\n            let sample = this.samples.shift();\r\n            if (sample === null) {\r\n                // discontinuity\r\n                this.nextDts = undefined;\r\n                break;\r\n            }\r\n\r\n            let unit = sample.unit;\r\n            \r\n            pts = sample.pts- this.initDTS; // /*Math.round(*/(sample.pts - this.initDTS)/*/this.tsAlign)*this.tsAlign*/;\r\n            dts = sample.dts - this.initDTS; ///*Math.round(*/(sample.dts - this.initDTS)/*/this.tsAlign)*this.tsAlign*/;\r\n            // ensure DTS is not bigger than PTS\r\n            dts = Math.min(pts,dts);\r\n            // if not first AVC sample of video track, normalize PTS/DTS with previous sample value\r\n            // and ensure that sample duration is positive\r\n            if (lastDTS !== undefined) {\r\n                let sampleDuration = this.scaled(dts - lastDTS);\r\n                // Log.debug(`Sample duration: ${sampleDuration}`);\r\n                if (sampleDuration < 0) {\r\n                    Log.log(`invalid AVC sample duration at PTS/DTS: ${pts}/${dts}|lastDTS: ${lastDTS}:${sampleDuration}`);\r\n                    this.mp4track.len -= unit.getSize();\r\n                    continue;\r\n                }\r\n                // minDuration = Math.min(sampleDuration, minDuration);\r\n                this.lastDurations.push(sampleDuration);\r\n                if (this.lastDurations.length > 100) {\r\n                    this.lastDurations.shift();\r\n                }\r\n                mp4Sample.duration = sampleDuration;\r\n            } else {\r\n                if (this.nextDts) {\r\n                    let delta = dts - this.nextDts;\r\n                    // if fragment are contiguous, or delta less than 600ms, ensure there is no overlap/hole between fragments\r\n                    if (/*contiguous ||*/ Math.abs(Math.round(BaseRemuxer.toMS(delta))) < 600) {\r\n\r\n                        if (delta) {\r\n                            // set DTS to next DTS\r\n                            // Log.debug(`Video/PTS/DTS adjusted: ${pts}->${Math.max(pts - delta, this.nextDts)}/${dts}->${this.nextDts},delta:${delta}`);\r\n                            dts = this.nextDts;\r\n                            // offset PTS as well, ensure that PTS is smaller or equal than new DTS\r\n                            pts = Math.max(pts - delta, dts);\r\n                        }\r\n                    } else {\r\n                        if (delta < 0) {\r\n                            Log.log(`skip frame from the past at DTS=${dts} with expected DTS=${this.nextDts}`);\r\n                            this.mp4track.len -= unit.getSize();\r\n                            continue;\r\n                        }\r\n                    }\r\n                }\r\n                // remember first DTS of our avcSamples, ensure value is positive\r\n                this.firstDTS = Math.max(0, dts);\r\n            }\r\n\r\n            mp4Sample = {\r\n                size: unit.getSize(),\r\n                duration: 0,\r\n                cts: this.scaled(pts - dts),\r\n                flags: {\r\n                    isLeading: 0,\r\n                    isDependedOn: 0,\r\n                    hasRedundancy: 0,\r\n                    degradPrio: 0\r\n                }\r\n            };\r\n            let flags = mp4Sample.flags;\r\n            if (sample.unit.isKeyframe() === true) {\r\n                // the current sample is a key frame\r\n                flags.dependsOn = 2;\r\n                flags.isNonSync = 0;\r\n            } else {\r\n                flags.dependsOn = 1;\r\n                flags.isNonSync = 1;\r\n            }\r\n\r\n            payload.set(unit.getData(), offset);\r\n            offset += unit.getSize();\r\n\r\n            samples.push(mp4Sample);\r\n            lastDTS = dts;\r\n        }\r\n\r\n        if (!samples.length) return null;\r\n\r\n        let avgDuration = this.lastDurations.reduce(function(a, b) { return (a|0) + (b|0); }, 0) / (this.lastDurations.length||1)|0;\r\n        if (samples.length >= 2) {\r\n            this.lastSampleDuration = avgDuration;\r\n            mp4Sample.duration = avgDuration;\r\n        } else {\r\n            mp4Sample.duration = this.lastSampleDuration;\r\n        }\r\n\r\n        if(samples.length && (!this.nextDts || navigator.userAgent.toLowerCase().indexOf('chrome') > -1)) {\r\n            let flags = samples[0].flags;\r\n            // chrome workaround, mark first sample as being a Random Access Point to avoid sourcebuffer append issue\r\n            // https://code.google.com/p/chromium/issues/detail?id=229412\r\n            flags.dependsOn = 2;\r\n            flags.isNonSync = 0;\r\n        }\r\n\r\n        // next AVC sample DTS should be equal to last sample DTS + last sample duration\r\n        this.nextDts = dts + this.unscaled(this.lastSampleDuration);\r\n        // Log.debug(`next dts: ${this.nextDts}, last duration: ${this.lastSampleDuration}, last dts: ${dts}`);\r\n\r\n        return new Uint8Array(payload.buffer, 0, this.mp4track.len);\r\n    }\r\n}\r\n","export class StreamType {\r\n    static get VIDEO() {return 1;}\r\n    static get AUDIO() {return 2;}\r\n\r\n    static get map() {return {\r\n        [StreamType.VIDEO]: 'video',\r\n        [StreamType.AUDIO]: 'audio'\r\n    }};\r\n}\r\n\r\nexport class PayloadType {\r\n    static get H264() {return 1;}\r\n    static get AAC() {return 2;}\r\n\r\n    static get map() {return {\r\n        [PayloadType.H264]: 'video',\r\n        [PayloadType.AAC]: 'audio'\r\n    }};\r\n\r\n    static get string_map() {return  {\r\n        H264: PayloadType.H264,\r\n        AAC: PayloadType.AAC,\r\n        'MP4A-LATM': PayloadType.AAC,\r\n        'MPEG4-GENERIC': PayloadType.AAC\r\n    }}\r\n}","import {EventEmitter, EventSourceWrapper} from '../../deps/bp_event.js';\r\nimport {getTagged} from \"../../deps/bp_logger.js\";\r\nimport {MP4} from '../iso-bmff/mp4-generator.js';\r\nimport {AACRemuxer} from './aac.js';\r\nimport {H264Remuxer} from './h264.js';\r\nimport {MSE} from '../presentation/mse.js';\r\nimport {PayloadType} from \"../defs.js\";\r\n\r\nconst LOG_TAG = \"remuxer\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class Remuxer {\r\n    static get TrackConverters() {return {\r\n        [PayloadType.H264]: H264Remuxer,\r\n        [PayloadType.AAC]:  AACRemuxer\r\n    }};\r\n\r\n    static get TrackScaleFactor() {return {\r\n        [PayloadType.H264]: 1,//4,\r\n        [PayloadType.AAC]:  0\r\n    }};\r\n\r\n    static get TrackTimescale() {return {\r\n        [PayloadType.H264]: 90000,//22500,\r\n        [PayloadType.AAC]:  0\r\n    }};\r\n\r\n    constructor(mediaElement) {\r\n        this.mse = new MSE([mediaElement]);\r\n        this.eventSource = new EventEmitter();\r\n        this.mseEventSource = new EventSourceWrapper(this.mse.eventSource);\r\n        this.mse_ready = true;\r\n\r\n        this.reset();\r\n\r\n        this.errorListener = this.mseClose.bind(this);\r\n        this.closeListener = this.mseClose.bind(this);\r\n        this.errorDecodeListener = this.mseErrorDecode.bind(this);\r\n\r\n        this.eventSource.addEventListener('ready', this.init.bind(this));\r\n    }\r\n\r\n    initMSEHandlers() {\r\n        this.mseEventSource.on('error', this.errorListener);\r\n        this.mseEventSource.on('sourceclosed', this.closeListener);\r\n        this.mseEventSource.on('errordecode', this.errorDecodeListener);\r\n    }\r\n\r\n    async reset() {\r\n        this.tracks = {};\r\n        this.initialized = false;\r\n        this.initSegments = {};\r\n        this.codecs = [];\r\n        this.streams = {};\r\n        this.enabled = false;\r\n        await this.mse.clear();\r\n        this.initMSEHandlers();\r\n    }\r\n\r\n    destroy() {\r\n        this.mseEventSource.destroy();\r\n        this.mse.destroy();\r\n        this.mse = null;\r\n\r\n        this.detachClient();\r\n\r\n        this.eventSource.destroy();\r\n    }\r\n\r\n    onTracks(tracks) {\r\n        Log.debug(`ontracks: `, tracks.detail);\r\n        // store available track types\r\n        for (let track of tracks.detail) {\r\n            this.tracks[track.type] = new Remuxer.TrackConverters[track.type](Remuxer.TrackTimescale[track.type], Remuxer.TrackScaleFactor[track.type], track.params);\r\n            if (track.offset) {\r\n                this.tracks[track.type].timeOffset = track.offset;\r\n            }\r\n            if (track.duration) {\r\n                this.tracks[track.type].mp4track.duration = track.duration*(this.tracks[track.type].timescale || Remuxer.TrackTimescale[track.type]);\r\n                this.tracks[track.type].duration = track.duration;\r\n            } else {\r\n                this.tracks[track.type].duration = 1;\r\n            }\r\n\r\n            // this.tracks[track.type].duration\r\n        }\r\n        this.mse.setLive(!this.client.seekable);\r\n    }\r\n\r\n    setTimeOffset(timeOffset, track) {\r\n        if (this.tracks[track.type]) {\r\n            this.tracks[track.type].timeOffset = timeOffset;///this.tracks[track.type].scaleFactor;\r\n        }\r\n    }\r\n\r\n    init() {\r\n        let tracks = [];\r\n        this.codecs = [];\r\n        let initmse = [];\r\n        let initPts = Infinity;\r\n        let initDts = Infinity;\r\n        for (let track_type in this.tracks) {\r\n            let track = this.tracks[track_type];\r\n            if (!MSE.isSupported([track.mp4track.codec])) {\r\n                throw new Error(`${track.mp4track.type} codec ${track.mp4track.codec} is not supported`);\r\n            }\r\n            tracks.push(track.mp4track);\r\n            this.codecs.push(track.mp4track.codec);\r\n            track.init(initPts, initDts/*, false*/);\r\n            // initPts = Math.min(track.initPTS, initPts);\r\n            // initDts = Math.min(track.initDTS, initDts);\r\n        }\r\n\r\n        for (let track_type in this.tracks) {\r\n            let track = this.tracks[track_type];\r\n            //track.init(initPts, initDts);\r\n            this.initSegments[track_type] = MP4.initSegment([track.mp4track], track.duration*track.timescale, track.timescale);\r\n            initmse.push(this.initMSE(track_type, track.mp4track.codec));\r\n        }\r\n        this.initialized = true;\r\n        return Promise.all(initmse).then(()=>{\r\n            //this.mse.play();\r\n            this.enabled = true;\r\n        });\r\n        \r\n    }\r\n\r\n    initMSE(track_type, codec) {\r\n        if (MSE.isSupported(this.codecs)) {\r\n            return this.mse.setCodec(track_type, `${PayloadType.map[track_type]}/mp4; codecs=\"${codec}\"`).then(()=>{\r\n                this.mse.feed(track_type, this.initSegments[track_type]);\r\n                // this.mse.play();\r\n                // this.enabled = true;\r\n            });\r\n        } else {\r\n            throw new Error('Codecs are not supported');\r\n        }\r\n    }\r\n\r\n    mseClose() {\r\n        // this.mse.clear();\r\n        this.client.stop();\r\n        this.eventSource.dispatchEvent('stopped');\r\n    }\r\n\r\n    mseErrorDecode() {\r\n        if(this.tracks[2]) {\r\n            console.warn(this.tracks[2].mp4track.type);\r\n            this.mse.buffers[2].destroy();\r\n            delete this.tracks[2];\r\n        }\r\n    }\r\n\r\n    flush() {\r\n        this.onSamples();\r\n\r\n        if (!this.initialized) {\r\n            // Log.debug(`Initialize...`);\r\n            if (Object.keys(this.tracks).length) {\r\n                for (let track_type in this.tracks) {\r\n                    if (!this.tracks[track_type].readyToDecode || !this.tracks[track_type].samples.length) return;\r\n                    Log.debug(`Init MSE for track ${this.tracks[track_type].mp4track.type}`);\r\n                }\r\n                this.eventSource.dispatchEvent('ready');\r\n            }\r\n        } else {\r\n            for (let track_type in this.tracks) {\r\n                let track = this.tracks[track_type];\r\n                let pay = track.getPayload();\r\n                if (pay && pay.byteLength) {\r\n                    this.mse.feed(track_type, [MP4.moof(track.seq, track.scaled(track.firstDTS), track.mp4track), MP4.mdat(pay)]);\r\n                    track.flush();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onSamples(ev) {\r\n        // TODO: check format\r\n        // let data = ev.detail;\r\n        // if (this.tracks[data.pay] && this.client.sampleQueues[data.pay].length) {\r\n            // console.log(`video ${data.units[0].dts}`);\r\n        for (let qidx in this.client.sampleQueues) {\r\n            let queue = this.client.sampleQueues[qidx];\r\n            while (queue.length) {\r\n                let units = queue.shift();\r\n                if(units){\r\n                    for (let chunk of units) {\r\n                        if(this.tracks[qidx]) {\r\n                            this.tracks[qidx].remux(chunk);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (!this.initialized) {\r\n                        delete this.tracks[qidx];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // }\r\n    }\r\n\r\n    onAudioConfig(ev) {\r\n        if (this.tracks[ev.detail.pay]) {\r\n            this.tracks[ev.detail.pay].setConfig(ev.detail.config);\r\n        }\r\n    }\r\n\r\n    attachClient(client) {\r\n        this.detachClient();\r\n        this.client = client;\r\n        this.clientEventSource = new EventSourceWrapper(this.client.eventSource);\r\n        this.clientEventSource.on('samples', this.samplesListener);\r\n        this.clientEventSource.on('audio_config', this.audioConfigListener);\r\n        this.clientEventSource.on('tracks', this.onTracks.bind(this));\r\n        this.clientEventSource.on('flush', this.flush.bind(this));\r\n        this.clientEventSource.on('clear', ()=>{\r\n            this.reset();\r\n            this.mse.clear().then(()=>{\r\n                //this.mse.play();\r\n                this.initMSEHandlers();\r\n            });\r\n        });\r\n    }\r\n\r\n    detachClient() {\r\n        if (this.client) {\r\n            this.clientEventSource.destroy();\r\n            // this.client.eventSource.removeEventListener('samples', this.onSamples.bind(this));\r\n            // this.client.eventSource.removeEventListener('audio_config', this.onAudioConfig.bind(this));\r\n            // // TODO: clear other listeners\r\n            // this.client.eventSource.removeEventListener('clear', this._clearListener);\r\n            // this.client.eventSource.removeEventListener('tracks', this._tracksListener);\r\n            // this.client.eventSource.removeEventListener('flush', this._flushListener);\r\n            this.client = null;\r\n        }\r\n    }\r\n}","class State {\n    constructor(name, stateMachine) {\n        this.stateMachine = stateMachine;\n        this.transitions = new Set();\n        this.name = name;\n    }\n\n\n    activate() {\n        return Promise.resolve(null);\n    }\n\n    finishTransition() {}\n\n    failHandler() {}\n\n    deactivate() {\n        return Promise.resolve(null);\n    }\n}\n\nexport class StateMachine {\n    constructor() {\n        this.storage = {};\n        this.currentState = null;\n        this.states = new Map();\n    }\n\n    addState(name, {activate, finishTransition, deactivate}) {\n        let state = new State(name, this);\n        if (activate) state.activate = activate;\n        if (finishTransition) state.finishTransition = finishTransition;\n        if (deactivate) state.deactivate = deactivate;\n        this.states.set(name, state);\n        return this;\n    }\n\n    addTransition(fromName, toName){\n        if (!this.states.has(fromName)) {\n            throw ReferenceError(`No such state: ${fromName} while connecting to ${toName}`);\n        }\n        if (!this.states.has(toName)) {\n            throw ReferenceError(`No such state: ${toName} while connecting from ${fromName}`);\n        }\n        this.states.get(fromName).transitions.add(toName);\n        return this;\n    }\n\n    _promisify(res) {\n        let promise;\n        try {\n            promise = res;\n            if (!promise.then) {\n                promise = Promise.resolve(promise);\n            }\n        } catch (e) {\n            promise = Promise.reject(e);\n        }\n        return promise;\n    }\n\n    transitionTo(stateName) {\n        if (this.currentState == null) {\n            let state = this.states.get(stateName);\n            return this._promisify(state.activate.call(this))\n                .then((data)=> {\n                    this.currentState = state;\n                    return data;\n                }).then(state.finishTransition.bind(this)).catch((e)=>{\n                    state.failHandler();\n                    throw e;\n                });\n        }\n        if (this.currentState.name == stateName) return Promise.resolve();\n        if (this.currentState.transitions.has(stateName)) {\n            let state = this.states.get(stateName);\n            return this._promisify(state.deactivate.call(this))\n                .then(state.activate.bind(this)).then((data)=> {\n                    this.currentState = state;\n                    return data;\n                }).then(state.finishTransition.bind(this)).catch((e)=>{\n                    state.failHandler();\n                    throw e;\n                });\n        } else {\n            return Promise.reject(`No such transition: ${this.currentState.name} to ${stateName}`);\n        }\n    }\n\n}\n","// export * from 'bp_statemachine';\r\nexport * from '../../node_modules/bp_statemachine/statemachine.js';","import {getTagged} from '../../deps/bp_logger';\r\nimport {PayloadType} from '../defs.js';\r\n\r\nconst Log = getTagged(\"parser:sdp\");\r\n\r\nexport class SDPParser {\r\n    constructor() {\r\n        this.version = -1;\r\n        this.origin = null;\r\n        this.sessionName = null;\r\n        this.timing = null;\r\n        this.sessionBlock = {};\r\n        this.media = {};\r\n        this.tracks = {};\r\n        this.mediaMap = {};\r\n    }\r\n\r\n    parse(content) {\r\n        // Log.debug(content);\r\n        return new Promise((resolve, reject) => {\r\n            var dataString = content;\r\n            var success = true;\r\n            var currentMediaBlock = this.sessionBlock;\r\n\r\n            // TODO: multiple audio/video tracks\r\n\r\n            for (let line of dataString.split(\"\\n\")) {\r\n                line = line.replace(/\\r/, '');\r\n                if (0 === line.length) {\r\n                    /* Empty row (last row perhaps?), skip to next */\r\n                    continue;\r\n                }\r\n\r\n                switch (line.charAt(0)) {\r\n                    case 'v':\r\n                        if (-1 !== this.version) {\r\n                            Log.log('Version present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseVersion(line);\r\n                        break;\r\n\r\n                    case 'o':\r\n                        if (null !== this.origin) {\r\n                            Log.log('Origin present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseOrigin(line);\r\n                        break;\r\n\r\n                    case 's':\r\n                        if (null !== this.sessionName) {\r\n                            Log.log('Session Name present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseSessionName(line);\r\n                        break;\r\n\r\n                    case 't':\r\n                        if (null !== this.timing) {\r\n                            Log.log('Timing present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseTiming(line);\r\n                        break;\r\n\r\n                    case 'm':\r\n                        if (null !== currentMediaBlock && this.sessionBlock !== currentMediaBlock) {\r\n                            /* Complete previous block and store it */\r\n                            this.media[currentMediaBlock.type] = currentMediaBlock;\r\n                        }\r\n\r\n                        /* A wild media block appears */\r\n                        currentMediaBlock = {};\r\n                        currentMediaBlock.rtpmap = {};\r\n                        this._parseMediaDescription(line, currentMediaBlock);\r\n                        break;\r\n\r\n                    case 'a':\r\n                        SDPParser._parseAttribute(line, currentMediaBlock);\r\n                        break;\r\n\r\n                    default:\r\n                        Log.log('Ignored unknown SDP directive: ' + line);\r\n                        break;\r\n                }\r\n\r\n                if (!success) {\r\n                    reject();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.media[currentMediaBlock.type] = currentMediaBlock;\r\n\r\n            success ? resolve() : reject();\r\n        });\r\n    }\r\n\r\n    _parseVersion(line) {\r\n        let matches = line.match(/^v=([0-9]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'v=\\' (Version) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.version = matches[1];\r\n        if (0 != this.version) {\r\n            Log.log('Unsupported SDP version:' + this.version);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseOrigin(line) {\r\n        let matches = line.match(/^o=([^ ]+) (-?[0-9]+) (-?[0-9]+) (IN) (IP4|IP6) ([^ ]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'o=\\' (Origin) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.origin = {};\r\n        this.origin.username = matches[1];\r\n        this.origin.sessionid = matches[2];\r\n        this.origin.sessionversion = matches[3];\r\n        this.origin.nettype = matches[4];\r\n        this.origin.addresstype = matches[5];\r\n        this.origin.unicastaddress = matches[6];\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseSessionName(line) {\r\n        let matches = line.match(/^s=([^\\r\\n]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'s=\\' (Session Name) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.sessionName = matches[1];\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseTiming(line) {\r\n        let matches = line.match(/^t=([0-9]+) ([0-9]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'t=\\' (Timing) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.timing = {};\r\n        this.timing.start = matches[1];\r\n        this.timing.stop = matches[2];\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseMediaDescription(line, media) {\r\n        let matches = line.match(/^m=([^ ]+) ([^ ]+) ([^ ]+)[ ]/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'m=\\' (Media) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        media.type = matches[1];\r\n        media.port = matches[2];\r\n        media.proto = matches[3];\r\n        media.fmt = line.substr(matches[0].length).split(' ').map(function (fmt, index, array) {\r\n            return parseInt(fmt);\r\n        });\r\n\r\n        for (let fmt of media.fmt) {\r\n            this.mediaMap[fmt] = media;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static _parseAttribute(line, media) {\r\n        if (null === media) {\r\n            /* Not in a media block, can't be bothered parsing attributes for session */\r\n            return true;\r\n        }\r\n\r\n        var matches;\r\n        /* Used for some cases of below switch-case */\r\n        var separator = line.indexOf(':');\r\n        var attribute = line.substr(0, (-1 === separator) ? 0x7FFFFFFF : separator);\r\n        /* 0x7FF.. is default */\r\n\r\n        switch (attribute) {\r\n            case 'a=recvonly':\r\n            case 'a=sendrecv':\r\n            case 'a=sendonly':\r\n            case 'a=inactive':\r\n                media.mode = line.substr('a='.length);\r\n                break;\r\n            case 'a=range':\r\n                matches = line.match(/^a=range:\\s*([a-zA-Z-]+)=([0-9.]+|now)\\s*-\\s*([0-9.]*)$/);\r\n                media.range = [Number(matches[2] == \"now\" ? -1 : matches[2]), Number(matches[3]), matches[1]];\r\n                break;\r\n            case 'a=control':\r\n                media.control = line.substr('a=control:'.length);\r\n                break;\r\n\r\n            case 'a=rtpmap':\r\n                matches = line.match(/^a=rtpmap:(\\d+) (.*)$/);\r\n                if (null === matches) {\r\n                    Log.log('Could not parse \\'rtpmap\\' of \\'a=\\'');\r\n                    return false;\r\n                }\r\n\r\n                var payload = parseInt(matches[1]);\r\n                media.rtpmap[payload] = {};\r\n\r\n                var attrs = matches[2].split('/');\r\n                media.rtpmap[payload].name = attrs[0].toUpperCase();\r\n                media.rtpmap[payload].clock = attrs[1];\r\n                if (undefined !== attrs[2]) {\r\n                    media.rtpmap[payload].encparams = attrs[2];\r\n                }\r\n                media.ptype = PayloadType.string_map[attrs[0].toUpperCase()];\r\n\r\n                break;\r\n\r\n            case 'a=fmtp':\r\n                matches = line.match(/^a=fmtp:(\\d+) (.*)$/);\r\n                if (0 === matches.length) {\r\n                    Log.log('Could not parse \\'fmtp\\'  of \\'a=\\'');\r\n                    return false;\r\n                }\r\n\r\n                media.fmtp = {};\r\n                var param;\r\n                for (param of matches[2].split(';')) {\r\n                    var idx = param.indexOf('=');\r\n                    media.fmtp[param.substr(0, idx).toLowerCase().trim()] = param.substr(idx + 1).trim();\r\n                }\r\n                break;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    getSessionBlock() {\r\n        return this.sessionBlock;\r\n    }\r\n\r\n    hasMedia(mediaType) {\r\n        return this.media[mediaType] != undefined;\r\n    }\r\n\r\n    getMediaBlock(mediaType) {\r\n        return this.media[mediaType];\r\n    }\r\n\r\n    getMediaBlockByPayloadType(pt) {\r\n        // var m;\r\n        // for (m in this.media) {\r\n        //     if (-1 !== this.media[m].fmt.indexOf(pt)) {\r\n        //         return this.media[m];\r\n        //     }\r\n        // }\r\n        return this.mediaMap[pt] || null;\r\n\r\n        //ErrorManager.dispatchError(826, [pt], true);\r\n        // Log.error(`failed to find media with payload type ${pt}`);\r\n        //\r\n        // return null;\r\n    }\r\n\r\n    getMediaBlockList() {\r\n        var res = [];\r\n        var m;\r\n        for (m in this.media) {\r\n            res.push(m);\r\n        }\r\n        return res;\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\n\r\nimport {RTSPClientSM as RTSPClient} from './client.js';\r\nimport {Url} from '../../core/util/url.js';\r\nimport {RTSPError} from \"./client\";\r\n\r\nconst LOG_TAG = \"rtsp:stream\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class RTSPStream {\r\n\r\n    constructor(client, track) {\r\n        this.state = null;\r\n        this.client = client;\r\n        this.track = track;\r\n        this.rtpChannel = 1;\r\n\r\n        this.stopKeepAlive();\r\n        this.keepaliveInterval = null;\r\n        this.keepaliveTime = 30000;\r\n    }\r\n\r\n    reset() {\r\n        this.stopKeepAlive();\r\n        this.client.forgetRTPChannel(this.rtpChannel);\r\n        this.client = null;\r\n        this.track = null;\r\n    }\r\n\r\n    start(lastSetupPromise = null) {\r\n        if (lastSetupPromise != null) {\r\n            // if a setup was already made, use the same session\r\n            return lastSetupPromise.then((obj) => this.sendSetup(obj.session))\r\n        } else {\r\n            return this.sendSetup();\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        return this.sendTeardown();\r\n    }\r\n\r\n    getSetupURL(track) {\r\n        let sessionBlock = this.client.sdp.getSessionBlock();\r\n        if (Url.isAbsolute(track.control)) {\r\n            return track.control;\r\n        } else if (Url.isAbsolute(`${sessionBlock.control}${track.control}`)) {\r\n            return `${sessionBlock.control}${track.control}`;\r\n        } else if (Url.isAbsolute(`${this.client.contentBase}${track.control}`)) {\r\n            /* Should probably check session level control before this */\r\n            return `${this.client.contentBase}${track.control}`;\r\n        }\r\n        else {//need return default\r\n            return track.control;\r\n        }\r\n        Log.error('Can\\'t determine track URL from ' +\r\n            'block.control:' + track.control + ', ' +\r\n            'session.control:' + sessionBlock.control + ', and ' +\r\n            'content-base:' + this.client.contentBase);\r\n    }\r\n\r\n    getControlURL() {\r\n        let ctrl = this.client.sdp.getSessionBlock().control;\r\n        if (Url.isAbsolute(ctrl)) {\r\n            return ctrl;\r\n        } else if (!ctrl || '*' === ctrl) {\r\n            return this.client.contentBase;\r\n        } else {\r\n            return `${this.client.contentBase}${ctrl}`;\r\n        }\r\n    }\r\n\r\n    sendKeepalive() {\r\n        if (this.client.methods.includes('GET_PARAMETER')) {\r\n            return this.client.sendRequest('GET_PARAMETER', this.getSetupURL(this.track), {\r\n                'Session': this.session\r\n            });\r\n        } else {\r\n            return this.client.sendRequest('OPTIONS', '*');\r\n        }\r\n    }\r\n\r\n    stopKeepAlive() {\r\n        clearInterval(this.keepaliveInterval);\r\n    }\r\n\r\n    startKeepAlive() {\r\n        this.keepaliveInterval = setInterval(() => {\r\n            this.sendKeepalive().catch((e) => {\r\n                Log.error(e);\r\n                if (e instanceof RTSPError) {\r\n                    if (Number(e.data.parsed.code) == 501) {\r\n                        return;\r\n                    }\r\n                }\r\n                this.client.reconnect();\r\n            });\r\n        }, this.keepaliveTime);\r\n    }\r\n\r\n    sendRequest(_cmd, _params = {}) {\r\n        let params = {};\r\n        if (this.session) {\r\n            params['Session'] = this.session;\r\n        }\r\n        Object.assign(params, _params);\r\n        return this.client.sendRequest(_cmd, this.getControlURL(), params);\r\n    }\r\n\r\n    sendSetup(session = null) {\r\n        this.state = RTSPClient.STATE_SETUP;\r\n        this.rtpChannel = this.client.interleaveChannelIndex;\r\n        let interleavedChannels = this.client.interleaveChannelIndex++ + \"-\" + this.client.interleaveChannelIndex++;\r\n        let params = {\r\n            'Transport': `RTP/AVP/TCP;unicast;interleaved=${interleavedChannels}`,\r\n            'Date': new Date().toUTCString()\r\n        };\r\n        if(session){\r\n            params.Session = session;\r\n        }\r\n        return this.client.sendRequest('SETUP', this.getSetupURL(this.track), params).then((_data) => {\r\n            this.session = _data.headers['session'];\r\n            let transport = _data.headers['transport'];\r\n            if (transport) {\r\n                let interleaved = transport.match(/interleaved=([0-9]+)-([0-9]+)/)[1];\r\n                if (interleaved) {\r\n                    this.rtpChannel = Number(interleaved);\r\n                }\r\n            }\r\n            let sessionParamsChunks = this.session.split(';').slice(1);\r\n            let sessionParams = {};\r\n            for (let chunk of sessionParamsChunks) {\r\n                let kv = chunk.split('=');\r\n                sessionParams[kv[0]] = kv[1];\r\n            }\r\n            if (sessionParams['timeout']) {\r\n                this.keepaliveInterval = Number(sessionParams['timeout']) * 500; // * 1000 / 2\r\n            }\r\n            /*if (!/RTP\\/AVP\\/TCP;unicast;interleaved=/.test(_data.headers[\"transport\"])) {\r\n                // TODO: disconnect stream and notify client\r\n                throw new Error(\"Connection broken\");\r\n            }*/\r\n            this.client.useRTPChannel(this.rtpChannel);\r\n            this.startKeepAlive();\r\n            return {track: this.track, data: _data, session: this.session};\r\n        });\r\n    }\r\n}\r\n","/*\r\n * JavaScript MD5\r\n * https://github.com/blueimp/JavaScript-MD5\r\n *\r\n * Copyright 2011, Sebastian Tschan\r\n * https://blueimp.net\r\n *\r\n * Licensed under the MIT license:\r\n * https://opensource.org/licenses/MIT\r\n *\r\n * Based on\r\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\r\n * Digest Algorithm, as defined in RFC 1321.\r\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\r\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\r\n * Distributed under the BSD License\r\n * See http://pajhome.org.uk/crypt/md5 for more info.\r\n */\r\n\r\n\r\n/*\r\n* Add integers, wrapping at 2^32. This uses 16-bit operations internally\r\n* to work around bugs in some JS interpreters.\r\n*/\r\nfunction safeAdd(x, y) {\r\n    var lsw = (x & 0xFFFF) + (y & 0xFFFF)\r\n    var msw = (x >> 16) + (y >> 16) + (lsw >> 16)\r\n    return (msw << 16) | (lsw & 0xFFFF)\r\n}\r\n\r\n/*\r\n* Bitwise rotate a 32-bit number to the left.\r\n*/\r\nfunction bitRotateLeft(num, cnt) {\r\n    return (num << cnt) | (num >>> (32 - cnt))\r\n}\r\n\r\n/*\r\n* These functions implement the four basic operations the algorithm uses.\r\n*/\r\nfunction md5cmn(q, a, b, x, s, t) {\r\n    return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b)\r\n}\r\nfunction md5ff(a, b, c, d, x, s, t) {\r\n    return md5cmn((b & c) | ((~b) & d), a, b, x, s, t)\r\n}\r\nfunction md5gg(a, b, c, d, x, s, t) {\r\n    return md5cmn((b & d) | (c & (~d)), a, b, x, s, t)\r\n}\r\nfunction md5hh(a, b, c, d, x, s, t) {\r\n    return md5cmn(b ^ c ^ d, a, b, x, s, t)\r\n}\r\nfunction md5ii(a, b, c, d, x, s, t) {\r\n    return md5cmn(c ^ (b | (~d)), a, b, x, s, t)\r\n}\r\n\r\n/*\r\n* Calculate the MD5 of an array of little-endian words, and a bit length.\r\n*/\r\nfunction binlMD5(x, len) {\r\n    /* append padding */\r\n    x[len >> 5] |= 0x80 << (len % 32)\r\n    x[(((len + 64) >>> 9) << 4) + 14] = len\r\n\r\n    var i\r\n    var olda\r\n    var oldb\r\n    var oldc\r\n    var oldd\r\n    var a = 1732584193\r\n    var b = -271733879\r\n    var c = -1732584194\r\n    var d = 271733878\r\n\r\n    for (i = 0; i < x.length; i += 16) {\r\n        olda = a\r\n        oldb = b\r\n        oldc = c\r\n        oldd = d\r\n\r\n        a = md5ff(a, b, c, d, x[i], 7, -680876936)\r\n        d = md5ff(d, a, b, c, x[i + 1], 12, -389564586)\r\n        c = md5ff(c, d, a, b, x[i + 2], 17, 606105819)\r\n        b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330)\r\n        a = md5ff(a, b, c, d, x[i + 4], 7, -176418897)\r\n        d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426)\r\n        c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341)\r\n        b = md5ff(b, c, d, a, x[i + 7], 22, -45705983)\r\n        a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416)\r\n        d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417)\r\n        c = md5ff(c, d, a, b, x[i + 10], 17, -42063)\r\n        b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162)\r\n        a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682)\r\n        d = md5ff(d, a, b, c, x[i + 13], 12, -40341101)\r\n        c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290)\r\n        b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329)\r\n\r\n        a = md5gg(a, b, c, d, x[i + 1], 5, -165796510)\r\n        d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632)\r\n        c = md5gg(c, d, a, b, x[i + 11], 14, 643717713)\r\n        b = md5gg(b, c, d, a, x[i], 20, -373897302)\r\n        a = md5gg(a, b, c, d, x[i + 5], 5, -701558691)\r\n        d = md5gg(d, a, b, c, x[i + 10], 9, 38016083)\r\n        c = md5gg(c, d, a, b, x[i + 15], 14, -660478335)\r\n        b = md5gg(b, c, d, a, x[i + 4], 20, -405537848)\r\n        a = md5gg(a, b, c, d, x[i + 9], 5, 568446438)\r\n        d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690)\r\n        c = md5gg(c, d, a, b, x[i + 3], 14, -187363961)\r\n        b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501)\r\n        a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467)\r\n        d = md5gg(d, a, b, c, x[i + 2], 9, -51403784)\r\n        c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473)\r\n        b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734)\r\n\r\n        a = md5hh(a, b, c, d, x[i + 5], 4, -378558)\r\n        d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463)\r\n        c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562)\r\n        b = md5hh(b, c, d, a, x[i + 14], 23, -35309556)\r\n        a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060)\r\n        d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353)\r\n        c = md5hh(c, d, a, b, x[i + 7], 16, -155497632)\r\n        b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640)\r\n        a = md5hh(a, b, c, d, x[i + 13], 4, 681279174)\r\n        d = md5hh(d, a, b, c, x[i], 11, -358537222)\r\n        c = md5hh(c, d, a, b, x[i + 3], 16, -722521979)\r\n        b = md5hh(b, c, d, a, x[i + 6], 23, 76029189)\r\n        a = md5hh(a, b, c, d, x[i + 9], 4, -640364487)\r\n        d = md5hh(d, a, b, c, x[i + 12], 11, -421815835)\r\n        c = md5hh(c, d, a, b, x[i + 15], 16, 530742520)\r\n        b = md5hh(b, c, d, a, x[i + 2], 23, -995338651)\r\n\r\n        a = md5ii(a, b, c, d, x[i], 6, -198630844)\r\n        d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415)\r\n        c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905)\r\n        b = md5ii(b, c, d, a, x[i + 5], 21, -57434055)\r\n        a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571)\r\n        d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606)\r\n        c = md5ii(c, d, a, b, x[i + 10], 15, -1051523)\r\n        b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799)\r\n        a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359)\r\n        d = md5ii(d, a, b, c, x[i + 15], 10, -30611744)\r\n        c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380)\r\n        b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649)\r\n        a = md5ii(a, b, c, d, x[i + 4], 6, -145523070)\r\n        d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379)\r\n        c = md5ii(c, d, a, b, x[i + 2], 15, 718787259)\r\n        b = md5ii(b, c, d, a, x[i + 9], 21, -343485551)\r\n\r\n        a = safeAdd(a, olda)\r\n        b = safeAdd(b, oldb)\r\n        c = safeAdd(c, oldc)\r\n        d = safeAdd(d, oldd)\r\n    }\r\n    return [a, b, c, d]\r\n}\r\n\r\n/*\r\n* Convert an array of little-endian words to a string\r\n*/\r\nfunction binl2rstr(input) {\r\n    var i\r\n    var output = ''\r\n    var length32 = input.length * 32\r\n    for (i = 0; i < length32; i += 8) {\r\n        output += String.fromCharCode((input[i >> 5] >>> (i % 32)) & 0xFF)\r\n    }\r\n    return output\r\n}\r\n\r\n/*\r\n* Convert a raw string to an array of little-endian words\r\n* Characters >255 have their high-byte silently ignored.\r\n*/\r\nfunction rstr2binl(input) {\r\n    var i\r\n    var output = []\r\n    output[(input.length >> 2) - 1] = undefined\r\n    for (i = 0; i < output.length; i += 1) {\r\n        output[i] = 0\r\n    }\r\n    var length8 = input.length * 8\r\n    for (i = 0; i < length8; i += 8) {\r\n        output[i >> 5] |= (input.charCodeAt(i / 8) & 0xFF) << (i % 32)\r\n    }\r\n    return output\r\n}\r\n\r\n/*\r\n* Calculate the MD5 of a raw string\r\n*/\r\nfunction rstrMD5(s) {\r\n    return binl2rstr(binlMD5(rstr2binl(s), s.length * 8))\r\n}\r\n\r\n/*\r\n* Calculate the HMAC-MD5, of a key and some data (raw strings)\r\n*/\r\nfunction rstrHMACMD5(key, data) {\r\n    var i\r\n    var bkey = rstr2binl(key)\r\n    var ipad = []\r\n    var opad = []\r\n    var hash\r\n    ipad[15] = opad[15] = undefined\r\n    if (bkey.length > 16) {\r\n        bkey = binlMD5(bkey, key.length * 8)\r\n    }\r\n    for (i = 0; i < 16; i += 1) {\r\n        ipad[i] = bkey[i] ^ 0x36363636\r\n        opad[i] = bkey[i] ^ 0x5C5C5C5C\r\n    }\r\n    hash = binlMD5(ipad.concat(rstr2binl(data)), 512 + data.length * 8)\r\n    return binl2rstr(binlMD5(opad.concat(hash), 512 + 128))\r\n}\r\n\r\n/*\r\n* Convert a raw string to a hex string\r\n*/\r\nfunction rstr2hex(input) {\r\n    var hexTab = '0123456789abcdef'\r\n    var output = ''\r\n    var x\r\n    var i\r\n    for (i = 0; i < input.length; i += 1) {\r\n        x = input.charCodeAt(i)\r\n        output += hexTab.charAt((x >>> 4) & 0x0F) +\r\n            hexTab.charAt(x & 0x0F)\r\n    }\r\n    return output\r\n}\r\n\r\n/*\r\n* Encode a string as utf-8\r\n*/\r\nfunction str2rstrUTF8(input) {\r\n    return unescape(encodeURIComponent(input))\r\n}\r\n\r\n/*\r\n* Take string arguments and return either raw or hex encoded strings\r\n*/\r\nfunction rawMD5(s) {\r\n    return rstrMD5(str2rstrUTF8(s))\r\n}\r\nfunction hexMD5(s) {\r\n    return rstr2hex(rawMD5(s))\r\n}\r\nfunction rawHMACMD5(k, d) {\r\n    return rstrHMACMD5(str2rstrUTF8(k), str2rstrUTF8(d))\r\n}\r\nfunction hexHMACMD5(k, d) {\r\n    return rstr2hex(rawHMACMD5(k, d))\r\n}\r\n\r\nexport default function md5(string, key, raw) {\r\n    if (!key) {\r\n        if (!raw) {\r\n            return hexMD5(string)\r\n        }\r\n        return rawMD5(string)\r\n    }\r\n    if (!raw) {\r\n        return hexHMACMD5(key, string)\r\n    }\r\n    return rawHMACMD5(key, string)\r\n}\r\n","// TODO: asm.js\r\nimport {Log} from '../../../deps/bp_logger.js';\r\nexport default class RTP {\r\n    constructor(pkt/*uint8array*/, sdp) {\r\n        let bytes = new DataView(pkt.buffer, pkt.byteOffset, pkt.byteLength);\r\n\r\n        this.version   = bytes.getUint8(0) >>> 6;\r\n        this.padding   = bytes.getUint8(0) & 0x20 >>> 5;\r\n        this.has_extension = bytes.getUint8(0) & 0x10 >>> 4;\r\n        this.csrc      = bytes.getUint8(0) & 0x0F;\r\n        this.marker    = bytes.getUint8(1) >>> 7;\r\n        this.pt        = bytes.getUint8(1) & 0x7F;\r\n        this.sequence  = bytes.getUint16(2) ;\r\n        this.timestamp = bytes.getUint32(4);\r\n        this.ssrc      = bytes.getUint32(8);\r\n        this.csrcs     = [];\r\n\r\n        let pktIndex=12;\r\n        if (this.csrc>0) {\r\n            this.csrcs.push(bytes.getUint32(pktIndex));\r\n            pktIndex+=4;\r\n        }\r\n        if (this.has_extension==1) {\r\n            this.extension = bytes.getUint16(pktIndex);\r\n            this.ehl = bytes.getUint16(pktIndex+2);\r\n            pktIndex+=4;\r\n            this.header_data = pkt.slice(pktIndex, this.ehl);\r\n            pktIndex += this.ehl;\r\n        }\r\n\r\n        this.headerLength = pktIndex;\r\n        let padLength = 0;\r\n        if (this.padding) {\r\n            padLength = bytes.getUint8(pkt.byteLength-1);\r\n        }\r\n\r\n        // this.bodyLength   = pkt.byteLength-this.headerLength-padLength;\r\n\r\n        this.media = sdp.getMediaBlockByPayloadType(this.pt);\r\n        if (null === this.media) {\r\n            Log.log(`Media description for payload type: ${this.pt} not provided.`);\r\n        } else {\r\n            this.type = this.media.ptype;//PayloadType.string_map[this.media.rtpmap[this.media.fmt[0]].name];\r\n        }\r\n\r\n        this.data = pkt.subarray(pktIndex);\r\n        // this.timestamp = 1000 * (this.timestamp / this.media.rtpmap[this.pt].clock);\r\n        // console.log(this);\r\n    }\r\n    getPayload() {\r\n        return this.data;\r\n    }\r\n\r\n    getTimestampMS() {\r\n        return this.timestamp; //1000 * (this.timestamp / this.media.rtpmap[this.pt].clock);\r\n    }\r\n\r\n    toString() {\r\n        return \"RTP(\" +\r\n            \"version:\"   + this.version   + \", \" +\r\n            \"padding:\"   + this.padding   + \", \" +\r\n            \"has_extension:\" + this.has_extension + \", \" +\r\n            \"csrc:\"      + this.csrc      + \", \" +\r\n            \"marker:\"    + this.marker    + \", \" +\r\n            \"pt:\"        + this.pt        + \", \" +\r\n            \"sequence:\"  + this.sequence  + \", \" +\r\n            \"timestamp:\" + this.timestamp + \", \" +\r\n            \"ssrc:\"      + this.ssrc      + \")\";\r\n    }\r\n\r\n    isVideo(){return this.media.type == 'video';}\r\n    isAudio(){return this.media.type == 'audio';}\r\n\r\n    \r\n}","import RTP from './rtp.js';\r\n\r\nexport default class RTPFactory {\r\n    constructor(sdp) {\r\n        this.tsOffsets={};\r\n        for (let pay in sdp.media) {\r\n            for (let pt of sdp.media[pay].fmt) {\r\n                this.tsOffsets[pt] = {last: 0, overflow: 0};\r\n            }\r\n        }\r\n    }\r\n\r\n    build(pkt/*uint8array*/, sdp) {\r\n        let rtp = new RTP(pkt, sdp);\r\n\r\n        let tsOffset = this.tsOffsets[rtp.pt];\r\n        if (tsOffset) {\r\n            rtp.timestamp += tsOffset.overflow;\r\n            if (tsOffset.last && Math.abs(rtp.timestamp - tsOffset.last) > 0x7fffffff) {\r\n                console.log(`\\nlast ts: ${tsOffset.last}\\n\r\n                            new ts: ${rtp.timestamp}\\n\r\n                            new ts adjusted: ${rtp.timestamp+0xffffffff}\\n\r\n                            last overflow: ${tsOffset.overflow}\\n\r\n                            new overflow: ${tsOffset.overflow+0xffffffff}\\n\r\n                            `);\r\n                tsOffset.overflow += 0xffffffff;\r\n                rtp.timestamp += 0xffffffff;\r\n            }\r\n            /*if (rtp.timestamp>0xffffffff) {\r\n                console.log(`ts: ${rtp.timestamp}, seq: ${rtp.sequence}`);\r\n            }*/\r\n            tsOffset.last = rtp.timestamp;\r\n        }\r\n\r\n        return rtp;\r\n    }\r\n}","export class RTSPMessage {\r\n    static get RTSP_1_0() {return  \"RTSP/1.0\";}\r\n\r\n    constructor(_rtsp_version) {\r\n        this.version = _rtsp_version;\r\n    }\r\n\r\n    build(_cmd, _host, _params={}, _payload=null) {\r\n        let requestString = `${_cmd} ${_host} ${this.version}\\r\\n`;\r\n        for (let param in _params) {\r\n            requestString+=`${param}: ${_params[param]}\\r\\n`\r\n        }\r\n        // TODO: binary payload\r\n        if (_payload) {\r\n            requestString+=`Content-Length: ${_payload.length}\\r\\n`\r\n        }\r\n        requestString+='\\r\\n';\r\n        if (_payload) {\r\n            requestString+=_payload;\r\n        }\r\n        return requestString;\r\n    }\r\n\r\n    parse(_data) {\r\n        let lines = _data.split('\\r\\n');\r\n        let parsed = {\r\n            headers:{},\r\n            body:null,\r\n            code: 0,\r\n            statusLine: ''\r\n        };\r\n\r\n        let match;\r\n        [match, parsed.code, parsed.statusLine] = lines[0].match(new RegExp(`${this.version}[ ]+([0-9]{3})[ ]+(.*)`));\r\n        parsed.code = Number(parsed.code);\r\n        let lineIdx = 1;\r\n\r\n        while (lines[lineIdx]) {\r\n            let [k,v] = lines[lineIdx].split(/:(.+)/);\r\n            parsed.headers[k.toLowerCase()] = v.trim();\r\n            lineIdx++;\r\n        }\r\n\r\n        parsed.body = lines.slice(lineIdx).join('\\n\\r');\r\n\r\n        return parsed;\r\n    }\r\n\r\n}\r\n\r\nexport const MessageBuilder = new RTSPMessage(RTSPMessage.RTSP_1_0);","import {Log} from '../../deps/bp_logger.js';\r\nimport {NALU} from './NALU.js';\r\n\r\n// TODO: asm.js\r\nexport class NALUAsm {\r\n\r\n    constructor() {\r\n        this.fragmented_nalu = null;\r\n    }\r\n\r\n\r\n    static parseNALHeader(hdr) {\r\n        return {\r\n            nri: hdr & 0x60,\r\n            type: hdr & 0x1F\r\n        }\r\n    }\r\n\r\n    parseSingleNALUPacket(rawData, header, dts, pts) {\r\n        return new NALU(header.type,  header.nri, rawData.subarray(0), dts, pts);\r\n    }\r\n\r\n    parseAggregationPacket(rawData, header, dts, pts) {\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n        let nal_start_idx = 0;\r\n        let don = null;\r\n        if (NALU.STAP_B === header.type) {\r\n            don = data.getUint16(nal_start_idx);\r\n            nal_start_idx += 2;\r\n        }\r\n        let ret = [];\r\n        while (nal_start_idx < data.byteLength) {\r\n            let size = data.getUint16(nal_start_idx);\r\n            nal_start_idx += 2;\r\n            let header = NALUAsm.parseNALHeader(data.getInt8(nal_start_idx));\r\n            nal_start_idx++;\r\n            let nalu = this.parseSingleNALUPacket(rawData.subarray(nal_start_idx, nal_start_idx+size), header, dts, pts);\r\n            if (nalu !== null) {\r\n                ret.push(nalu);\r\n            }\r\n            nal_start_idx+=size;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    parseFragmentationUnit(rawData, header, dts, pts) {\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n        let nal_start_idx = 0;\r\n        let fu_header = data.getUint8(nal_start_idx);\r\n        let is_start = (fu_header & 0x80) >>> 7;\r\n        let is_end = (fu_header & 0x40) >>> 6;\r\n        let payload_type = fu_header & 0x1F;\r\n        let ret = null;\r\n\r\n        nal_start_idx++;\r\n        let don = 0;\r\n        if (NALU.FU_B === header.type) {\r\n            don = data.getUint16(nal_start_idx);\r\n            nal_start_idx += 2;\r\n        }\r\n\r\n        if (is_start) {\r\n            this.fragmented_nalu = new NALU(payload_type, header.nri, rawData.subarray(nal_start_idx), dts, pts);\r\n        }\r\n        if (this.fragmented_nalu && this.fragmented_nalu.ntype === payload_type) {\r\n            if (!is_start) {\r\n                this.fragmented_nalu.appendData(rawData.subarray(nal_start_idx));\r\n            }\r\n            if (is_end) {\r\n                ret = this.fragmented_nalu;\r\n                this.fragmented_nalu = null;\r\n                return ret;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    onNALUFragment(rawData, dts, pts) {\r\n\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n\r\n        let header = NALUAsm.parseNALHeader(data.getUint8(0));\r\n\r\n        let nal_start_idx = 1;\r\n\r\n        let unit = null;\r\n        if (header.type > 0 && header.type < 24) {\r\n            unit = this.parseSingleNALUPacket(rawData.subarray(nal_start_idx), header, dts, pts);\r\n        } else if (NALU.FU_A ===  header.type || NALU.FU_B ===  header.type) {\r\n            unit = this.parseFragmentationUnit(rawData.subarray(nal_start_idx), header, dts, pts);\r\n        } else if (NALU.STAP_A === header.type || NALU.STAP_B === header.type) {\r\n            return this.parseAggregationPacket(rawData.subarray(nal_start_idx), header, dts, pts);\r\n        } else {\r\n            /* 30 - 31 is undefined, ignore those (RFC3984). */\r\n            Log.log('Undefined NAL unit, type: ' + header.type);\r\n            return null;\r\n        }\r\n        if (unit) {\r\n            return [unit];\r\n        }\r\n        return null;\r\n    }\r\n}\r\n","export class AACFrame {\r\n\r\n    constructor(data, dts, pts) {\r\n        this.dts = dts;\r\n        this.pts = pts ? pts : this.dts;\r\n\r\n        this.data=data;//.subarray(offset);\r\n    }\r\n\r\n    getData() {\r\n        return this.data;\r\n    }\r\n\r\n    getSize() {\r\n        return this.data.byteLength;\r\n    }\r\n}","import {AACFrame} from './AACFrame.js';\r\nimport {BitArray} from '../util/binary';\r\n// import {AACParser} from \"../parsers/aac.js\";\r\n// TODO: asm.js\r\nexport class AACAsm {\r\n    constructor() {\r\n        this.config = null;\r\n    }\r\n\r\n    onAACFragment(pkt) {\r\n        let rawData = pkt.getPayload();\r\n        if (!pkt.media) {\r\n            return null;\r\n        }\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n\r\n        let sizeLength = Number(pkt.media.fmtp['sizelength'] || 0);\r\n        let indexLength = Number(pkt.media.fmtp['indexlength'] || 0);\r\n        let indexDeltaLength = Number(pkt.media.fmtp['indexdeltalength'] || 0);\r\n        let CTSDeltaLength = Number(pkt.media.fmtp['ctsdeltalength'] || 0);\r\n        let DTSDeltaLength = Number(pkt.media.fmtp['dtsdeltalength'] || 0);\r\n        let RandomAccessIndication = Number(pkt.media.fmtp['randomaccessindication'] || 0);\r\n        let StreamStateIndication = Number(pkt.media.fmtp['streamstateindication'] || 0);\r\n        let AuxiliaryDataSizeLength = Number(pkt.media.fmtp['auxiliarydatasizelength'] || 0);\r\n\r\n        let configHeaderLength =\r\n            sizeLength + Math.max(indexLength, indexDeltaLength) + CTSDeltaLength + DTSDeltaLength +\r\n            RandomAccessIndication + StreamStateIndication + AuxiliaryDataSizeLength;\r\n\r\n\r\n        let auHeadersLengthPadded = 0;\r\n        let offset = 0;\r\n        let ts = (Math.round(pkt.getTimestampMS()/1024) << 10) * 90000 / this.config.samplerate;\r\n        if (0 !== configHeaderLength) {\r\n            /* The AU header section is not empty, read it from payload */\r\n            let auHeadersLengthInBits = data.getUint16(0); // Always 2 octets, without padding\r\n            auHeadersLengthPadded = 2 + (auHeadersLengthInBits>>>3) + ((auHeadersLengthInBits & 0x7)?1:0); // Add padding\r\n\r\n            //this.config = AACParser.parseAudioSpecificConfig(new Uint8Array(rawData, 0 , auHeadersLengthPadded));\r\n            // TODO: parse config\r\n            let frames = [];\r\n            let frameOffset=0;\r\n            let bits = new BitArray(rawData.subarray(2 + offset));\r\n            let cts = 0;\r\n            let dts = 0;\r\n            for (let offset=0; offset<auHeadersLengthInBits;) {\r\n                let size = bits.readBits(sizeLength);\r\n                let idx = bits.readBits(offset?indexDeltaLength:indexLength);\r\n                offset+=sizeLength+(offset?indexDeltaLength:indexLength)/*+2*/;\r\n                if (/*ctsPresent &&*/ CTSDeltaLength) {\r\n                    let ctsPresent = bits.readBits(1);\r\n                    cts = bits.readBits(CTSDeltaLength);\r\n                    offset+=CTSDeltaLength;\r\n                }\r\n                if (/*dtsPresent && */DTSDeltaLength) {\r\n                    let dtsPresent = bits.readBits(1);\r\n                    dts = bits.readBits(DTSDeltaLength);\r\n                    offset+=CTSDeltaLength;\r\n                }\r\n                if (RandomAccessIndication) {\r\n                    bits.skipBits(1);\r\n                    offset+=1;\r\n                }\r\n                if (StreamStateIndication) {\r\n                    bits.skipBits(StreamStateIndication);\r\n                    offset+=StreamStateIndication;\r\n                }\r\n                frames.push(new AACFrame(rawData.subarray(auHeadersLengthPadded + frameOffset, auHeadersLengthPadded + frameOffset + size), ts+dts, ts+cts));\r\n                frameOffset+=size;\r\n            }\r\n            return frames;\r\n        } else {\r\n            let aacData = rawData.subarray(auHeadersLengthPadded);\r\n            while (true) {\r\n                if (aacData[offset] !=255) break;\r\n                ++offset;\r\n            }\r\n            ++offset;\r\n            return [new AACFrame(rawData.subarray(auHeadersLengthPadded+offset), ts)];\r\n        }\r\n    }\r\n}","import {NALUAsm} from \"../../../../core/elementary/NALUAsm.js\";\r\nimport {AACAsm} from \"../../../../core/elementary/AACAsm.js\";\r\n\r\nexport class RTPPayloadParser {\r\n\r\n    constructor() {\r\n        this.h264parser = new RTPH264Parser();\r\n        this.aacparser = new RTPAACParser();\r\n    }\r\n\r\n    parse(rtp) {\r\n        if (rtp.media.type=='video') {\r\n            return this.h264parser.parse(rtp);\r\n        } else if (rtp.media.type == 'audio') {\r\n            return this.aacparser.parse(rtp);\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nclass RTPH264Parser {\r\n    constructor() {\r\n        this.naluasm = new NALUAsm();\r\n    }\r\n\r\n    parse(rtp) {\r\n        return this.naluasm.onNALUFragment(rtp.getPayload(), rtp.getTimestampMS());\r\n    }\r\n}\r\n\r\nclass RTPAACParser {\r\n\r\n    constructor() {\r\n        this.scale = 1;\r\n        this.asm = new AACAsm();\r\n    }\r\n\r\n    setConfig(conf) {\r\n        this.asm.config = conf;\r\n    }\r\n\r\n    parse(rtp) {\r\n        return this.asm.onAACFragment(rtp);\r\n    }\r\n}","import {Log} from '../deps/bp_logger.js';\r\nimport {EventEmitter} from '../deps/bp_event.js';\r\n\r\nexport class BaseClient {\r\n    constructor(options={flush: 100}) {\r\n        this.options = options;\r\n        this.eventSource = new EventEmitter();\r\n\r\n        Object.defineProperties(this, {\r\n            sourceUrl: {value: null, writable: true},   // TODO: getter with validator\r\n            paused: {value: true, writable: true},\r\n            seekable: {value: false, writable: true},\r\n            connected: {value: false, writable: true}\r\n        });\r\n\r\n        this._onData = ()=>{\r\n            if (this.connected) {\r\n                while (this.transport.dataQueue.length) {\r\n                    this.onData(this.transport.dataQueue.pop());\r\n                }\r\n            }\r\n        };\r\n        this._onConnect = this.onConnected.bind(this);\r\n        this._onDisconnect = this.onDisconnected.bind(this);\r\n    }\r\n\r\n    static streamType() {\r\n        return null;    \r\n    }\r\n    \r\n    destroy() {\r\n        this.detachTransport();\r\n    }\r\n\r\n    attachTransport(transport) {\r\n        if (this.transport) {\r\n            this.detachTransport();\r\n        }\r\n        this.transport = transport;\r\n        this.transport.eventSource.addEventListener('data', this._onData);\r\n        this.transport.eventSource.addEventListener('connected', this._onConnect);\r\n        this.transport.eventSource.addEventListener('disconnected', this._onDisconnect);\r\n    }\r\n\r\n    detachTransport() {\r\n        if (this.transport) {\r\n            this.transport.eventSource.removeEventListener('data', this._onData);\r\n            this.transport.eventSource.removeEventListener('connected', this._onConnect);\r\n            this.transport.eventSource.removeEventListener('disconnected', this._onDisconnect);\r\n            this.transport = null;\r\n        }\r\n    }\r\n    reset() {\r\n\r\n    }\r\n\r\n    start() {\r\n        Log.log('Client started');\r\n        this.paused = false;\r\n        // this.startStreamFlush();\r\n    }\r\n\r\n    stop() {\r\n        Log.log('Client paused');\r\n        this.paused = true;\r\n        // this.stopStreamFlush();\r\n    }\r\n\r\n    seek(timeOffset) {\r\n\r\n    }\r\n\r\n    setSource(source) {\r\n        this.stop();\r\n        this.endpoint = source;\r\n        this.sourceUrl = source.urlpath;\r\n    }\r\n\r\n    startStreamFlush() {\r\n        this.flushInterval = setInterval(()=>{\r\n            if (!this.paused) {\r\n                this.eventSource.dispatchEvent('flush');\r\n            }\r\n        }, this.options.flush);\r\n    }\r\n\r\n    stopStreamFlush() {\r\n        clearInterval(this.flushInterval);\r\n    }\r\n\r\n    onData(data) {\r\n\r\n    }\r\n\r\n    onConnected() {\r\n        if (!this.seekable) {\r\n            this.transport.dataQueue = [];\r\n            this.eventSource.dispatchEvent('clear');\r\n        }\r\n        this.connected = true;\r\n    }\r\n\r\n    onDisconnected() {\r\n        this.connected = false;\r\n    }\r\n\r\n    queryCredentials() {\r\n        return Promise.resolve();\r\n    }\r\n\r\n    setCredentials(user, password) {\r\n        this.endpoint.user = user;\r\n        this.endpoint.pass = password;\r\n        this.endpoint.auth = `${user}:${password}`;\r\n    }\r\n}","import {BitArray, bitSlice} from '../util/binary.js';\r\n\r\nexport class AACParser {\r\n    static get SampleRates() {return  [\r\n        96000, 88200,\r\n        64000, 48000,\r\n        44100, 32000,\r\n        24000, 22050,\r\n        16000, 12000,\r\n        11025, 8000,\r\n        7350];}\r\n\r\n    // static Profile = [\r\n    //     0: Null\r\n    //     1: AAC Main\r\n    //     2: AAC LC (Low Complexity)\r\n    //     3: AAC SSR (Scalable Sample Rate)\r\n    //     4: AAC LTP (Long Term Prediction)\r\n    //     5: SBR (Spectral Band Replication)\r\n    //     6: AAC Scalable\r\n    // ]\r\n\r\n    static parseAudioSpecificConfig(bytesOrBits) {\r\n        let config;\r\n        if (bytesOrBits.byteLength) { // is byteArray\r\n            config = new BitArray(bytesOrBits);\r\n        } else {\r\n            config = bytesOrBits;\r\n        }\r\n\r\n        let bitpos = config.bitpos+(config.src.byteOffset+config.bytepos)*8;\r\n        let prof = config.readBits(5);\r\n        this.codec = `mp4a.40.${prof}`;\r\n        let sfi = config.readBits(4);\r\n        if (sfi == 0xf) config.skipBits(24);\r\n        let channels = config.readBits(4);\r\n\r\n        return {\r\n            config: bitSlice(new Uint8Array(config.src.buffer), bitpos, bitpos+16),\r\n            codec: `mp4a.40.${prof}`,\r\n            samplerate: AACParser.SampleRates[sfi],\r\n            channels: channels\r\n        }\r\n    }\r\n\r\n    static parseStreamMuxConfig(bytes) {\r\n        // ISO_IEC_14496-3 Part 3 Audio. StreamMuxConfig\r\n        let config = new BitArray(bytes);\r\n\r\n        if (!config.readBits(1)) {\r\n            config.skipBits(14);\r\n            return AACParser.parseAudioSpecificConfig(config);\r\n        }\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\n\r\nimport {RTSPClientSM as RTSPClient} from './client.js';\r\nimport {Url} from '../../core/util/url.js';\r\nimport {RTSPError} from \"./client\";\r\n\r\nconst LOG_TAG = \"rtsp:session\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class RTSPSession {\r\n\r\n    constructor(client, sessionId) {\r\n        this.state = null;\r\n        this.client = client;\r\n        this.sessionId = sessionId;\r\n        this.url = this.getControlURL();\r\n    }\r\n\r\n    reset() {\r\n        this.client = null;\r\n    }\r\n\r\n    start() {\r\n        return this.sendPlay();\r\n    }\r\n\r\n    stop() {\r\n        return this.sendTeardown();\r\n    }\r\n\r\n    getControlURL() {\r\n        let ctrl = this.client.sdp.getSessionBlock().control;\r\n        if (Url.isAbsolute(ctrl)) {\r\n            return ctrl;\r\n        } else if (!ctrl || '*' === ctrl) {\r\n            return this.client.contentBase;\r\n        } else {\r\n            return `${this.client.contentBase}${ctrl}`;\r\n        }\r\n    }\r\n\r\n    sendRequest(_cmd, _params = {}) {\r\n        let params = {};\r\n        if (this.sessionId) {\r\n            params['Session'] = this.sessionId;\r\n        }\r\n        Object.assign(params, _params);\r\n        return this.client.sendRequest(_cmd, this.getControlURL(), params);\r\n    }\r\n\r\n    async sendPlay(pos = 0) {\r\n        this.state = RTSPClient.STATE_PLAY;\r\n        let params = {};\r\n        let range = this.client.sdp.sessionBlock.range;\r\n        if (range) {\r\n            // TODO: seekable\r\n            if (range[0] == -1) {\r\n                range[0] = 0;// Do not handle now at the moment\r\n            }\r\n            // params['Range'] = `${range[2]}=${range[0]}-`;\r\n        }\r\n        let data = await this.sendRequest('PLAY', params);\r\n        this.state = RTSPClient.STATE_PLAYING;\r\n        return {data: data};\r\n    }\r\n\r\n    async sendPause() {\r\n        if (!this.client.supports(\"PAUSE\")) {\r\n            return;\r\n        }\r\n        this.state = RTSPClient.STATE_PAUSE;\r\n        await this.sendRequest(\"PAUSE\");\r\n        this.state = RTSPClient.STATE_PAUSED;\r\n    }\r\n\r\n    async sendTeardown() {\r\n        if (this.state != RTSPClient.STATE_TEARDOWN) {\r\n            this.state = RTSPClient.STATE_TEARDOWN;\r\n            await this.sendRequest(\"TEARDOWN\");\r\n            Log.log('RTSPClient: STATE_TEARDOWN');\r\n            ///this.client.connection.disconnect();\r\n            // TODO: Notify client\r\n        }\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {StateMachine} from '../../deps/bp_statemachine.js';\r\nimport {SDPParser} from '../../core/parsers/sdp.js';\r\nimport {RTSPStream} from './stream.js';\r\nimport md5 from '../../core/util/md5';\r\n// import {RTP} from './rtp/rtp';\r\nimport RTPFactory from './rtp/factory.js';\r\nimport {MessageBuilder} from './message.js';\r\nimport {RTPPayloadParser} from './rtp/payload/parser.js';\r\nimport {BaseClient} from '../../core/base_client.js';\r\nimport {PayloadType} from '../../core/defs.js';\r\nimport {base64ToArrayBuffer, hexToByteArray} from '../../core/util/binary.js';\r\nimport {AACParser} from '../../core/parsers/aac.js';\r\nimport {RTSPSession} from \"./session\";\r\n\r\nconst LOG_TAG = \"client:rtsp\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class RTPError {\r\n    constructor(message, file, line) {\r\n        //super(message, file, line);\r\n    }\r\n}\r\n\r\nexport default class RTSPClient extends BaseClient {\r\n    constructor(options={flush: 200}) {\r\n        super(options);\r\n        this.clientSM = new RTSPClientSM(this);\r\n        this.clientSM.ontracks = (tracks) => {\r\n            this.eventSource.dispatchEvent('tracks', tracks);\r\n            this.startStreamFlush();\r\n        };\r\n        this.sampleQueues={};\r\n    }\r\n\r\n    static streamType() {\r\n        return 'rtsp';\r\n    }\r\n\r\n    setSource(url) {\r\n        super.setSource(url);\r\n        this.clientSM.setSource(url);\r\n    }\r\n    attachTransport(transport) {\r\n        super.attachTransport(transport);\r\n        this.clientSM.transport = transport;\r\n    }\r\n\r\n    detachTransport() {\r\n        super.detachTransport();\r\n        this.clientSM.transport = null;\r\n    }\r\n\r\n    reset() {\r\n        super.reset();\r\n        this.sampleQueues={};\r\n    }\r\n\r\n    destroy() {\r\n        this.clientSM.destroy();\r\n        return super.destroy();\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n        if (this.transport) {\r\n            return this.transport.ready.then(() => {\r\n                return this.clientSM.start();\r\n            });\r\n        } else {\r\n            return Promise.reject(\"no transport attached\");\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        super.stop();\r\n        return this.clientSM.stop();\r\n    }\r\n\r\n    onData(data) {\r\n        this.clientSM.onData(data);\r\n    }\r\n\r\n    onConnected() {\r\n        this.clientSM.onConnected();\r\n        super.onConnected();\r\n    }\r\n\r\n    onDisconnected() {\r\n        super.onDisconnected();\r\n        this.clientSM.onDisconnected();\r\n    }\r\n}\r\n\r\nclass AuthError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n    }\r\n}\r\n\r\nexport class RTSPError extends Error {\r\n    constructor(data) {\r\n        super(data.msg);\r\n        this.data = data;\r\n    }\r\n}\r\n\r\nexport class RTSPClientSM extends StateMachine {\r\n    static get USER_AGENT() {return 'SFRtsp 0.3';}\r\n    static get STATE_INITIAL() {return  1 << 0;}\r\n    static get STATE_OPTIONS() {return 1 << 1;}\r\n    static get STATE_DESCRIBE () {return  1 << 2;}\r\n    static get STATE_SETUP() {return  1 << 3;}\r\n    static get STATE_STREAMS() {return 1 << 4;}\r\n    static get STATE_TEARDOWN() {return  1 << 5;}\r\n    static get STATE_PLAY() {return  1 << 6;}\r\n    static get STATE_PLAYING() {return  1 << 7;}\r\n    static get STATE_PAUSE() {return  1 << 8;}\r\n    static get STATE_PAUSED() {return  1 << 9;}\r\n    // static STATE_PAUSED = 1 << 6;\r\n\r\n    constructor(parent) {\r\n        super();\r\n\r\n        this.parent = parent;\r\n        this.transport = null;\r\n        this.payParser = new RTPPayloadParser();\r\n        this.rtp_channels = new Set();\r\n        this.sessions = {};\r\n        this.ontracks = null;\r\n\r\n        this.addState(RTSPClientSM.STATE_INITIAL,{\r\n        }).addState(RTSPClientSM.STATE_OPTIONS, {\r\n            activate: this.sendOptions,\r\n            finishTransition: this.onOptions\r\n        }).addState(RTSPClientSM.STATE_DESCRIBE, {\r\n            activate: this.sendDescribe,\r\n            finishTransition: this.onDescribe\r\n        }).addState(RTSPClientSM.STATE_SETUP, {\r\n            activate: this.sendSetup,\r\n            finishTransition: this.onSetup\r\n        }).addState(RTSPClientSM.STATE_STREAMS, {\r\n\r\n        }).addState(RTSPClientSM.STATE_TEARDOWN, {\r\n            activate: ()=>{\r\n                this.started = false;\r\n            },\r\n            finishTransition: ()=>{\r\n                return this.transitionTo(RTSPClientSM.STATE_INITIAL)\r\n            }\r\n        }).addTransition(RTSPClientSM.STATE_INITIAL, RTSPClientSM.STATE_OPTIONS)\r\n            .addTransition(RTSPClientSM.STATE_INITIAL, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_OPTIONS, RTSPClientSM.STATE_DESCRIBE)\r\n            .addTransition(RTSPClientSM.STATE_DESCRIBE, RTSPClientSM.STATE_SETUP)\r\n            .addTransition(RTSPClientSM.STATE_SETUP, RTSPClientSM.STATE_STREAMS)\r\n            .addTransition(RTSPClientSM.STATE_TEARDOWN, RTSPClientSM.STATE_INITIAL)\r\n            // .addTransition(RTSPClientSM.STATE_STREAMS, RTSPClientSM.STATE_PAUSED)\r\n            // .addTransition(RTSPClientSM.STATE_PAUSED, RTSPClientSM.STATE_STREAMS)\r\n            .addTransition(RTSPClientSM.STATE_STREAMS, RTSPClientSM.STATE_TEARDOWN)\r\n            // .addTransition(RTSPClientSM.STATE_PAUSED, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_SETUP, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_DESCRIBE, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_OPTIONS, RTSPClientSM.STATE_TEARDOWN);\r\n\r\n        this.reset();\r\n\r\n        this.shouldReconnect = false;\r\n\r\n        // TODO: remove listeners\r\n        // this.connection.eventSource.addEventListener('connected', ()=>{\r\n        //     if (this.shouldReconnect) {\r\n        //         this.reconnect();\r\n        //     }\r\n        // });\r\n        // this.connection.eventSource.addEventListener('disconnected', ()=>{\r\n        //     if (this.started) {\r\n        //         this.shouldReconnect = true;\r\n        //     }\r\n        // });\r\n        // this.connection.eventSource.addEventListener('data', (data)=>{\r\n        //     let channel = new DataView(data).getUint8(1);\r\n        //     if (this.rtp_channels.has(channel)) {\r\n        //         this.onRTP({packet: new Uint8Array(data, 4), type: channel});\r\n        //     }\r\n        //\r\n        // });\r\n    }\r\n\r\n    destroy() {\r\n        this.parent = null;\r\n    }\r\n\r\n    setSource(url) {\r\n        this.reset();\r\n        this.endpoint = url;\r\n        this.url = `${url.protocol}://${url.location}${url.urlpath}`;\r\n    }\r\n\r\n    onConnected() {\r\n        if (this.rtpFactory) {\r\n            this.rtpFactory = null;\r\n        }\r\n        if (this.shouldReconnect) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    async onDisconnected() {\r\n        this.reset();\r\n        this.shouldReconnect = true;\r\n        await this.transitionTo(RTSPClientSM.STATE_TEARDOWN);\r\n        await this.transitionTo(RTSPClientSM.STATE_INITIAL);\r\n    }\r\n\r\n    start() {\r\n        if (this.currentState.name !== RTSPClientSM.STATE_STREAMS) {\r\n            return this.transitionTo(RTSPClientSM.STATE_OPTIONS);\r\n        } else {\r\n            // TODO: seekable\r\n            let promises = [];\r\n            for (let session in this.sessions) {\r\n                promises.push(this.sessions[session].sendPlay());\r\n            }\r\n            return Promise.all(promises);\r\n        }\r\n    }\r\n\r\n    onData(data) {\r\n        let channel = data[1];\r\n        if (this.rtp_channels.has(channel)) {\r\n            this.onRTP({packet: data.subarray(4), type: channel});\r\n        }\r\n    }\r\n\r\n    useRTPChannel(channel) {\r\n        this.rtp_channels.add(channel);\r\n    }\r\n\r\n    forgetRTPChannel(channel) {\r\n        this.rtp_channels.delete(channel);\r\n    }\r\n\r\n    stop() {\r\n        this.shouldReconnect = false;\r\n        let promises = [];\r\n        for (let session in this.sessions) {\r\n            promises.push(this.sessions[session].sendPause());\r\n        }\r\n        return Promise.all(promises);\r\n        // this.mse = null;\r\n    }\r\n\r\n    async reset() {\r\n        this.authenticator = '';\r\n        this.methods = [];\r\n        this.tracks = [];\r\n        this.rtpBuffer={};\r\n        for (let stream in this.streams) {\r\n            this.streams[stream].reset();\r\n        }\r\n        for (let session in this.sessions) {\r\n            this.sessions[session].reset();\r\n        }\r\n        this.streams={};\r\n        this.sessions={};\r\n        this.contentBase = \"\";\r\n        if (this.currentState) {\r\n            if (this.currentState.name != RTSPClientSM.STATE_INITIAL) {\r\n                await this.transitionTo(RTSPClientSM.STATE_TEARDOWN);\r\n                await this.transitionTo(RTSPClientSM.STATE_INITIAL);\r\n            }\r\n        } else {\r\n            await this.transitionTo(RTSPClientSM.STATE_INITIAL);\r\n        }\r\n        this.sdp = null;\r\n        this.interleaveChannelIndex = 0;\r\n        this.session = null;\r\n        this.timeOffset = {};\r\n        this.lastTimestamp = {};\r\n    }\r\n\r\n    async reconnect() {\r\n        //this.parent.eventSource.dispatchEvent('clear');\r\n        await this.reset();\r\n        if (this.currentState.name != RTSPClientSM.STATE_INITIAL) {\r\n            await this.transitionTo(RTSPClientSM.STATE_TEARDOWN);\r\n            return this.transitionTo(RTSPClientSM.STATE_OPTIONS);\r\n        } else {\r\n            return this.transitionTo(RTSPClientSM.STATE_OPTIONS);\r\n        }\r\n    }\r\n\r\n    supports(method) {\r\n        return this.methods.includes(method)\r\n    }\r\n\r\n    parse(_data) {\r\n        Log.debug(_data.payload);\r\n        let d=_data.payload.split('\\r\\n\\r\\n');\r\n        let parsed =  MessageBuilder.parse(d[0]);\r\n        let len = Number(parsed.headers['content-length']);\r\n        if (len) {\r\n            let d=_data.payload.split('\\r\\n\\r\\n');\r\n            parsed.body = d[1];\r\n        } else {\r\n            parsed.body=\"\";\r\n        }\r\n        return parsed\r\n    }\r\n\r\n    sendRequest(_cmd, _host, _params={}, _payload=null) {\r\n        this.cSeq++;\r\n        Object.assign(_params, {\r\n            CSeq: this.cSeq,\r\n            'User-Agent': RTSPClientSM.USER_AGENT\r\n        });\r\n        if (this.authenticator) {\r\n            _params['Authorization'] = this.authenticator(_cmd);\r\n        }\r\n        return this.send(MessageBuilder.build(_cmd, _host, _params, _payload), _cmd).catch((e)=>{\r\n            if ((e instanceof AuthError) && !_params['Authorization'] ) {\r\n                return this.sendRequest(_cmd, _host, _params, _payload);\r\n            } else {\r\n                throw e;\r\n            }\r\n        });\r\n    }\r\n\r\n    async send(_data, _method) {\r\n        if (this.transport) {\r\n            try {\r\n                await this.transport.ready;\r\n            } catch(e) {\r\n                this.onDisconnected();\r\n                throw e;\r\n            }\r\n            Log.debug(_data);\r\n            let response = await this.transport.send(_data);\r\n            let parsed = this.parse(response);\r\n            // TODO: parse status codes\r\n            if (parsed.code == 401 /*&& !this.authenticator */) {\r\n                Log.debug(parsed.headers['www-authenticate']);\r\n                let auth = parsed.headers['www-authenticate'];\r\n                let method = auth.substring(0, auth.indexOf(' '));\r\n                auth = auth.substr(method.length+1);\r\n                let chunks = auth.split(',');\r\n\r\n                let ep = this.parent.endpoint;\r\n                if (!ep.user || !ep.pass) {\r\n                    try {\r\n                        await this.parent.queryCredentials.call(this.parent);\r\n                    } catch (e) {\r\n                        throw new AuthError();\r\n                    }\r\n                }\r\n\r\n                if (method.toLowerCase() == 'digest') {\r\n                    let parsedChunks = {};\r\n                    for (let chunk of chunks) {\r\n                        let c = chunk.trim();\r\n                        let [k,v] = c.split('=');\r\n                        parsedChunks[k] = v.substr(1, v.length-2);\r\n                    }\r\n                    this.authenticator = (_method)=>{\r\n                        let ep = this.parent.endpoint;\r\n                        let ha1 = md5(`${ep.user}:${parsedChunks.realm}:${ep.pass}`);\r\n                        let ha2 = md5(`${_method}:${this.url}`);\r\n                        let response = md5(`${ha1}:${parsedChunks.nonce}:${ha2}`);\r\n                        let tail=''; // TODO: handle other params\r\n                        return `Digest username=\"${ep.user}\", realm=\"${parsedChunks.realm}\", nonce=\"${parsedChunks.nonce}\", uri=\"${this.url}\", response=\"${response}\"${tail}`;\r\n                    }\r\n                } else {\r\n                    this.authenticator = ()=>{return `Basic ${btoa(this.parent.endpoint.auth)}`;};\r\n                }\r\n\r\n                throw new AuthError(parsed);\r\n            }\r\n            if (parsed.code >= 300) {\r\n                Log.error(parsed.statusLine);\r\n                throw new RTSPError({msg: `RTSP error: ${parsed.code} ${parsed.statusLine}`, parsed: parsed});\r\n            }\r\n            return parsed;\r\n        } else {\r\n            return Promise.reject(\"No transport attached\");\r\n        }\r\n    }\r\n\r\n    sendOptions() {\r\n        this.reset();\r\n        this.started = true;\r\n        this.cSeq = 0;\r\n        return this.sendRequest('OPTIONS', '*', {});\r\n    }\r\n\r\n    onOptions(data) {\r\n        this.methods = data.headers['public'].split(',').map((e)=>e.trim());\r\n        this.transitionTo(RTSPClientSM.STATE_DESCRIBE);\r\n    }\r\n\r\n    sendDescribe() {\r\n        return this.sendRequest('DESCRIBE', this.url, {\r\n            'Accept': 'application/sdp'\r\n        }).then((data)=>{\r\n            this.sdp = new SDPParser();\r\n            return this.sdp.parse(data.body).catch(()=>{\r\n                throw new Error(\"Failed to parse SDP\");\r\n            }).then(()=>{return data;});\r\n        });\r\n    }\r\n\r\n    onDescribe(data) {\r\n        this.contentBase = data.headers['content-base'] || this.url;// `${this.endpoint.protocol}://${this.endpoint.location}${this.endpoint.urlpath}/`;\r\n        this.tracks = this.sdp.getMediaBlockList();\r\n        this.rtpFactory = new RTPFactory(this.sdp);\r\n\r\n        Log.log('SDP contained ' + this.tracks.length + ' track(s). Calling SETUP for each.');\r\n\r\n        if (data.headers['session']) {\r\n            this.session = data.headers['session'];\r\n        }\r\n\r\n        if (!this.tracks.length) {\r\n            throw new Error(\"No tracks in SDP\");\r\n        }\r\n\r\n        this.transitionTo(RTSPClientSM.STATE_SETUP);\r\n    }\r\n\r\n    sendSetup() {\r\n        let streams=[];\r\n        let lastPromise = null;\r\n\r\n        // TODO: select first video and first audio tracks\r\n        for (let track_type of this.tracks) {\r\n            Log.log(\"setup track: \"+track_type);\r\n            // if (track_type=='audio') continue;\r\n            // if (track_type=='video') continue;\r\n            let track = this.sdp.getMediaBlock(track_type);\r\n            if (!PayloadType.string_map[track.rtpmap[track.fmt[0]].name]) continue;\r\n\r\n            this.streams[track_type] = new RTSPStream(this, track);\r\n            let setupPromise = this.streams[track_type].start(lastPromise);\r\n            lastPromise = setupPromise;\r\n            this.parent.sampleQueues[PayloadType.string_map[track.rtpmap[track.fmt[0]].name]]=[];\r\n            this.rtpBuffer[track.fmt[0]]=[];\r\n            streams.push(setupPromise.then(({track, data})=>{\r\n                let timeOffset = 0;\r\n                this.timeOffset[track.fmt[0]] = 0;\r\n                try {\r\n                    let rtp_info = data.headers[\"rtp-info\"].split(';');\r\n                    for (let chunk of rtp_info) {\r\n                        let [key, val] = chunk.split(\"=\");\r\n                        if (key === \"rtptime\") {\r\n                            this.timeOffset[track.fmt[0]] = 0;//Number(val);\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // new Date().getTime();\r\n                }\r\n                let params = {\r\n                    timescale: 0,\r\n                    scaleFactor: 0\r\n                };\r\n                if (track.fmtp['sprop-parameter-sets']) {\r\n                    let sps_pps = track.fmtp['sprop-parameter-sets'].split(',');\r\n                    params = {\r\n                        sps:base64ToArrayBuffer(sps_pps[0]),\r\n                        pps:base64ToArrayBuffer(sps_pps[1])\r\n                    };\r\n                } else if (track.fmtp['config']) {\r\n                    let config = track.fmtp['config'];\r\n                    this.has_config = track.fmtp['cpresent']!='0';\r\n                    let generic = track.rtpmap[track.fmt[0]].name == 'MPEG4-GENERIC';\r\n                    if (generic) {\r\n                        params={config:\r\n                            AACParser.parseAudioSpecificConfig(hexToByteArray(config))\r\n                        };\r\n                        this.payParser.aacparser.setConfig(params.config);\r\n                    } else if (config) {\r\n                        // todo: parse audio specific config for mpeg4-generic\r\n                        params={config:\r\n                            AACParser.parseStreamMuxConfig(hexToByteArray(config))\r\n                        };\r\n                        this.payParser.aacparser.setConfig(params.config);\r\n                    }\r\n                }\r\n                params.duration = this.sdp.sessionBlock.range?this.sdp.sessionBlock.range[1]-this.sdp.sessionBlock.range[0]:1;\r\n                this.parent.seekable = (params.duration > 1);\r\n                let res = {\r\n                    track: track,\r\n                    offset: this.timeOffset[track.fmt[0]],\r\n                    type: PayloadType.string_map[track.rtpmap[track.fmt[0]].name],\r\n                    params: params,\r\n                    duration: params.duration\r\n                };\r\n                console.log(res, this.timeOffset);\r\n                let session = data.headers.session.split(';')[0];\r\n                if (!this.sessions[session]) {\r\n                    this.sessions[session] = new RTSPSession(this, session);\r\n                }\r\n                return res;\r\n            }));\r\n        }\r\n        return Promise.all(streams).then((tracks)=>{\r\n            let sessionPromises = [];\r\n            for (let session in this.sessions) {\r\n                sessionPromises.push(this.sessions[session].start());\r\n            }\r\n            return Promise.all(sessionPromises).then(()=>{\r\n                if (this.ontracks) {\r\n                    this.ontracks(tracks);\r\n                }\r\n            })\r\n        }).catch((e)=>{\r\n            console.error(e);\r\n            this.stop();\r\n            this.reset();\r\n        });\r\n    }\r\n\r\n    onSetup() {\r\n        this.transitionTo(RTSPClientSM.STATE_STREAMS);\r\n    }\r\n\r\n    onRTP(_data) {\r\n        if (!this.rtpFactory) return;\r\n\r\n        let rtp = this.rtpFactory.build(_data.packet, this.sdp);\r\n        if (!rtp.type) {\r\n            return;\r\n        }\r\n\r\n        if (this.timeOffset[rtp.pt] === undefined) {\r\n            //console.log(rtp.pt, this.timeOffset[rtp.pt]);\r\n            this.rtpBuffer[rtp.pt].push(rtp);\r\n            return;\r\n        }\r\n\r\n        if (this.lastTimestamp[rtp.pt] === undefined) {\r\n            this.lastTimestamp[rtp.pt] = rtp.timestamp-this.timeOffset[rtp.pt];\r\n        }\r\n\r\n        let queue = this.rtpBuffer[rtp.pt];\r\n        queue.push(rtp);\r\n\r\n        while (queue.length) {\r\n            let rtp = queue.shift();\r\n\r\n            rtp.timestamp = rtp.timestamp-this.timeOffset[rtp.pt]-this.lastTimestamp[rtp.pt];\r\n            // TODO: overflow\r\n            // if (rtp.timestamp < 0) {\r\n            //     rtp.timestamp = (rtp.timestamp + Number.MAX_SAFE_INTEGER) % 0x7fffffff;\r\n            // }\r\n            if (rtp.media) {\r\n                let pay = this.payParser.parse(rtp);\r\n                if (pay) {\r\n                    // if (typeof pay == typeof []) {\r\n                    this.parent.sampleQueues[rtp.type].push(pay);\r\n                    // } else {\r\n                    //     this.parent.sampleQueues[rtp.type].push([pay]);\r\n                    // }\r\n                } else {\r\n                    // this.parent.sampleQueues[rtp.type].push(pay);\r\n                }\r\n            }\r\n        }\r\n        // this.remuxer.feedRTP();\r\n    }\r\n}\r\n","// ASN.1 JavaScript decoder\r\n// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>\r\n\r\n// Permission to use, copy, modify, and/or distribute this software for any\r\n// purpose with or without fee is hereby granted, provided that the above\r\n// copyright notice and this permission notice appear in all copies.\r\n// \r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n/*jshint browser: true, strict: true, immed: true, latedef: true, undef: true, regexdash: false */\r\n/*global oids */\r\n\r\nvar hardLimit = 100,\r\n    ellipsis = \"\\u2026\",\r\n    DOM = {\r\n        tag: function (tagName, className) {\r\n            var t = document.createElement(tagName);\r\n            t.className = className;\r\n            return t;\r\n        },\r\n        text: function (str) {\r\n            return document.createTextNode(str);\r\n        }\r\n    };\r\n\r\nclass Stream {\r\n    static get hexDigits() {\r\n        return \"0123456789ABCDEF\";\r\n    };\r\n\r\n    static get reTime() {\r\n        return /^((?:1[89]|2\\d)?\\d\\d)(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])([01]\\d|2[0-3])(?:([0-5]\\d)(?:([0-5]\\d)(?:[.,](\\d{1,3}))?)?)?(Z|[-+](?:[0]\\d|1[0-2])([0-5]\\d)?)?$/;\r\n    }\r\n\r\n\r\n    constructor(enc, pos) {\r\n        if (enc instanceof Stream) {\r\n            this.enc = enc.enc;\r\n            this.pos = enc.pos;\r\n        } else {\r\n            this.enc = enc;\r\n            this.pos = pos;\r\n        }\r\n    }\r\n\r\n    get(pos) {\r\n        if (pos === undefined)\r\n            pos = this.pos++;\r\n        if (pos >= this.enc.length)\r\n            throw 'Requesting byte offset ' + pos + ' on a stream of length ' + this.enc.length;\r\n        return this.enc[pos];\r\n    };\r\n\r\n    hexByte(b) {\r\n        return Stream.hexDigits.charAt((b >> 4) & 0xF) + Stream.hexDigits.charAt(b & 0xF);\r\n    };\r\n\r\n    hexDump(start, end, raw) {\r\n        var s = \"\";\r\n        for (var i = start; i < end; ++i) {\r\n            s += this.hexByte(this.get(i));\r\n            if (raw !== true)\r\n                switch (i & 0xF) {\r\n                    case 0x7:\r\n                        s += \"  \";\r\n                        break;\r\n                    case 0xF:\r\n                        s += \"\\n\";\r\n                        break;\r\n                    default:\r\n                        s += \" \";\r\n                }\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseStringISO(start, end) {\r\n        var s = \"\";\r\n        for (var i = start; i < end; ++i)\r\n            s += String.fromCharCode(this.get(i));\r\n        return s;\r\n    };\r\n\r\n    parseStringUTF(start, end) {\r\n        var s = \"\";\r\n        for (var i = start; i < end;) {\r\n            var c = this.get(i++);\r\n            if (c < 128)\r\n                s += String.fromCharCode(c);\r\n            else if ((c > 191) && (c < 224))\r\n                s += String.fromCharCode(((c & 0x1F) << 6) | (this.get(i++) & 0x3F));\r\n            else\r\n                s += String.fromCharCode(((c & 0x0F) << 12) | ((this.get(i++) & 0x3F) << 6) | (this.get(i++) & 0x3F));\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseStringBMP(start, end) {\r\n        var str = \"\"\r\n        for (var i = start; i < end; i += 2) {\r\n            var high_byte = this.get(i);\r\n            var low_byte = this.get(i + 1);\r\n            str += String.fromCharCode((high_byte << 8) + low_byte);\r\n        }\r\n\r\n        return str;\r\n    };\r\n\r\n    parseTime(start, end) {\r\n        var s = this.parseStringISO(start, end),\r\n            m = Stream.reTime.exec(s);\r\n        if (!m)\r\n            return \"Unrecognized time: \" + s;\r\n        s = m[1] + \"-\" + m[2] + \"-\" + m[3] + \" \" + m[4];\r\n        if (m[5]) {\r\n            s += \":\" + m[5];\r\n            if (m[6]) {\r\n                s += \":\" + m[6];\r\n                if (m[7])\r\n                    s += \".\" + m[7];\r\n            }\r\n        }\r\n        if (m[8]) {\r\n            s += \" UTC\";\r\n            if (m[8] != 'Z') {\r\n                s += m[8];\r\n                if (m[9])\r\n                    s += \":\" + m[9];\r\n            }\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseInteger(start, end) {\r\n        //TODO support negative numbers\r\n        var len = end - start;\r\n        if (len > 4) {\r\n            len <<= 3;\r\n            var s = this.get(start);\r\n            if (s === 0)\r\n                len -= 8;\r\n            else\r\n                while (s < 128) {\r\n                    s <<= 1;\r\n                    --len;\r\n                }\r\n            return \"(\" + len + \" bit)\";\r\n        }\r\n        var n = 0;\r\n        for (var i = start; i < end; ++i)\r\n            n = (n << 8) | this.get(i);\r\n        return n;\r\n    };\r\n\r\n    parseBitString(start, end) {\r\n        var unusedBit = this.get(start),\r\n            lenBit = ((end - start - 1) << 3) - unusedBit,\r\n            s = \"(\" + lenBit + \" bit)\";\r\n        if (lenBit <= 20) {\r\n            var skip = unusedBit;\r\n            s += \" \";\r\n            for (var i = end - 1; i > start; --i) {\r\n                var b = this.get(i);\r\n                for (var j = skip; j < 8; ++j)\r\n                    s += (b >> j) & 1 ? \"1\" : \"0\";\r\n                skip = 0;\r\n            }\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseOctetString(start, end) {\r\n        var len = end - start,\r\n            s = \"(\" + len + \" byte) \";\r\n        if (len > hardLimit)\r\n            end = start + hardLimit;\r\n        for (var i = start; i < end; ++i)\r\n            s += this.hexByte(this.get(i)); //TODO: also try Latin1?\r\n        if (len > hardLimit)\r\n            s += ellipsis;\r\n        return s;\r\n    };\r\n\r\n    parseOID(start, end) {\r\n        var s = '',\r\n            n = 0,\r\n            bits = 0;\r\n        for (var i = start; i < end; ++i) {\r\n            var v = this.get(i);\r\n            n = (n << 7) | (v & 0x7F);\r\n            bits += 7;\r\n            if (!(v & 0x80)) { // finished\r\n                if (s === '') {\r\n                    var m = n < 80 ? n < 40 ? 0 : 1 : 2;\r\n                    s = m + \".\" + (n - m * 40);\r\n                } else\r\n                    s += \".\" + ((bits >= 31) ? \"bigint\" : n);\r\n                n = bits = 0;\r\n            }\r\n        }\r\n        return s;\r\n    };\r\n}\r\n\r\nexport class ASN1 {\r\n    static get reSeemsASCII() {\r\n        return /^[ -~]+$/;\r\n    }\r\n\r\n    constructor(stream, header, length, tag, sub) {\r\n        this.stream = stream;\r\n        this.header = header;\r\n        this.length = length;\r\n        this.tag = tag;\r\n        this.sub = sub;\r\n    }\r\n\r\n    typeName() {\r\n        if (this.tag === undefined)\r\n            return \"unknown\";\r\n        var tagClass = this.tag >> 6,\r\n            tagConstructed = (this.tag >> 5) & 1,\r\n            tagNumber = this.tag & 0x1F;\r\n        switch (tagClass) {\r\n            case 0: // universal\r\n                switch (tagNumber) {\r\n                    case 0x00:\r\n                        return \"EOC\";\r\n                    case 0x01:\r\n                        return \"BOOLEAN\";\r\n                    case 0x02:\r\n                        return \"INTEGER\";\r\n                    case 0x03:\r\n                        return \"BIT_STRING\";\r\n                    case 0x04:\r\n                        return \"OCTET_STRING\";\r\n                    case 0x05:\r\n                        return \"NULL\";\r\n                    case 0x06:\r\n                        return \"OBJECT_IDENTIFIER\";\r\n                    case 0x07:\r\n                        return \"ObjectDescriptor\";\r\n                    case 0x08:\r\n                        return \"EXTERNAL\";\r\n                    case 0x09:\r\n                        return \"REAL\";\r\n                    case 0x0A:\r\n                        return \"ENUMERATED\";\r\n                    case 0x0B:\r\n                        return \"EMBEDDED_PDV\";\r\n                    case 0x0C:\r\n                        return \"UTF8String\";\r\n                    case 0x10:\r\n                        return \"SEQUENCE\";\r\n                    case 0x11:\r\n                        return \"SET\";\r\n                    case 0x12:\r\n                        return \"NumericString\";\r\n                    case 0x13:\r\n                        return \"PrintableString\"; // ASCII subset\r\n                    case 0x14:\r\n                        return \"TeletexString\"; // aka T61String\r\n                    case 0x15:\r\n                        return \"VideotexString\";\r\n                    case 0x16:\r\n                        return \"IA5String\"; // ASCII\r\n                    case 0x17:\r\n                        return \"UTCTime\";\r\n                    case 0x18:\r\n                        return \"GeneralizedTime\";\r\n                    case 0x19:\r\n                        return \"GraphicString\";\r\n                    case 0x1A:\r\n                        return \"VisibleString\"; // ASCII subset\r\n                    case 0x1B:\r\n                        return \"GeneralString\";\r\n                    case 0x1C:\r\n                        return \"UniversalString\";\r\n                    case 0x1E:\r\n                        return \"BMPString\";\r\n                    default:\r\n                        return \"Universal_\" + tagNumber.toString(16);\r\n                }\r\n            case 1:\r\n                return \"Application_\" + tagNumber.toString(16);\r\n            case 2:\r\n                return \"[\" + tagNumber + \"]\"; // Context\r\n            case 3:\r\n                return \"Private_\" + tagNumber.toString(16);\r\n        }\r\n    }\r\n\r\n    content() {\r\n        if (this.tag === undefined)\r\n            return null;\r\n        var tagClass = this.tag >> 6,\r\n            tagNumber = this.tag & 0x1F,\r\n            content = this.posContent(),\r\n            len = Math.abs(this.length);\r\n        if (tagClass !== 0) { // universal\r\n            if (this.sub !== null)\r\n                return \"(\" + this.sub.length + \" elem)\";\r\n            //TODO: TRY TO PARSE ASCII STRING\r\n            var s = this.stream.parseStringISO(content, content + Math.min(len, hardLimit));\r\n            if (ASN1.reSeemsASCII.test(s))\r\n                return s.substring(0, 2 * hardLimit) + ((s.length > 2 * hardLimit) ? ellipsis : \"\");\r\n            else\r\n                return this.stream.parseOctetString(content, content + len);\r\n        }\r\n        switch (tagNumber) {\r\n            case 0x01: // BOOLEAN\r\n                return (this.stream.get(content) === 0) ? \"false\" : \"true\";\r\n            case 0x02: // INTEGER\r\n                return this.stream.parseInteger(content, content + len);\r\n            case 0x03: // BIT_STRING\r\n                return this.sub ? \"(\" + this.sub.length + \" elem)\" :\r\n                    this.stream.parseBitString(content, content + len);\r\n            case 0x04: // OCTET_STRING\r\n                return this.sub ? \"(\" + this.sub.length + \" elem)\" :\r\n                    this.stream.parseOctetString(content, content + len);\r\n            //case 0x05: // NULL\r\n            case 0x06: // OBJECT_IDENTIFIER\r\n                return this.stream.parseOID(content, content + len);\r\n            //case 0x07: // ObjectDescriptor\r\n            //case 0x08: // EXTERNAL\r\n            //case 0x09: // REAL\r\n            //case 0x0A: // ENUMERATED\r\n            //case 0x0B: // EMBEDDED_PDV\r\n            case 0x10: // SEQUENCE\r\n            case 0x11: // SET\r\n                return \"(\" + this.sub.length + \" elem)\";\r\n            case 0x0C: // UTF8String\r\n                return this.stream.parseStringUTF(content, content + len);\r\n            case 0x12: // NumericString\r\n            case 0x13: // PrintableString\r\n            case 0x14: // TeletexString\r\n            case 0x15: // VideotexString\r\n            case 0x16: // IA5String\r\n            //case 0x19: // GraphicString\r\n            case 0x1A: // VisibleString\r\n                //case 0x1B: // GeneralString\r\n                //case 0x1C: // UniversalString\r\n                return this.stream.parseStringISO(content, content + len);\r\n            case 0x1E: // BMPString\r\n                return this.stream.parseStringBMP(content, content + len);\r\n            case 0x17: // UTCTime\r\n            case 0x18: // GeneralizedTime\r\n                return this.stream.parseTime(content, content + len);\r\n        }\r\n        return null;\r\n    };\r\n\r\n    toString() {\r\n        return this.typeName() + \"@\" + this.stream.pos + \"[header:\" + this.header + \",length:\" + this.length + \",sub:\" + ((this.sub === null) ? 'null' : this.sub.length) + \"]\";\r\n    };\r\n\r\n    print(indent) {\r\n        if (indent === undefined) indent = '';\r\n        document.writeln(indent + this);\r\n        if (this.sub !== null) {\r\n            indent += '  ';\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                this.sub[i].print(indent);\r\n        }\r\n    };\r\n\r\n    toPrettyString(indent) {\r\n        if (indent === undefined) indent = '';\r\n        var s = indent + this.typeName() + \" @\" + this.stream.pos;\r\n        if (this.length >= 0)\r\n            s += \"+\";\r\n        s += this.length;\r\n        if (this.tag & 0x20)\r\n            s += \" (constructed)\";\r\n        else if (((this.tag == 0x03) || (this.tag == 0x04)) && (this.sub !== null))\r\n            s += \" (encapsulates)\";\r\n        s += \"\\n\";\r\n        if (this.sub !== null) {\r\n            indent += '  ';\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                s += this.sub[i].toPrettyString(indent);\r\n        }\r\n        return s;\r\n    };\r\n\r\n    toDOM() {\r\n        var node = DOM.tag(\"div\", \"node\");\r\n        node.asn1 = this;\r\n        var head = DOM.tag(\"div\", \"head\");\r\n        var s = this.typeName().replace(/_/g, \" \");\r\n        head.innerHTML = s;\r\n        var content = this.content();\r\n        if (content !== null) {\r\n            content = String(content).replace(/</g, \"&lt;\");\r\n            var preview = DOM.tag(\"span\", \"preview\");\r\n            preview.appendChild(DOM.text(content));\r\n            head.appendChild(preview);\r\n        }\r\n        node.appendChild(head);\r\n        this.node = node;\r\n        this.head = head;\r\n        var value = DOM.tag(\"div\", \"value\");\r\n        s = \"Offset: \" + this.stream.pos + \"<br/>\";\r\n        s += \"Length: \" + this.header + \"+\";\r\n        if (this.length >= 0)\r\n            s += this.length;\r\n        else\r\n            s += (-this.length) + \" (undefined)\";\r\n        if (this.tag & 0x20)\r\n            s += \"<br/>(constructed)\";\r\n        else if (((this.tag == 0x03) || (this.tag == 0x04)) && (this.sub !== null))\r\n            s += \"<br/>(encapsulates)\";\r\n        //TODO if (this.tag == 0x03) s += \"Unused bits: \"\r\n        if (content !== null) {\r\n            s += \"<br/>Value:<br/><b>\" + content + \"</b>\";\r\n            if ((typeof oids === 'object') && (this.tag == 0x06)) {\r\n                var oid = oids[content];\r\n                if (oid) {\r\n                    if (oid.d) s += \"<br/>\" + oid.d;\r\n                    if (oid.c) s += \"<br/>\" + oid.c;\r\n                    if (oid.w) s += \"<br/>(warning!)\";\r\n                }\r\n            }\r\n        }\r\n        value.innerHTML = s;\r\n        node.appendChild(value);\r\n        var sub = DOM.tag(\"div\", \"sub\");\r\n        if (this.sub !== null) {\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                sub.appendChild(this.sub[i].toDOM());\r\n        }\r\n        node.appendChild(sub);\r\n        head.onclick = function () {\r\n            node.className = (node.className == \"node collapsed\") ? \"node\" : \"node collapsed\";\r\n        };\r\n        return node;\r\n    };\r\n\r\n    posStart() {\r\n        return this.stream.pos;\r\n    };\r\n\r\n    posContent() {\r\n        return this.stream.pos + this.header;\r\n    };\r\n\r\n    posEnd() {\r\n        return this.stream.pos + this.header + Math.abs(this.length);\r\n    };\r\n\r\n    fakeHover(current) {\r\n        this.node.className += \" hover\";\r\n        if (current)\r\n            this.head.className += \" hover\";\r\n    };\r\n\r\n    fakeOut(current) {\r\n        var re = / ?hover/;\r\n        this.node.className = this.node.className.replace(re, \"\");\r\n        if (current)\r\n            this.head.className = this.head.className.replace(re, \"\");\r\n    };\r\n\r\n    toHexDOM_sub(node, className, stream, start, end) {\r\n        if (start >= end)\r\n            return;\r\n        var sub = DOM.tag(\"span\", className);\r\n        sub.appendChild(DOM.text(\r\n            stream.hexDump(start, end)));\r\n        node.appendChild(sub);\r\n    };\r\n\r\n    toHexDOM(root) {\r\n        var node = DOM.tag(\"span\", \"hex\");\r\n        if (root === undefined) root = node;\r\n        this.head.hexNode = node;\r\n        this.head.onmouseover = function () {\r\n            this.hexNode.className = \"hexCurrent\";\r\n        };\r\n        this.head.onmouseout = function () {\r\n            this.hexNode.className = \"hex\";\r\n        };\r\n        node.asn1 = this;\r\n        node.onmouseover = function () {\r\n            var current = !root.selected;\r\n            if (current) {\r\n                root.selected = this.asn1;\r\n                this.className = \"hexCurrent\";\r\n            }\r\n            this.asn1.fakeHover(current);\r\n        };\r\n        node.onmouseout = function () {\r\n            var current = (root.selected == this.asn1);\r\n            this.asn1.fakeOut(current);\r\n            if (current) {\r\n                root.selected = null;\r\n                this.className = \"hex\";\r\n            }\r\n        };\r\n        this.toHexDOM_sub(node, \"tag\", this.stream, this.posStart(), this.posStart() + 1);\r\n        this.toHexDOM_sub(node, (this.length >= 0) ? \"dlen\" : \"ulen\", this.stream, this.posStart() + 1, this.posContent());\r\n        if (this.sub === null)\r\n            node.appendChild(DOM.text(\r\n                this.stream.hexDump(this.posContent(), this.posEnd())));\r\n        else if (this.sub.length > 0) {\r\n            var first = this.sub[0];\r\n            var last = this.sub[this.sub.length - 1];\r\n            this.toHexDOM_sub(node, \"intro\", this.stream, this.posContent(), first.posStart());\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                node.appendChild(this.sub[i].toHexDOM(root));\r\n            this.toHexDOM_sub(node, \"outro\", this.stream, last.posEnd(), this.posEnd());\r\n        }\r\n        return node;\r\n    };\r\n\r\n    toHexString(root) {\r\n        return this.stream.hexDump(this.posStart(), this.posEnd(), true);\r\n    };\r\n\r\n}\r\n\r\nASN1.decodeLength = function (stream) {\r\n    var buf = stream.get(),\r\n        len = buf & 0x7F;\r\n    if (len == buf)\r\n        return len;\r\n    if (len > 3)\r\n        throw \"Length over 24 bits not supported at position \" + (stream.pos - 1);\r\n    if (len === 0)\r\n        return -1; // undefined\r\n    buf = 0;\r\n    for (var i = 0; i < len; ++i)\r\n        buf = (buf << 8) | stream.get();\r\n    return buf;\r\n};\r\nASN1.hasContent = function (tag, len, stream) {\r\n    if (tag & 0x20) // constructed\r\n        return true;\r\n    if ((tag < 0x03) || (tag > 0x04))\r\n        return false;\r\n    var p = new Stream(stream);\r\n    if (tag == 0x03) p.get(); // BitString unused bits, must be in [0, 7]\r\n    var subTag = p.get();\r\n    if ((subTag >> 6) & 0x01) // not (universal or context)\r\n        return false;\r\n    try {\r\n        var subLength = ASN1.decodeLength(p);\r\n        return ((p.pos - stream.pos) + subLength == len);\r\n    } catch (exception) {\r\n        return false;\r\n    }\r\n};\r\nASN1.decode = function (stream) {\r\n    if (!(stream instanceof Stream))\r\n        stream = new Stream(stream, 0);\r\n    var streamStart = new Stream(stream),\r\n        tag = stream.get(),\r\n        len = ASN1.decodeLength(stream),\r\n        header = stream.pos - streamStart.pos,\r\n        sub = null;\r\n    if (ASN1.hasContent(tag, len, stream)) {\r\n        // it has content, so we decode it\r\n        var start = stream.pos;\r\n        if (tag == 0x03) stream.get(); // skip BitString unused bits, must be in [0, 7]\r\n        sub = [];\r\n        if (len >= 0) {\r\n            // definite length\r\n            var end = start + len;\r\n            while (stream.pos < end)\r\n                sub[sub.length] = ASN1.decode(stream);\r\n            if (stream.pos != end)\r\n                throw \"Content size is not correct for container starting at offset \" + start;\r\n        } else {\r\n            // undefined length\r\n            try {\r\n                for (; ;) {\r\n                    var s = ASN1.decode(stream);\r\n                    if (s.tag === 0)\r\n                        break;\r\n                    sub[sub.length] = s;\r\n                }\r\n                len = start - stream.pos;\r\n            } catch (e) {\r\n                throw \"Exception while decoding undefined length content: \" + e;\r\n            }\r\n        }\r\n    } else\r\n        stream.pos += len; // skip content\r\n    return new ASN1(streamStart, header, len, tag, sub);\r\n};\r\nASN1.test = function () {\r\n    var test = [\r\n        {value: [0x27], expected: 0x27},\r\n        {value: [0x81, 0xC9], expected: 0xC9},\r\n        {value: [0x83, 0xFE, 0xDC, 0xBA], expected: 0xFEDCBA}\r\n    ];\r\n    for (var i = 0, max = test.length; i < max; ++i) {\r\n        var pos = 0,\r\n            stream = new Stream(test[i].value, 0),\r\n            res = ASN1.decodeLength(stream);\r\n        if (res != test[i].expected)\r\n            document.write(\"In test[\" + i + \"] expected \" + test[i].expected + \" got \" + res + \"\\n\");\r\n    }\r\n};","// prng4.js - uses Arcfour as a PRNG\r\n\r\nexport class Arcfour {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.j = 0;\r\n    this.S = [];\r\n  }\r\n}\r\n\r\n// Initialize arcfour context from key, an array of ints, each from [0..255]\r\nfunction ARC4init(key) {\r\n  var i, j, t;\r\n  for(i = 0; i < 256; ++i)\r\n    this.S[i] = i;\r\n  j = 0;\r\n  for(i = 0; i < 256; ++i) {\r\n    j = (j + this.S[i] + key[i % key.length]) & 255;\r\n    t = this.S[i];\r\n    this.S[i] = this.S[j];\r\n    this.S[j] = t;\r\n  }\r\n  this.i = 0;\r\n  this.j = 0;\r\n}\r\n\r\nfunction ARC4next() {\r\n  var t;\r\n  this.i = (this.i + 1) & 255;\r\n  this.j = (this.j + this.S[this.i]) & 255;\r\n  t = this.S[this.i];\r\n  this.S[this.i] = this.S[this.j];\r\n  this.S[this.j] = t;\r\n  return this.S[(t + this.S[this.i]) & 255];\r\n}\r\n\r\nArcfour.prototype.init = ARC4init;\r\nArcfour.prototype.next = ARC4next;\r\n\r\n// Plug in your RNG constructor here\r\nexport function prng_newstate() {\r\n  return new Arcfour();\r\n}\r\n\r\n// Pool size must be a multiple of 4 and greater than 32.\r\n// An array of bytes the size of the pool will be passed to init()\r\nexport var rng_psize = 256;\r\n","import {rng_psize} from \"./prng4\";\r\nimport {prng_newstate} from \"./prng4\";\r\n// Random number generator - requires a PRNG backend, e.g. prng4.js\r\nvar rng_state;\r\nvar rng_pool;\r\nvar rng_pptr;\r\n\r\n// Initialize the pool with junk if needed.\r\nif(rng_pool == null) {\r\n  rng_pool = new Array();\r\n  rng_pptr = 0;\r\n  var t;\r\n  if(window.crypto && window.crypto.getRandomValues) {\r\n    // Extract entropy (2048 bits) from RNG if available\r\n    var z = new Uint32Array(256);\r\n    window.crypto.getRandomValues(z);\r\n    for (t = 0; t < z.length; ++t)\r\n      rng_pool[rng_pptr++] = z[t] & 255;\r\n  }\r\n\r\n  // Use mouse events for entropy, if we do not have enough entropy by the time\r\n  // we need it, entropy will be generated by Math.random.\r\n  var onMouseMoveListener = function(ev) {\r\n    this.count = this.count || 0;\r\n    if (this.count >= 256 || rng_pptr >= rng_psize) {\r\n      if (window.removeEventListener)\r\n        window.removeEventListener(\"mousemove\", onMouseMoveListener, false);\r\n      else if (window.detachEvent)\r\n        window.detachEvent(\"onmousemove\", onMouseMoveListener);\r\n      return;\r\n    }\r\n    try {\r\n      var mouseCoordinates = ev.x + ev.y;\r\n      rng_pool[rng_pptr++] = mouseCoordinates & 255;\r\n      this.count += 1;\r\n    } catch (e) {\r\n      // Sometimes Firefox will deny permission to access event properties for some reason. Ignore.\r\n    }\r\n  };\r\n  if (window.addEventListener)\r\n    window.addEventListener(\"mousemove\", onMouseMoveListener, false);\r\n  else if (window.attachEvent)\r\n    window.attachEvent(\"onmousemove\", onMouseMoveListener);\r\n\r\n}\r\n\r\nfunction rng_get_byte() {\r\n  if(rng_state == null) {\r\n    rng_state = prng_newstate();\r\n    // At this point, we may not have collected enough entropy.  If not, fall back to Math.random\r\n    while (rng_pptr < rng_psize) {\r\n      var random = Math.floor(65536 * Math.random());\r\n      rng_pool[rng_pptr++] = random & 255;\r\n    }\r\n    rng_state.init(rng_pool);\r\n    for(rng_pptr = 0; rng_pptr < rng_pool.length; ++rng_pptr)\r\n      rng_pool[rng_pptr] = 0;\r\n    rng_pptr = 0;\r\n  }\r\n  // TODO: allow reseeding after first request\r\n  return rng_state.next();\r\n}\r\n\r\nfunction rng_get_bytes(ba) {\r\n  var i;\r\n  for(i = 0; i < ba.length; ++i) ba[i] = rng_get_byte();\r\n}\r\n\r\nexport class SecureRandom {\r\n  constructor(){}\r\n}\r\n\r\nSecureRandom.prototype.nextBytes = rng_get_bytes;\r\n","// Copyright (c) 2005  Tom Wu\r\n// All Rights Reserved.\r\n// See \"LICENSE\" for details.\r\n\r\n// Basic JavaScript BN library - subset useful for RSA encryption.\r\n\r\n// Bits per digit\r\nvar dbits;\r\n\r\n// JavaScript engine analysis\r\nvar canary = 0xdeadbeefcafe;\r\nvar j_lm = ((canary&0xffffff)==0xefcafe);\r\n\r\n// (public) Constructor\r\nexport class BigInteger {\r\n  constructor(a,b,c) {\r\n    if (a != null)\r\n      if (\"number\" == typeof a) this.fromNumber(a, b, c);\r\n      else if (b == null && \"string\" != typeof a) this.fromString(a, 256);\r\n      else this.fromString(a, b);\r\n  }\r\n}\r\n\r\n// return new, unset BigInteger\r\nexport function nbi() { return new BigInteger(null); }\r\n\r\n// am: Compute w_j += (x*this_i), propagate carries,\r\n// c is initial carry, returns final carry.\r\n// c < 3*dvalue, x < 2*dvalue, this_i < dvalue\r\n// We need to select the fastest one that works in this environment.\r\n\r\n// am1: use a single mult and divide to get the high bits,\r\n// max digit bits should be 26 because\r\n// max internal value = 2*dvalue^2-2*dvalue (< 2^53)\r\nfunction am1(i,x,w,j,c,n) {\r\n  while(--n >= 0) {\r\n    var v = x*this[i++]+w[j]+c;\r\n    c = Math.floor(v/0x4000000);\r\n    w[j++] = v&0x3ffffff;\r\n  }\r\n  return c;\r\n}\r\n// am2 avoids a big mult-and-extract completely.\r\n// Max digit bits should be <= 30 because we do bitwise ops\r\n// on values up to 2*hdvalue^2-hdvalue-1 (< 2^31)\r\nfunction am2(i,x,w,j,c,n) {\r\n  var xl = x&0x7fff, xh = x>>15;\r\n  while(--n >= 0) {\r\n    var l = this[i]&0x7fff;\r\n    var h = this[i++]>>15;\r\n    var m = xh*l+h*xl;\r\n    l = xl*l+((m&0x7fff)<<15)+w[j]+(c&0x3fffffff);\r\n    c = (l>>>30)+(m>>>15)+xh*h+(c>>>30);\r\n    w[j++] = l&0x3fffffff;\r\n  }\r\n  return c;\r\n}\r\n// Alternately, set max digit bits to 28 since some\r\n// browsers slow down when dealing with 32-bit numbers.\r\nfunction am3(i,x,w,j,c,n) {\r\n  var xl = x&0x3fff, xh = x>>14;\r\n  while(--n >= 0) {\r\n    var l = this[i]&0x3fff;\r\n    var h = this[i++]>>14;\r\n    var m = xh*l+h*xl;\r\n    l = xl*l+((m&0x3fff)<<14)+w[j]+c;\r\n    c = (l>>28)+(m>>14)+xh*h;\r\n    w[j++] = l&0xfffffff;\r\n  }\r\n  return c;\r\n}\r\nif(j_lm && (navigator.appName == \"Microsoft Internet Explorer\")) {\r\n  BigInteger.prototype.am = am2;\r\n  dbits = 30;\r\n}\r\nelse if(j_lm && (navigator.appName != \"Netscape\")) {\r\n  BigInteger.prototype.am = am1;\r\n  dbits = 26;\r\n}\r\nelse { // Mozilla/Netscape seems to prefer am3\r\n  BigInteger.prototype.am = am3;\r\n  dbits = 28;\r\n}\r\n\r\nBigInteger.prototype.DB = dbits;\r\nBigInteger.prototype.DM = ((1<<dbits)-1);\r\nBigInteger.prototype.DV = (1<<dbits);\r\n\r\nvar BI_FP = 52;\r\nBigInteger.prototype.FV = Math.pow(2,BI_FP);\r\nBigInteger.prototype.F1 = BI_FP-dbits;\r\nBigInteger.prototype.F2 = 2*dbits-BI_FP;\r\n\r\n// Digit conversions\r\nvar BI_RM = \"0123456789abcdefghijklmnopqrstuvwxyz\";\r\nvar BI_RC = [];\r\nvar rr,vv;\r\nrr = \"0\".charCodeAt(0);\r\nfor(vv = 0; vv <= 9; ++vv) BI_RC[rr++] = vv;\r\nrr = \"a\".charCodeAt(0);\r\nfor(vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;\r\nrr = \"A\".charCodeAt(0);\r\nfor(vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;\r\n\r\nexport function int2char(n) { return BI_RM.charAt(n); }\r\nexport function intAt(s,i) {\r\n  var c = BI_RC[s.charCodeAt(i)];\r\n  return (c==null)?-1:c;\r\n}\r\n\r\n// (protected) copy this to r\r\nfunction bnpCopyTo(r) {\r\n  for(var i = this.t-1; i >= 0; --i) r[i] = this[i];\r\n  r.t = this.t;\r\n  r.s = this.s;\r\n}\r\n\r\n// (protected) set from integer value x, -DV <= x < DV\r\nfunction bnpFromInt(x) {\r\n  this.t = 1;\r\n  this.s = (x<0)?-1:0;\r\n  if(x > 0) this[0] = x;\r\n  else if(x < -1) this[0] = x+this.DV;\r\n  else this.t = 0;\r\n}\r\n\r\n// return bigint initialized to value\r\nexport function nbv(i) { var r = nbi(); r.fromInt(i); return r; }\r\n\r\n// (protected) set from string and radix\r\nfunction bnpFromString(s,b) {\r\n  var k;\r\n  if(b == 16) k = 4;\r\n  else if(b == 8) k = 3;\r\n  else if(b == 256) k = 8; // byte array\r\n  else if(b == 2) k = 1;\r\n  else if(b == 32) k = 5;\r\n  else if(b == 4) k = 2;\r\n  else { this.fromRadix(s,b); return; }\r\n  this.t = 0;\r\n  this.s = 0;\r\n  var i = s.length, mi = false, sh = 0;\r\n  while(--i >= 0) {\r\n    var x = (k==8)?s[i]&0xff:intAt(s,i);\r\n    if(x < 0) {\r\n      if(s.charAt(i) == \"-\") mi = true;\r\n      continue;\r\n    }\r\n    mi = false;\r\n    if(sh == 0)\r\n      this[this.t++] = x;\r\n    else if(sh+k > this.DB) {\r\n      this[this.t-1] |= (x&((1<<(this.DB-sh))-1))<<sh;\r\n      this[this.t++] = (x>>(this.DB-sh));\r\n    }\r\n    else\r\n      this[this.t-1] |= x<<sh;\r\n    sh += k;\r\n    if(sh >= this.DB) sh -= this.DB;\r\n  }\r\n  if(k == 8 && (s[0]&0x80) != 0) {\r\n    this.s = -1;\r\n    if(sh > 0) this[this.t-1] |= ((1<<(this.DB-sh))-1)<<sh;\r\n  }\r\n  this.clamp();\r\n  if(mi) BigInteger.ZERO.subTo(this,this);\r\n}\r\n\r\n// (protected) clamp off excess high words\r\nfunction bnpClamp() {\r\n  var c = this.s&this.DM;\r\n  while(this.t > 0 && this[this.t-1] == c) --this.t;\r\n}\r\n\r\n// (public) return string representation in given radix\r\nfunction bnToString(b) {\r\n  if(this.s < 0) return \"-\"+this.negate().toString(b);\r\n  var k;\r\n  if(b == 16) k = 4;\r\n  else if(b == 8) k = 3;\r\n  else if(b == 2) k = 1;\r\n  else if(b == 32) k = 5;\r\n  else if(b == 4) k = 2;\r\n  else return this.toRadix(b);\r\n  var km = (1<<k)-1, d, m = false, r = \"\", i = this.t;\r\n  var p = this.DB-(i*this.DB)%k;\r\n  if(i-- > 0) {\r\n    if(p < this.DB && (d = this[i]>>p) > 0) { m = true; r = int2char(d); }\r\n    while(i >= 0) {\r\n      if(p < k) {\r\n        d = (this[i]&((1<<p)-1))<<(k-p);\r\n        d |= this[--i]>>(p+=this.DB-k);\r\n      }\r\n      else {\r\n        d = (this[i]>>(p-=k))&km;\r\n        if(p <= 0) { p += this.DB; --i; }\r\n      }\r\n      if(d > 0) m = true;\r\n      if(m) r += int2char(d);\r\n    }\r\n  }\r\n  return m?r:\"0\";\r\n}\r\n\r\n// (public) -this\r\nfunction bnNegate() { var r = nbi(); BigInteger.ZERO.subTo(this,r); return r; }\r\n\r\n// (public) |this|\r\nfunction bnAbs() { return (this.s<0)?this.negate():this; }\r\n\r\n// (public) return + if this > a, - if this < a, 0 if equal\r\nfunction bnCompareTo(a) {\r\n  var r = this.s-a.s;\r\n  if(r != 0) return r;\r\n  var i = this.t;\r\n  r = i-a.t;\r\n  if(r != 0) return (this.s<0)?-r:r;\r\n  while(--i >= 0) if((r=this[i]-a[i]) != 0) return r;\r\n  return 0;\r\n}\r\n\r\n// returns bit length of the integer x\r\nexport function nbits(x) {\r\n  var r = 1, t;\r\n  if((t=x>>>16) != 0) { x = t; r += 16; }\r\n  if((t=x>>8) != 0) { x = t; r += 8; }\r\n  if((t=x>>4) != 0) { x = t; r += 4; }\r\n  if((t=x>>2) != 0) { x = t; r += 2; }\r\n  if((t=x>>1) != 0) { x = t; r += 1; }\r\n  return r;\r\n}\r\n\r\n// (public) return the number of bits in \"this\"\r\nfunction bnBitLength() {\r\n  if(this.t <= 0) return 0;\r\n  return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM));\r\n}\r\n\r\n// (protected) r = this << n*DB\r\nfunction bnpDLShiftTo(n,r) {\r\n  var i;\r\n  for(i = this.t-1; i >= 0; --i) r[i+n] = this[i];\r\n  for(i = n-1; i >= 0; --i) r[i] = 0;\r\n  r.t = this.t+n;\r\n  r.s = this.s;\r\n}\r\n\r\n// (protected) r = this >> n*DB\r\nfunction bnpDRShiftTo(n,r) {\r\n  for(var i = n; i < this.t; ++i) r[i-n] = this[i];\r\n  r.t = Math.max(this.t-n,0);\r\n  r.s = this.s;\r\n}\r\n\r\n// (protected) r = this << n\r\nfunction bnpLShiftTo(n,r) {\r\n  var bs = n%this.DB;\r\n  var cbs = this.DB-bs;\r\n  var bm = (1<<cbs)-1;\r\n  var ds = Math.floor(n/this.DB), c = (this.s<<bs)&this.DM, i;\r\n  for(i = this.t-1; i >= 0; --i) {\r\n    r[i+ds+1] = (this[i]>>cbs)|c;\r\n    c = (this[i]&bm)<<bs;\r\n  }\r\n  for(i = ds-1; i >= 0; --i) r[i] = 0;\r\n  r[ds] = c;\r\n  r.t = this.t+ds+1;\r\n  r.s = this.s;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = this >> n\r\nfunction bnpRShiftTo(n,r) {\r\n  r.s = this.s;\r\n  var ds = Math.floor(n/this.DB);\r\n  if(ds >= this.t) { r.t = 0; return; }\r\n  var bs = n%this.DB;\r\n  var cbs = this.DB-bs;\r\n  var bm = (1<<bs)-1;\r\n  r[0] = this[ds]>>bs;\r\n  for(var i = ds+1; i < this.t; ++i) {\r\n    r[i-ds-1] |= (this[i]&bm)<<cbs;\r\n    r[i-ds] = this[i]>>bs;\r\n  }\r\n  if(bs > 0) r[this.t-ds-1] |= (this.s&bm)<<cbs;\r\n  r.t = this.t-ds;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = this - a\r\nfunction bnpSubTo(a,r) {\r\n  var i = 0, c = 0, m = Math.min(a.t,this.t);\r\n  while(i < m) {\r\n    c += this[i]-a[i];\r\n    r[i++] = c&this.DM;\r\n    c >>= this.DB;\r\n  }\r\n  if(a.t < this.t) {\r\n    c -= a.s;\r\n    while(i < this.t) {\r\n      c += this[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c += this.s;\r\n  }\r\n  else {\r\n    c += this.s;\r\n    while(i < a.t) {\r\n      c -= a[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c -= a.s;\r\n  }\r\n  r.s = (c<0)?-1:0;\r\n  if(c < -1) r[i++] = this.DV+c;\r\n  else if(c > 0) r[i++] = c;\r\n  r.t = i;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = this * a, r != this,a (HAC 14.12)\r\n// \"this\" should be the larger one if appropriate.\r\nfunction bnpMultiplyTo(a,r) {\r\n  var x = this.abs(), y = a.abs();\r\n  var i = x.t;\r\n  r.t = i+y.t;\r\n  while(--i >= 0) r[i] = 0;\r\n  for(i = 0; i < y.t; ++i) r[i+x.t] = x.am(0,y[i],r,i,0,x.t);\r\n  r.s = 0;\r\n  r.clamp();\r\n  if(this.s != a.s) BigInteger.ZERO.subTo(r,r);\r\n}\r\n\r\n// (protected) r = this^2, r != this (HAC 14.16)\r\nfunction bnpSquareTo(r) {\r\n  var x = this.abs();\r\n  var i = r.t = 2*x.t;\r\n  while(--i >= 0) r[i] = 0;\r\n  for(i = 0; i < x.t-1; ++i) {\r\n    var c = x.am(i,x[i],r,2*i,0,1);\r\n    if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1)) >= x.DV) {\r\n      r[i+x.t] -= x.DV;\r\n      r[i+x.t+1] = 1;\r\n    }\r\n  }\r\n  if(r.t > 0) r[r.t-1] += x.am(i,x[i],r,2*i,0,1);\r\n  r.s = 0;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) divide this by m, quotient and remainder to q, r (HAC 14.20)\r\n// r != q, this != m.  q or r may be null.\r\nfunction bnpDivRemTo(m,q,r) {\r\n  var pm = m.abs();\r\n  if(pm.t <= 0) return;\r\n  var pt = this.abs();\r\n  if(pt.t < pm.t) {\r\n    if(q != null) q.fromInt(0);\r\n    if(r != null) this.copyTo(r);\r\n    return;\r\n  }\r\n  if(r == null) r = nbi();\r\n  var y = nbi(), ts = this.s, ms = m.s;\r\n  var nsh = this.DB-nbits(pm[pm.t-1]);\t// normalize modulus\r\n  if(nsh > 0) { pm.lShiftTo(nsh,y); pt.lShiftTo(nsh,r); }\r\n  else { pm.copyTo(y); pt.copyTo(r); }\r\n  var ys = y.t;\r\n  var y0 = y[ys-1];\r\n  if(y0 == 0) return;\r\n  var yt = y0*(1<<this.F1)+((ys>1)?y[ys-2]>>this.F2:0);\r\n  var d1 = this.FV/yt, d2 = (1<<this.F1)/yt, e = 1<<this.F2;\r\n  var i = r.t, j = i-ys, t = (q==null)?nbi():q;\r\n  y.dlShiftTo(j,t);\r\n  if(r.compareTo(t) >= 0) {\r\n    r[r.t++] = 1;\r\n    r.subTo(t,r);\r\n  }\r\n  BigInteger.ONE.dlShiftTo(ys,t);\r\n  t.subTo(y,y);\t// \"negative\" y so we can replace sub with am later\r\n  while(y.t < ys) y[y.t++] = 0;\r\n  while(--j >= 0) {\r\n    // Estimate quotient digit\r\n    var qd = (r[--i]==y0)?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);\r\n    if((r[i]+=y.am(0,qd,r,j,0,ys)) < qd) {\t// Try it out\r\n      y.dlShiftTo(j,t);\r\n      r.subTo(t,r);\r\n      while(r[i] < --qd) r.subTo(t,r);\r\n    }\r\n  }\r\n  if(q != null) {\r\n    r.drShiftTo(ys,q);\r\n    if(ts != ms) BigInteger.ZERO.subTo(q,q);\r\n  }\r\n  r.t = ys;\r\n  r.clamp();\r\n  if(nsh > 0) r.rShiftTo(nsh,r);\t// Denormalize remainder\r\n  if(ts < 0) BigInteger.ZERO.subTo(r,r);\r\n}\r\n\r\n// (public) this mod a\r\nfunction bnMod(a) {\r\n  var r = nbi();\r\n  this.abs().divRemTo(a,null,r);\r\n  if(this.s < 0 && r.compareTo(BigInteger.ZERO) > 0) a.subTo(r,r);\r\n  return r;\r\n}\r\n\r\n// Modular reduction using \"classic\" algorithm\r\nexport class Classic{\r\n  constructor(m){\r\n    this.m = m;\r\n  }\r\n}\r\nfunction cConvert(x) {\r\n  if(x.s < 0 || x.compareTo(this.m) >= 0) return x.mod(this.m);\r\n  else return x;\r\n}\r\nfunction cRevert(x) { return x; }\r\nfunction cReduce(x) { x.divRemTo(this.m,null,x); }\r\nfunction cMulTo(x,y,r) { x.multiplyTo(y,r); this.reduce(r); }\r\nfunction cSqrTo(x,r) { x.squareTo(r); this.reduce(r); }\r\n\r\nClassic.prototype.convert = cConvert;\r\nClassic.prototype.revert = cRevert;\r\nClassic.prototype.reduce = cReduce;\r\nClassic.prototype.mulTo = cMulTo;\r\nClassic.prototype.sqrTo = cSqrTo;\r\n\r\n// (protected) return \"-1/this % 2^DB\"; useful for Mont. reduction\r\n// justification:\r\n//         xy == 1 (mod m)\r\n//         xy =  1+km\r\n//   xy(2-xy) = (1+km)(1-km)\r\n// x[y(2-xy)] = 1-k^2m^2\r\n// x[y(2-xy)] == 1 (mod m^2)\r\n// if y is 1/x mod m, then y(2-xy) is 1/x mod m^2\r\n// should reduce x and y(2-xy) by m^2 at each step to keep size bounded.\r\n// JS multiply \"overflows\" differently from C/C++, so care is needed here.\r\nfunction bnpInvDigit() {\r\n  if(this.t < 1) return 0;\r\n  var x = this[0];\r\n  if((x&1) == 0) return 0;\r\n  var y = x&3;\t\t// y == 1/x mod 2^2\r\n  y = (y*(2-(x&0xf)*y))&0xf;\t// y == 1/x mod 2^4\r\n  y = (y*(2-(x&0xff)*y))&0xff;\t// y == 1/x mod 2^8\r\n  y = (y*(2-(((x&0xffff)*y)&0xffff)))&0xffff;\t// y == 1/x mod 2^16\r\n  // last step - calculate inverse mod DV directly;\r\n  // assumes 16 < DB <= 32 and assumes ability to handle 48-bit ints\r\n  y = (y*(2-x*y%this.DV))%this.DV;\t\t// y == 1/x mod 2^dbits\r\n  // we really want the negative inverse, and -DV < y < DV\r\n  return (y>0)?this.DV-y:-y;\r\n}\r\n\r\n// Montgomery reduction\r\nexport class Montgomery {\r\n  constructor(m) {\r\n    this.m = m;\r\n    this.mp = m.invDigit();\r\n    this.mpl = this.mp & 0x7fff;\r\n    this.mph = this.mp >> 15;\r\n    this.um = (1 << (m.DB - 15)) - 1;\r\n    this.mt2 = 2 * m.t;\r\n  }\r\n}\r\n\r\n// xR mod m\r\nfunction montConvert(x) {\r\n  var r = nbi();\r\n  x.abs().dlShiftTo(this.m.t,r);\r\n  r.divRemTo(this.m,null,r);\r\n  if(x.s < 0 && r.compareTo(BigInteger.ZERO) > 0) this.m.subTo(r,r);\r\n  return r;\r\n}\r\n\r\n// x/R mod m\r\nfunction montRevert(x) {\r\n  var r = nbi();\r\n  x.copyTo(r);\r\n  this.reduce(r);\r\n  return r;\r\n}\r\n\r\n// x = x/R mod m (HAC 14.32)\r\nfunction montReduce(x) {\r\n  while(x.t <= this.mt2)\t// pad x so am has enough room later\r\n    x[x.t++] = 0;\r\n  for(var i = 0; i < this.m.t; ++i) {\r\n    // faster way of calculating u0 = x[i]*mp mod DV\r\n    var j = x[i]&0x7fff;\r\n    var u0 = (j*this.mpl+(((j*this.mph+(x[i]>>15)*this.mpl)&this.um)<<15))&x.DM;\r\n    // use am to combine the multiply-shift-add into one call\r\n    j = i+this.m.t;\r\n    x[j] += this.m.am(0,u0,x,i,0,this.m.t);\r\n    // propagate carry\r\n    while(x[j] >= x.DV) { x[j] -= x.DV; x[++j]++; }\r\n  }\r\n  x.clamp();\r\n  x.drShiftTo(this.m.t,x);\r\n  if(x.compareTo(this.m) >= 0) x.subTo(this.m,x);\r\n}\r\n\r\n// r = \"x^2/R mod m\"; x != r\r\nfunction montSqrTo(x,r) { x.squareTo(r); this.reduce(r); }\r\n\r\n// r = \"xy/R mod m\"; x,y != r\r\nfunction montMulTo(x,y,r) { x.multiplyTo(y,r); this.reduce(r); }\r\n\r\nMontgomery.prototype.convert = montConvert;\r\nMontgomery.prototype.revert = montRevert;\r\nMontgomery.prototype.reduce = montReduce;\r\nMontgomery.prototype.mulTo = montMulTo;\r\nMontgomery.prototype.sqrTo = montSqrTo;\r\n\r\n// (protected) true iff this is even\r\nfunction bnpIsEven() { return ((this.t>0)?(this[0]&1):this.s) == 0; }\r\n\r\n// (protected) this^e, e < 2^32, doing sqr and mul with \"r\" (HAC 14.79)\r\nfunction bnpExp(e,z) {\r\n  if(e > 0xffffffff || e < 1) return BigInteger.ONE;\r\n  var r = nbi(), r2 = nbi(), g = z.convert(this), i = nbits(e)-1;\r\n  g.copyTo(r);\r\n  while(--i >= 0) {\r\n    z.sqrTo(r,r2);\r\n    if((e&(1<<i)) > 0) z.mulTo(r2,g,r);\r\n    else { var t = r; r = r2; r2 = t; }\r\n  }\r\n  return z.revert(r);\r\n}\r\n\r\n// (public) this^e % m, 0 <= e < 2^32\r\nfunction bnModPowInt(e,m) {\r\n  var z;\r\n  if(e < 256 || m.isEven()) z = new Classic(m); else z = new Montgomery(m);\r\n  return this.exp(e,z);\r\n}\r\n\r\n// protected\r\nBigInteger.prototype.copyTo = bnpCopyTo;\r\nBigInteger.prototype.fromInt = bnpFromInt;\r\nBigInteger.prototype.fromString = bnpFromString;\r\nBigInteger.prototype.clamp = bnpClamp;\r\nBigInteger.prototype.dlShiftTo = bnpDLShiftTo;\r\nBigInteger.prototype.drShiftTo = bnpDRShiftTo;\r\nBigInteger.prototype.lShiftTo = bnpLShiftTo;\r\nBigInteger.prototype.rShiftTo = bnpRShiftTo;\r\nBigInteger.prototype.subTo = bnpSubTo;\r\nBigInteger.prototype.multiplyTo = bnpMultiplyTo;\r\nBigInteger.prototype.squareTo = bnpSquareTo;\r\nBigInteger.prototype.divRemTo = bnpDivRemTo;\r\nBigInteger.prototype.invDigit = bnpInvDigit;\r\nBigInteger.prototype.isEven = bnpIsEven;\r\nBigInteger.prototype.exp = bnpExp;\r\n\r\n// public\r\nBigInteger.prototype.toString = bnToString;\r\nBigInteger.prototype.negate = bnNegate;\r\nBigInteger.prototype.abs = bnAbs;\r\nBigInteger.prototype.compareTo = bnCompareTo;\r\nBigInteger.prototype.bitLength = bnBitLength;\r\nBigInteger.prototype.mod = bnMod;\r\nBigInteger.prototype.modPowInt = bnModPowInt;\r\n\r\n// \"constants\"\r\nBigInteger.ZERO = nbv(0);\r\nBigInteger.ONE = nbv(1);\r\n","// Copyright (c) 2005-2009  Tom Wu\r\n// All Rights Reserved.\r\n// See \"LICENSE\" for details.\r\n\r\n// Extended JavaScript BN functions, required for RSA private ops.\r\n\r\n// Version 1.1: new BigInteger(\"0\", 10) returns \"proper\" zero\r\n// Version 1.2: square() API, isProbablePrime fix\r\n\r\nimport {BigInteger, nbi, nbv, nbits, intAt, Classic, Montgomery} from \"./jsbn\";\r\nexport {BigInteger} from \"./jsbn\";\r\n// (public)\r\nfunction bnClone() { var r = nbi(); this.copyTo(r); return r; }\r\n\r\n// (public) return value as integer\r\nfunction bnIntValue() {\r\n  if(this.s < 0) {\r\n    if(this.t == 1) return this[0]-this.DV;\r\n    else if(this.t == 0) return -1;\r\n  }\r\n  else if(this.t == 1) return this[0];\r\n  else if(this.t == 0) return 0;\r\n  // assumes 16 < DB < 32\r\n  return ((this[1]&((1<<(32-this.DB))-1))<<this.DB)|this[0];\r\n}\r\n\r\n// (public) return value as byte\r\nfunction bnByteValue() { return (this.t==0)?this.s:(this[0]<<24)>>24; }\r\n\r\n// (public) return value as short (assumes DB>=16)\r\nfunction bnShortValue() { return (this.t==0)?this.s:(this[0]<<16)>>16; }\r\n\r\n// (protected) return x s.t. r^x < DV\r\nfunction bnpChunkSize(r) { return Math.floor(Math.LN2*this.DB/Math.log(r)); }\r\n\r\n// (public) 0 if this == 0, 1 if this > 0\r\nfunction bnSigNum() {\r\n  if(this.s < 0) return -1;\r\n  else if(this.t <= 0 || (this.t == 1 && this[0] <= 0)) return 0;\r\n  else return 1;\r\n}\r\n\r\n// (protected) convert to radix string\r\nfunction bnpToRadix(b) {\r\n  if(b == null) b = 10;\r\n  if(this.signum() == 0 || b < 2 || b > 36) return \"0\";\r\n  var cs = this.chunkSize(b);\r\n  var a = Math.pow(b,cs);\r\n  var d = nbv(a), y = nbi(), z = nbi(), r = \"\";\r\n  this.divRemTo(d,y,z);\r\n  while(y.signum() > 0) {\r\n    r = (a+z.intValue()).toString(b).substr(1) + r;\r\n    y.divRemTo(d,y,z);\r\n  }\r\n  return z.intValue().toString(b) + r;\r\n}\r\n\r\n// (protected) convert from radix string\r\nfunction bnpFromRadix(s,b) {\r\n  this.fromInt(0);\r\n  if(b == null) b = 10;\r\n  var cs = this.chunkSize(b);\r\n  var d = Math.pow(b,cs), mi = false, j = 0, w = 0;\r\n  for(var i = 0; i < s.length; ++i) {\r\n    var x = intAt(s,i);\r\n    if(x < 0) {\r\n      if(s.charAt(i) == \"-\" && this.signum() == 0) mi = true;\r\n      continue;\r\n    }\r\n    w = b*w+x;\r\n    if(++j >= cs) {\r\n      this.dMultiply(d);\r\n      this.dAddOffset(w,0);\r\n      j = 0;\r\n      w = 0;\r\n    }\r\n  }\r\n  if(j > 0) {\r\n    this.dMultiply(Math.pow(b,j));\r\n    this.dAddOffset(w,0);\r\n  }\r\n  if(mi) BigInteger.ZERO.subTo(this,this);\r\n}\r\n\r\n// (protected) alternate constructor\r\nfunction bnpFromNumber(a,b,c) {\r\n  if(\"number\" == typeof b) {\r\n    // new BigInteger(int,int,RNG)\r\n    if(a < 2) this.fromInt(1);\r\n    else {\r\n      this.fromNumber(a,c);\r\n      if(!this.testBit(a-1))\t// force MSB set\r\n        this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);\r\n      if(this.isEven()) this.dAddOffset(1,0); // force odd\r\n      while(!this.isProbablePrime(b)) {\r\n        this.dAddOffset(2,0);\r\n        if(this.bitLength() > a) this.subTo(BigInteger.ONE.shiftLeft(a-1),this);\r\n      }\r\n    }\r\n  }\r\n  else {\r\n    // new BigInteger(int,RNG)\r\n    var x = [], t = a&7;\r\n    x.length = (a>>3)+1;\r\n    b.nextBytes(x);\r\n    if(t > 0) x[0] &= ((1<<t)-1); else x[0] = 0;\r\n    this.fromString(x,256);\r\n  }\r\n}\r\n\r\n// (public) convert to bigendian byte array\r\nfunction bnToByteArray() {\r\n  var i = this.t, r = [];\r\n  r[0] = this.s;\r\n  var p = this.DB-(i*this.DB)%8, d, k = 0;\r\n  if(i-- > 0) {\r\n    if(p < this.DB && (d = this[i]>>p) != (this.s&this.DM)>>p)\r\n      r[k++] = d|(this.s<<(this.DB-p));\r\n    while(i >= 0) {\r\n      if(p < 8) {\r\n        d = (this[i]&((1<<p)-1))<<(8-p);\r\n        d |= this[--i]>>(p+=this.DB-8);\r\n      }\r\n      else {\r\n        d = (this[i]>>(p-=8))&0xff;\r\n        if(p <= 0) { p += this.DB; --i; }\r\n      }\r\n      if((d&0x80) != 0) d |= -256;\r\n      if(k == 0 && (this.s&0x80) != (d&0x80)) ++k;\r\n      if(k > 0 || d != this.s) r[k++] = d;\r\n    }\r\n  }\r\n  return r;\r\n}\r\n\r\nfunction bnEquals(a) { return(this.compareTo(a)==0); }\r\nfunction bnMin(a) { return(this.compareTo(a)<0)?this:a; }\r\nfunction bnMax(a) { return(this.compareTo(a)>0)?this:a; }\r\n\r\n// (protected) r = this op a (bitwise)\r\nfunction bnpBitwiseTo(a,op,r) {\r\n  var i, f, m = Math.min(a.t,this.t);\r\n  for(i = 0; i < m; ++i) r[i] = op(this[i],a[i]);\r\n  if(a.t < this.t) {\r\n    f = a.s&this.DM;\r\n    for(i = m; i < this.t; ++i) r[i] = op(this[i],f);\r\n    r.t = this.t;\r\n  }\r\n  else {\r\n    f = this.s&this.DM;\r\n    for(i = m; i < a.t; ++i) r[i] = op(f,a[i]);\r\n    r.t = a.t;\r\n  }\r\n  r.s = op(this.s,a.s);\r\n  r.clamp();\r\n}\r\n\r\n// (public) this & a\r\nfunction op_and(x,y) { return x&y; }\r\nfunction bnAnd(a) { var r = nbi(); this.bitwiseTo(a,op_and,r); return r; }\r\n\r\n// (public) this | a\r\nfunction op_or(x,y) { return x|y; }\r\nfunction bnOr(a) { var r = nbi(); this.bitwiseTo(a,op_or,r); return r; }\r\n\r\n// (public) this ^ a\r\nfunction op_xor(x,y) { return x^y; }\r\nfunction bnXor(a) { var r = nbi(); this.bitwiseTo(a,op_xor,r); return r; }\r\n\r\n// (public) this & ~a\r\nfunction op_andnot(x,y) { return x&~y; }\r\nfunction bnAndNot(a) { var r = nbi(); this.bitwiseTo(a,op_andnot,r); return r; }\r\n\r\n// (public) ~this\r\nfunction bnNot() {\r\n  var r = nbi();\r\n  for(var i = 0; i < this.t; ++i) r[i] = this.DM&~this[i];\r\n  r.t = this.t;\r\n  r.s = ~this.s;\r\n  return r;\r\n}\r\n\r\n// (public) this << n\r\nfunction bnShiftLeft(n) {\r\n  var r = nbi();\r\n  if(n < 0) this.rShiftTo(-n,r); else this.lShiftTo(n,r);\r\n  return r;\r\n}\r\n\r\n// (public) this >> n\r\nfunction bnShiftRight(n) {\r\n  var r = nbi();\r\n  if(n < 0) this.lShiftTo(-n,r); else this.rShiftTo(n,r);\r\n  return r;\r\n}\r\n\r\n// return index of lowest 1-bit in x, x < 2^31\r\nfunction lbit(x) {\r\n  if(x == 0) return -1;\r\n  var r = 0;\r\n  if((x&0xffff) == 0) { x >>= 16; r += 16; }\r\n  if((x&0xff) == 0) { x >>= 8; r += 8; }\r\n  if((x&0xf) == 0) { x >>= 4; r += 4; }\r\n  if((x&3) == 0) { x >>= 2; r += 2; }\r\n  if((x&1) == 0) ++r;\r\n  return r;\r\n}\r\n\r\n// (public) returns index of lowest 1-bit (or -1 if none)\r\nfunction bnGetLowestSetBit() {\r\n  for(var i = 0; i < this.t; ++i)\r\n    if(this[i] != 0) return i*this.DB+lbit(this[i]);\r\n  if(this.s < 0) return this.t*this.DB;\r\n  return -1;\r\n}\r\n\r\n// return number of 1 bits in x\r\nfunction cbit(x) {\r\n  var r = 0;\r\n  while(x != 0) { x &= x-1; ++r; }\r\n  return r;\r\n}\r\n\r\n// (public) return number of set bits\r\nfunction bnBitCount() {\r\n  var r = 0, x = this.s&this.DM;\r\n  for(var i = 0; i < this.t; ++i) r += cbit(this[i]^x);\r\n  return r;\r\n}\r\n\r\n// (public) true iff nth bit is set\r\nfunction bnTestBit(n) {\r\n  var j = Math.floor(n/this.DB);\r\n  if(j >= this.t) return(this.s!=0);\r\n  return((this[j]&(1<<(n%this.DB)))!=0);\r\n}\r\n\r\n// (protected) this op (1<<n)\r\nfunction bnpChangeBit(n,op) {\r\n  var r = BigInteger.ONE.shiftLeft(n);\r\n  this.bitwiseTo(r,op,r);\r\n  return r;\r\n}\r\n\r\n// (public) this | (1<<n)\r\nfunction bnSetBit(n) { return this.changeBit(n,op_or); }\r\n\r\n// (public) this & ~(1<<n)\r\nfunction bnClearBit(n) { return this.changeBit(n,op_andnot); }\r\n\r\n// (public) this ^ (1<<n)\r\nfunction bnFlipBit(n) { return this.changeBit(n,op_xor); }\r\n\r\n// (protected) r = this + a\r\nfunction bnpAddTo(a,r) {\r\n  var i = 0, c = 0, m = Math.min(a.t,this.t);\r\n  while(i < m) {\r\n    c += this[i]+a[i];\r\n    r[i++] = c&this.DM;\r\n    c >>= this.DB;\r\n  }\r\n  if(a.t < this.t) {\r\n    c += a.s;\r\n    while(i < this.t) {\r\n      c += this[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c += this.s;\r\n  }\r\n  else {\r\n    c += this.s;\r\n    while(i < a.t) {\r\n      c += a[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c += a.s;\r\n  }\r\n  r.s = (c<0)?-1:0;\r\n  if(c > 0) r[i++] = c;\r\n  else if(c < -1) r[i++] = this.DV+c;\r\n  r.t = i;\r\n  r.clamp();\r\n}\r\n\r\n// (public) this + a\r\nfunction bnAdd(a) { var r = nbi(); this.addTo(a,r); return r; }\r\n\r\n// (public) this - a\r\nfunction bnSubtract(a) { var r = nbi(); this.subTo(a,r); return r; }\r\n\r\n// (public) this * a\r\nfunction bnMultiply(a) { var r = nbi(); this.multiplyTo(a,r); return r; }\r\n\r\n// (public) this^2\r\nfunction bnSquare() { var r = nbi(); this.squareTo(r); return r; }\r\n\r\n// (public) this / a\r\nfunction bnDivide(a) { var r = nbi(); this.divRemTo(a,r,null); return r; }\r\n\r\n// (public) this % a\r\nfunction bnRemainder(a) { var r = nbi(); this.divRemTo(a,null,r); return r; }\r\n\r\n// (public) [this/a,this%a]\r\nfunction bnDivideAndRemainder(a) {\r\n  var q = nbi(), r = nbi();\r\n  this.divRemTo(a,q,r);\r\n  return new Array(q,r);\r\n}\r\n\r\n// (protected) this *= n, this >= 0, 1 < n < DV\r\nfunction bnpDMultiply(n) {\r\n  this[this.t] = this.am(0,n-1,this,0,0,this.t);\r\n  ++this.t;\r\n  this.clamp();\r\n}\r\n\r\n// (protected) this += n << w words, this >= 0\r\nfunction bnpDAddOffset(n,w) {\r\n  if(n == 0) return;\r\n  while(this.t <= w) this[this.t++] = 0;\r\n  this[w] += n;\r\n  while(this[w] >= this.DV) {\r\n    this[w] -= this.DV;\r\n    if(++w >= this.t) this[this.t++] = 0;\r\n    ++this[w];\r\n  }\r\n}\r\n\r\n// A \"null\" reducer\r\nfunction NullExp() {}\r\nfunction nNop(x) { return x; }\r\nfunction nMulTo(x,y,r) { x.multiplyTo(y,r); }\r\nfunction nSqrTo(x,r) { x.squareTo(r); }\r\n\r\nNullExp.prototype.convert = nNop;\r\nNullExp.prototype.revert = nNop;\r\nNullExp.prototype.mulTo = nMulTo;\r\nNullExp.prototype.sqrTo = nSqrTo;\r\n\r\n// (public) this^e\r\nfunction bnPow(e) { return this.exp(e,new NullExp()); }\r\n\r\n// (protected) r = lower n words of \"this * a\", a.t <= n\r\n// \"this\" should be the larger one if appropriate.\r\nfunction bnpMultiplyLowerTo(a,n,r) {\r\n  var i = Math.min(this.t+a.t,n);\r\n  r.s = 0; // assumes a,this >= 0\r\n  r.t = i;\r\n  while(i > 0) r[--i] = 0;\r\n  var j;\r\n  for(j = r.t-this.t; i < j; ++i) r[i+this.t] = this.am(0,a[i],r,i,0,this.t);\r\n  for(j = Math.min(a.t,n); i < j; ++i) this.am(0,a[i],r,i,0,n-i);\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = \"this * a\" without lower n words, n > 0\r\n// \"this\" should be the larger one if appropriate.\r\nfunction bnpMultiplyUpperTo(a,n,r) {\r\n  --n;\r\n  var i = r.t = this.t+a.t-n;\r\n  r.s = 0; // assumes a,this >= 0\r\n  while(--i >= 0) r[i] = 0;\r\n  for(i = Math.max(n-this.t,0); i < a.t; ++i)\r\n    r[this.t+i-n] = this.am(n-i,a[i],r,0,0,this.t+i-n);\r\n  r.clamp();\r\n  r.drShiftTo(1,r);\r\n}\r\n\r\n// Barrett modular reduction\r\nfunction Barrett(m) {\r\n  // setup Barrett\r\n  this.r2 = nbi();\r\n  this.q3 = nbi();\r\n  BigInteger.ONE.dlShiftTo(2*m.t,this.r2);\r\n  this.mu = this.r2.divide(m);\r\n  this.m = m;\r\n}\r\n\r\nfunction barrettConvert(x) {\r\n  if(x.s < 0 || x.t > 2*this.m.t) return x.mod(this.m);\r\n  else if(x.compareTo(this.m) < 0) return x;\r\n  else { var r = nbi(); x.copyTo(r); this.reduce(r); return r; }\r\n}\r\n\r\nfunction barrettRevert(x) { return x; }\r\n\r\n// x = x mod m (HAC 14.42)\r\nfunction barrettReduce(x) {\r\n  x.drShiftTo(this.m.t-1,this.r2);\r\n  if(x.t > this.m.t+1) { x.t = this.m.t+1; x.clamp(); }\r\n  this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);\r\n  this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);\r\n  while(x.compareTo(this.r2) < 0) x.dAddOffset(1,this.m.t+1);\r\n  x.subTo(this.r2,x);\r\n  while(x.compareTo(this.m) >= 0) x.subTo(this.m,x);\r\n}\r\n\r\n// r = x^2 mod m; x != r\r\nfunction barrettSqrTo(x,r) { x.squareTo(r); this.reduce(r); }\r\n\r\n// r = x*y mod m; x,y != r\r\nfunction barrettMulTo(x,y,r) { x.multiplyTo(y,r); this.reduce(r); }\r\n\r\nBarrett.prototype.convert = barrettConvert;\r\nBarrett.prototype.revert = barrettRevert;\r\nBarrett.prototype.reduce = barrettReduce;\r\nBarrett.prototype.mulTo = barrettMulTo;\r\nBarrett.prototype.sqrTo = barrettSqrTo;\r\n\r\n// (public) this^e % m (HAC 14.85)\r\nfunction bnModPow(e,m) {\r\n  var i = e.bitLength(), k, r = nbv(1), z;\r\n  if(i <= 0) return r;\r\n  else if(i < 18) k = 1;\r\n  else if(i < 48) k = 3;\r\n  else if(i < 144) k = 4;\r\n  else if(i < 768) k = 5;\r\n  else k = 6;\r\n  if(i < 8)\r\n    z = new Classic(m);\r\n  else if(m.isEven())\r\n    z = new Barrett(m);\r\n  else\r\n    z = new Montgomery(m);\r\n\r\n  // precomputation\r\n  var g = [], n = 3, k1 = k-1, km = (1<<k)-1;\r\n  g[1] = z.convert(this);\r\n  if(k > 1) {\r\n    var g2 = nbi();\r\n    z.sqrTo(g[1],g2);\r\n    while(n <= km) {\r\n      g[n] = nbi();\r\n      z.mulTo(g2,g[n-2],g[n]);\r\n      n += 2;\r\n    }\r\n  }\r\n\r\n  var j = e.t-1, w, is1 = true, r2 = nbi(), t;\r\n  i = nbits(e[j])-1;\r\n  while(j >= 0) {\r\n    if(i >= k1) w = (e[j]>>(i-k1))&km;\r\n    else {\r\n      w = (e[j]&((1<<(i+1))-1))<<(k1-i);\r\n      if(j > 0) w |= e[j-1]>>(this.DB+i-k1);\r\n    }\r\n\r\n    n = k;\r\n    while((w&1) == 0) { w >>= 1; --n; }\r\n    if((i -= n) < 0) { i += this.DB; --j; }\r\n    if(is1) {\t// ret == 1, don't bother squaring or multiplying it\r\n      g[w].copyTo(r);\r\n      is1 = false;\r\n    }\r\n    else {\r\n      while(n > 1) { z.sqrTo(r,r2); z.sqrTo(r2,r); n -= 2; }\r\n      if(n > 0) z.sqrTo(r,r2); else { t = r; r = r2; r2 = t; }\r\n      z.mulTo(r2,g[w],r);\r\n    }\r\n\r\n    while(j >= 0 && (e[j]&(1<<i)) == 0) {\r\n      z.sqrTo(r,r2); t = r; r = r2; r2 = t;\r\n      if(--i < 0) { i = this.DB-1; --j; }\r\n    }\r\n  }\r\n  return z.revert(r);\r\n}\r\n\r\n// (public) gcd(this,a) (HAC 14.54)\r\nfunction bnGCD(a) {\r\n  var x = (this.s<0)?this.negate():this.clone();\r\n  var y = (a.s<0)?a.negate():a.clone();\r\n  if(x.compareTo(y) < 0) { var t = x; x = y; y = t; }\r\n  var i = x.getLowestSetBit(), g = y.getLowestSetBit();\r\n  if(g < 0) return x;\r\n  if(i < g) g = i;\r\n  if(g > 0) {\r\n    x.rShiftTo(g,x);\r\n    y.rShiftTo(g,y);\r\n  }\r\n  while(x.signum() > 0) {\r\n    if((i = x.getLowestSetBit()) > 0) x.rShiftTo(i,x);\r\n    if((i = y.getLowestSetBit()) > 0) y.rShiftTo(i,y);\r\n    if(x.compareTo(y) >= 0) {\r\n      x.subTo(y,x);\r\n      x.rShiftTo(1,x);\r\n    }\r\n    else {\r\n      y.subTo(x,y);\r\n      y.rShiftTo(1,y);\r\n    }\r\n  }\r\n  if(g > 0) y.lShiftTo(g,y);\r\n  return y;\r\n}\r\n\r\n// (protected) this % n, n < 2^26\r\nfunction bnpModInt(n) {\r\n  if(n <= 0) return 0;\r\n  var d = this.DV%n, r = (this.s<0)?n-1:0;\r\n  if(this.t > 0)\r\n    if(d == 0) r = this[0]%n;\r\n    else for(var i = this.t-1; i >= 0; --i) r = (d*r+this[i])%n;\r\n  return r;\r\n}\r\n\r\n// (public) 1/this % m (HAC 14.61)\r\nfunction bnModInverse(m) {\r\n  var ac = m.isEven();\r\n  if((this.isEven() && ac) || m.signum() == 0) return BigInteger.ZERO;\r\n  var u = m.clone(), v = this.clone();\r\n  var a = nbv(1), b = nbv(0), c = nbv(0), d = nbv(1);\r\n  while(u.signum() != 0) {\r\n    while(u.isEven()) {\r\n      u.rShiftTo(1,u);\r\n      if(ac) {\r\n        if(!a.isEven() || !b.isEven()) { a.addTo(this,a); b.subTo(m,b); }\r\n        a.rShiftTo(1,a);\r\n      }\r\n      else if(!b.isEven()) b.subTo(m,b);\r\n      b.rShiftTo(1,b);\r\n    }\r\n    while(v.isEven()) {\r\n      v.rShiftTo(1,v);\r\n      if(ac) {\r\n        if(!c.isEven() || !d.isEven()) { c.addTo(this,c); d.subTo(m,d); }\r\n        c.rShiftTo(1,c);\r\n      }\r\n      else if(!d.isEven()) d.subTo(m,d);\r\n      d.rShiftTo(1,d);\r\n    }\r\n    if(u.compareTo(v) >= 0) {\r\n      u.subTo(v,u);\r\n      if(ac) a.subTo(c,a);\r\n      b.subTo(d,b);\r\n    }\r\n    else {\r\n      v.subTo(u,v);\r\n      if(ac) c.subTo(a,c);\r\n      d.subTo(b,d);\r\n    }\r\n  }\r\n  if(v.compareTo(BigInteger.ONE) != 0) return BigInteger.ZERO;\r\n  if(d.compareTo(m) >= 0) return d.subtract(m);\r\n  if(d.signum() < 0) d.addTo(m,d); else return d;\r\n  if(d.signum() < 0) return d.add(m); else return d;\r\n}\r\n\r\nvar lowprimes = [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];\r\nvar lplim = (1<<26)/lowprimes[lowprimes.length-1];\r\n\r\n// (public) test primality with certainty >= 1-.5^t\r\nfunction bnIsProbablePrime(t) {\r\n  var i, x = this.abs();\r\n  if(x.t == 1 && x[0] <= lowprimes[lowprimes.length-1]) {\r\n    for(i = 0; i < lowprimes.length; ++i)\r\n      if(x[0] == lowprimes[i]) return true;\r\n    return false;\r\n  }\r\n  if(x.isEven()) return false;\r\n  i = 1;\r\n  while(i < lowprimes.length) {\r\n    var m = lowprimes[i], j = i+1;\r\n    while(j < lowprimes.length && m < lplim) m *= lowprimes[j++];\r\n    m = x.modInt(m);\r\n    while(i < j) if(m%lowprimes[i++] == 0) return false;\r\n  }\r\n  return x.millerRabin(t);\r\n}\r\n\r\n// (protected) true if probably prime (HAC 4.24, Miller-Rabin)\r\nfunction bnpMillerRabin(t) {\r\n  var n1 = this.subtract(BigInteger.ONE);\r\n  var k = n1.getLowestSetBit();\r\n  if(k <= 0) return false;\r\n  var r = n1.shiftRight(k);\r\n  t = (t+1)>>1;\r\n  if(t > lowprimes.length) t = lowprimes.length;\r\n  var a = nbi();\r\n  for(var i = 0; i < t; ++i) {\r\n    //Pick bases at random, instead of starting at 2\r\n    a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);\r\n    var y = a.modPow(r,this);\r\n    if(y.compareTo(BigInteger.ONE) != 0 && y.compareTo(n1) != 0) {\r\n      var j = 1;\r\n      while(j++ < k && y.compareTo(n1) != 0) {\r\n        y = y.modPowInt(2,this);\r\n        if(y.compareTo(BigInteger.ONE) == 0) return false;\r\n      }\r\n      if(y.compareTo(n1) != 0) return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n// protected\r\nBigInteger.prototype.chunkSize = bnpChunkSize;\r\nBigInteger.prototype.toRadix = bnpToRadix;\r\nBigInteger.prototype.fromRadix = bnpFromRadix;\r\nBigInteger.prototype.fromNumber = bnpFromNumber;\r\nBigInteger.prototype.bitwiseTo = bnpBitwiseTo;\r\nBigInteger.prototype.changeBit = bnpChangeBit;\r\nBigInteger.prototype.addTo = bnpAddTo;\r\nBigInteger.prototype.dMultiply = bnpDMultiply;\r\nBigInteger.prototype.dAddOffset = bnpDAddOffset;\r\nBigInteger.prototype.multiplyLowerTo = bnpMultiplyLowerTo;\r\nBigInteger.prototype.multiplyUpperTo = bnpMultiplyUpperTo;\r\nBigInteger.prototype.modInt = bnpModInt;\r\nBigInteger.prototype.millerRabin = bnpMillerRabin;\r\n\r\n// public\r\nBigInteger.prototype.clone = bnClone;\r\nBigInteger.prototype.intValue = bnIntValue;\r\nBigInteger.prototype.byteValue = bnByteValue;\r\nBigInteger.prototype.shortValue = bnShortValue;\r\nBigInteger.prototype.signum = bnSigNum;\r\nBigInteger.prototype.toByteArray = bnToByteArray;\r\nBigInteger.prototype.equals = bnEquals;\r\nBigInteger.prototype.min = bnMin;\r\nBigInteger.prototype.max = bnMax;\r\nBigInteger.prototype.and = bnAnd;\r\nBigInteger.prototype.or = bnOr;\r\nBigInteger.prototype.xor = bnXor;\r\nBigInteger.prototype.andNot = bnAndNot;\r\nBigInteger.prototype.not = bnNot;\r\nBigInteger.prototype.shiftLeft = bnShiftLeft;\r\nBigInteger.prototype.shiftRight = bnShiftRight;\r\nBigInteger.prototype.getLowestSetBit = bnGetLowestSetBit;\r\nBigInteger.prototype.bitCount = bnBitCount;\r\nBigInteger.prototype.testBit = bnTestBit;\r\nBigInteger.prototype.setBit = bnSetBit;\r\nBigInteger.prototype.clearBit = bnClearBit;\r\nBigInteger.prototype.flipBit = bnFlipBit;\r\nBigInteger.prototype.add = bnAdd;\r\nBigInteger.prototype.subtract = bnSubtract;\r\nBigInteger.prototype.multiply = bnMultiply;\r\nBigInteger.prototype.divide = bnDivide;\r\nBigInteger.prototype.remainder = bnRemainder;\r\nBigInteger.prototype.divideAndRemainder = bnDivideAndRemainder;\r\nBigInteger.prototype.modPow = bnModPow;\r\nBigInteger.prototype.modInverse = bnModInverse;\r\nBigInteger.prototype.pow = bnPow;\r\nBigInteger.prototype.gcd = bnGCD;\r\nBigInteger.prototype.isProbablePrime = bnIsProbablePrime;\r\n\r\n// JSBN-specific extension\r\nBigInteger.prototype.square = bnSquare;\r\n\r\n// BigInteger interfaces not implemented in jsbn:\r\n\r\n// BigInteger(int signum, byte[] magnitude)\r\n// double doubleValue()\r\n// float floatValue()\r\n// int hashCode()\r\n// long longValue()\r\n// static BigInteger valueOf(long val)\r\n","// Version 1.1: support utf-8 encoding in pkcs1pad2\r\n\r\n// convert a (hex) string to a bignum object\r\n\r\nimport {BigInteger} from \"./jsbn2\";\r\nimport {SecureRandom} from \"./rng\";\r\n\r\nexport function parseBigInt(str,r) {\r\n  return new BigInteger(str,r);\r\n}\r\n\r\nfunction linebrk(s,n) {\r\n  var ret = \"\";\r\n  var i = 0;\r\n  while(i + n < s.length) {\r\n    ret += s.substring(i,i+n) + \"\\n\";\r\n    i += n;\r\n  }\r\n  return ret + s.substring(i,s.length);\r\n}\r\n\r\nfunction byte2Hex(b) {\r\n  if(b < 0x10)\r\n    return \"0\" + b.toString(16);\r\n  else\r\n    return b.toString(16);\r\n}\r\n\r\n// PKCS#1 (type 2, random) pad input string s to n bytes, and return a bigint\r\nfunction pkcs1pad2(s,n) {\r\n  if(n < s.length + 11) { // TODO: fix for utf-8\r\n    console.error(\"Message too long for RSA\");\r\n    return null;\r\n  }\r\n  var ba = [];\r\n  var i = s.length - 1;\r\n  while(i >= 0 && n > 0) {\r\n    var c = s.charCodeAt(i--);\r\n    if(c < 128) { // encode using utf-8\r\n      ba[--n] = c;\r\n    }\r\n    else if((c > 127) && (c < 2048)) {\r\n      ba[--n] = (c & 63) | 128;\r\n      ba[--n] = (c >> 6) | 192;\r\n    }\r\n    else {\r\n      ba[--n] = (c & 63) | 128;\r\n      ba[--n] = ((c >> 6) & 63) | 128;\r\n      ba[--n] = (c >> 12) | 224;\r\n    }\r\n  }\r\n  ba[--n] = 0;\r\n  var rng = new SecureRandom();\r\n  var x = [];\r\n  while(n > 2) { // random non-zero pad\r\n    x[0] = 0;\r\n    while(x[0] == 0) rng.nextBytes(x);\r\n    ba[--n] = x[0];\r\n  }\r\n  ba[--n] = 2;\r\n  ba[--n] = 0;\r\n  return new BigInteger(ba);\r\n}\r\n\r\n// \"empty\" RSA key constructor\r\nexport class RSAKey {\r\n  constructor() {\r\n    this.n = null;\r\n    this.e = 0;\r\n    this.d = null;\r\n    this.p = null;\r\n    this.q = null;\r\n    this.dmp1 = null;\r\n    this.dmq1 = null;\r\n    this.coeff = null;\r\n  }\r\n}\r\n\r\n// Set the public key fields N and e from hex strings\r\nfunction RSASetPublic(N,E) {\r\n  if(N != null && E != null && N.length > 0 && E.length > 0) {\r\n    this.n = parseBigInt(N,16);\r\n    this.e = parseInt(E,16);\r\n  }\r\n  else\r\n    console.error(\"Invalid RSA public key\");\r\n}\r\n\r\n// Perform raw public operation on \"x\": return x^e (mod n)\r\nfunction RSADoPublic(x) {\r\n  return x.modPowInt(this.e, this.n);\r\n}\r\n\r\n// Return the PKCS#1 RSA encryption of \"text\" as an even-length hex string\r\nfunction RSAEncrypt(text) {\r\n  var m = pkcs1pad2(text,(this.n.bitLength()+7)>>3);\r\n  if(m == null) return null;\r\n  var c = this.doPublic(m);\r\n  if(c == null) return null;\r\n  var h = c.toString(16);\r\n  if((h.length & 1) == 0) return h; else return \"0\" + h;\r\n}\r\n\r\n// Return the PKCS#1 RSA encryption of \"text\" as a Base64-encoded string\r\n//function RSAEncryptB64(text) {\r\n//  var h = this.encrypt(text);\r\n//  if(h) return hex2b64(h); else return null;\r\n//}\r\n\r\n// protected\r\nRSAKey.prototype.doPublic = RSADoPublic;\r\n\r\n// public\r\nRSAKey.prototype.setPublic = RSASetPublic;\r\nRSAKey.prototype.encrypt = RSAEncrypt;\r\n//RSAKey.prototype.encrypt_b64 = RSAEncryptB64;\r\n","// Version 1.1: support utf-8 decoding in pkcs1unpad2\r\n\r\n// Undo PKCS#1 (type 2, random) padding and, if valid, return the plaintext\r\n\r\nimport {SecureRandom} from \"./rng\";\r\nimport {BigInteger} from \"./jsbn\";\r\nimport {parseBigInt} from \"./rsa\";\r\nimport {RSAKey} from \"./rsa\";\r\nexport {RSAKey} from \"./rsa\";\r\n\r\nfunction pkcs1unpad2(d,n) {\r\n  var b = d.toByteArray();\r\n  var i = 0;\r\n  while(i < b.length && b[i] == 0) ++i;\r\n  if(b.length-i != n-1 || b[i] != 2)\r\n    return null;\r\n  ++i;\r\n  while(b[i] != 0)\r\n    if(++i >= b.length) return null;\r\n  var ret = \"\";\r\n  while(++i < b.length) {\r\n    var c = b[i] & 255;\r\n    if(c < 128) { // utf-8 decode\r\n      ret += String.fromCharCode(c);\r\n    }\r\n    else if((c > 191) && (c < 224)) {\r\n      ret += String.fromCharCode(((c & 31) << 6) | (b[i+1] & 63));\r\n      ++i;\r\n    }\r\n    else {\r\n      ret += String.fromCharCode(((c & 15) << 12) | ((b[i+1] & 63) << 6) | (b[i+2] & 63));\r\n      i += 2;\r\n    }\r\n  }\r\n  return ret;\r\n}\r\n\r\n// Set the private key fields N, e, and d from hex strings\r\nfunction RSASetPrivate(N,E,D) {\r\n  if(N != null && E != null && N.length > 0 && E.length > 0) {\r\n    this.n = parseBigInt(N,16);\r\n    this.e = parseInt(E,16);\r\n    this.d = parseBigInt(D,16);\r\n  }\r\n  else\r\n    console.error(\"Invalid RSA private key\");\r\n}\r\n\r\n// Set the private key fields N, e, d and CRT params from hex strings\r\nfunction RSASetPrivateEx(N,E,D,P,Q,DP,DQ,C) {\r\n  if(N != null && E != null && N.length > 0 && E.length > 0) {\r\n    this.n = parseBigInt(N,16);\r\n    this.e = parseInt(E,16);\r\n    this.d = parseBigInt(D,16);\r\n    this.p = parseBigInt(P,16);\r\n    this.q = parseBigInt(Q,16);\r\n    this.dmp1 = parseBigInt(DP,16);\r\n    this.dmq1 = parseBigInt(DQ,16);\r\n    this.coeff = parseBigInt(C,16);\r\n  }\r\n  else\r\n    console.error(\"Invalid RSA private key\");\r\n}\r\n\r\n// Generate a new random private key B bits long, using public expt E\r\nfunction RSAGenerate(B,E) {\r\n  var rng = new SecureRandom();\r\n  var qs = B>>1;\r\n  this.e = parseInt(E,16);\r\n  var ee = new BigInteger(E,16);\r\n  for(;;) {\r\n    for(;;) {\r\n      this.p = new BigInteger(B-qs,1,rng);\r\n      if(this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 && this.p.isProbablePrime(10)) break;\r\n    }\r\n    for(;;) {\r\n      this.q = new BigInteger(qs,1,rng);\r\n      if(this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 && this.q.isProbablePrime(10)) break;\r\n    }\r\n    if(this.p.compareTo(this.q) <= 0) {\r\n      var t = this.p;\r\n      this.p = this.q;\r\n      this.q = t;\r\n    }\r\n    var p1 = this.p.subtract(BigInteger.ONE);\r\n    var q1 = this.q.subtract(BigInteger.ONE);\r\n    var phi = p1.multiply(q1);\r\n    if(phi.gcd(ee).compareTo(BigInteger.ONE) == 0) {\r\n      this.n = this.p.multiply(this.q);\r\n      this.d = ee.modInverse(phi);\r\n      this.dmp1 = this.d.mod(p1);\r\n      this.dmq1 = this.d.mod(q1);\r\n      this.coeff = this.q.modInverse(this.p);\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\n// Perform raw private operation on \"x\": return x^d (mod n)\r\nfunction RSADoPrivate(x) {\r\n  if(this.p == null || this.q == null)\r\n    return x.modPow(this.d, this.n);\r\n\r\n  // TODO: re-calculate any missing CRT params\r\n  var xp = x.mod(this.p).modPow(this.dmp1, this.p);\r\n  var xq = x.mod(this.q).modPow(this.dmq1, this.q);\r\n\r\n  while(xp.compareTo(xq) < 0)\r\n    xp = xp.add(this.p);\r\n  return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq);\r\n}\r\n\r\n// Return the PKCS#1 RSA decryption of \"ctext\".\r\n// \"ctext\" is an even-length hex string and the output is a plain string.\r\nfunction RSADecrypt(ctext) {\r\n  var c = parseBigInt(ctext, 16);\r\n  var m = this.doPrivate(c);\r\n  if(m == null) return null;\r\n  return pkcs1unpad2(m, (this.n.bitLength()+7)>>3);\r\n}\r\n\r\n// Return the PKCS#1 RSA decryption of \"ctext\".\r\n// \"ctext\" is a Base64-encoded string and the output is a plain string.\r\n//function RSAB64Decrypt(ctext) {\r\n//  var h = b64tohex(ctext);\r\n//  if(h) return this.decrypt(h); else return null;\r\n//}\r\n\r\n// protected\r\nRSAKey.prototype.doPrivate = RSADoPrivate;\r\n\r\n// public\r\nRSAKey.prototype.setPrivate = RSASetPrivate;\r\nRSAKey.prototype.setPrivateEx = RSASetPrivateEx;\r\nRSAKey.prototype.generate = RSAGenerate;\r\nRSAKey.prototype.decrypt = RSADecrypt;\r\n//RSAKey.prototype.b64_decrypt = RSAB64Decrypt;","// Base64 JavaScript decoder\r\n// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>\r\n\r\n// Permission to use, copy, modify, and/or distribute this software for any\r\n// purpose with or without fee is hereby granted, provided that the above\r\n// copyright notice and this permission notice appear in all copies.\r\n// \r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n/*jshint browser: true, strict: true, immed: true, latedef: true, undef: true, regexdash: false */\r\n\r\nexport const Base64 = {};\r\nlet decoder;\r\n\r\nBase64.decode = function (a) {\r\n    var i;\r\n    if (decoder === undefined) {\r\n        var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",\r\n            ignore = \"= \\f\\n\\r\\t\\u00A0\\u2028\\u2029\";\r\n        decoder = [];\r\n        for (i = 0; i < 64; ++i)\r\n            decoder[b64.charAt(i)] = i;\r\n        for (i = 0; i < ignore.length; ++i)\r\n            decoder[ignore.charAt(i)] = -1;\r\n    }\r\n    var out = [];\r\n    var bits = 0, char_count = 0;\r\n    for (i = 0; i < a.length; ++i) {\r\n        var c = a.charAt(i);\r\n        if (c == '=')\r\n            break;\r\n        c = decoder[c];\r\n        if (c == -1)\r\n            continue;\r\n        if (c === undefined)\r\n            throw 'Illegal character at offset ' + i;\r\n        bits |= c;\r\n        if (++char_count >= 4) {\r\n            out[out.length] = (bits >> 16);\r\n            out[out.length] = (bits >> 8) & 0xFF;\r\n            out[out.length] = bits & 0xFF;\r\n            bits = 0;\r\n            char_count = 0;\r\n        } else {\r\n            bits <<= 6;\r\n        }\r\n    }\r\n    switch (char_count) {\r\n      case 1:\r\n        throw \"Base64 encoding incomplete: at least 2 bits missing\";\r\n      case 2:\r\n        out[out.length] = (bits >> 10);\r\n        break;\r\n      case 3:\r\n        out[out.length] = (bits >> 16);\r\n        out[out.length] = (bits >> 8) & 0xFF;\r\n        break;\r\n    }\r\n    return out;\r\n};\r\n\r\nBase64.re = /-----BEGIN [^-]+-----([A-Za-z0-9+\\/=\\s]+)-----END [^-]+-----|begin-base64[^\\n]+\\n([A-Za-z0-9+\\/=\\s]+)====/;\r\nBase64.unarmor = function (a) {\r\n    var m = Base64.re.exec(a);\r\n    if (m) {\r\n        if (m[1])\r\n            a = m[1];\r\n        else if (m[2])\r\n            a = m[2];\r\n        else\r\n            throw \"RegExp out of sync\";\r\n    }\r\n    return Base64.decode(a);\r\n};\r\n","// Hex JavaScript decoder\r\n// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>\r\n\r\n// Permission to use, copy, modify, and/or distribute this software for any\r\n// purpose with or without fee is hereby granted, provided that the above\r\n// copyright notice and this permission notice appear in all copies.\r\n// \r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n/*jshint browser: true, strict: true, immed: true, latedef: true, undef: true, regexdash: false */\r\nexport const Hex = {};\r\nlet decoder;\r\n\r\nHex.decode = function(a) {\r\n    var i;\r\n    if (decoder === undefined) {\r\n        var hex = \"0123456789ABCDEF\",\r\n            ignore = \" \\f\\n\\r\\t\\u00A0\\u2028\\u2029\";\r\n        decoder = [];\r\n        for (i = 0; i < 16; ++i)\r\n            decoder[hex.charAt(i)] = i;\r\n        hex = hex.toLowerCase();\r\n        for (i = 10; i < 16; ++i)\r\n            decoder[hex.charAt(i)] = i;\r\n        for (i = 0; i < ignore.length; ++i)\r\n            decoder[ignore.charAt(i)] = -1;\r\n    }\r\n    var out = [],\r\n        bits = 0,\r\n        char_count = 0;\r\n    for (i = 0; i < a.length; ++i) {\r\n        var c = a.charAt(i);\r\n        if (c == '=')\r\n            break;\r\n        c = decoder[c];\r\n        if (c == -1)\r\n            continue;\r\n        if (c === undefined)\r\n            throw 'Illegal character at offset ' + i;\r\n        bits |= c;\r\n        if (++char_count >= 2) {\r\n            out[out.length] = bits;\r\n            bits = 0;\r\n            char_count = 0;\r\n        } else {\r\n            bits <<= 4;\r\n        }\r\n    }\r\n    if (char_count)\r\n        throw \"Hex encoding incomplete: 4 bits missing\";\r\n    return out;\r\n};","import {BigInteger} from \"../jsbn/jsbn2\";\r\n/*! asn1-1.0.2.js (c) 2013 Kenji Urushima | kjur.github.com/jsrsasign/license\r\n */\r\n\r\nexport const JSX = /*window.JSX || */{};\r\nJSX.env = JSX.env || {};\r\n\r\nvar L = JSX, OP = Object.prototype, FUNCTION_TOSTRING = '[object Function]',ADD = [\"toString\", \"valueOf\"];\r\n\r\nJSX.env.parseUA = function(agent) {\r\n\r\n    var numberify = function(s) {\r\n        var c = 0;\r\n        return parseFloat(s.replace(/\\./g, function() {\r\n            return (c++ == 1) ? '' : '.';\r\n        }));\r\n    },\r\n\r\n    nav = navigator,\r\n    o = {\r\n        ie: 0,\r\n        opera: 0,\r\n        gecko: 0,\r\n        webkit: 0,\r\n        chrome: 0,\r\n        mobile: null,\r\n        air: 0,\r\n        ipad: 0,\r\n        iphone: 0,\r\n        ipod: 0,\r\n        ios: null,\r\n        android: 0,\r\n        webos: 0,\r\n        caja: nav && nav.cajaVersion,\r\n        secure: false,\r\n        os: null\r\n\r\n    },\r\n\r\n    ua = agent || (navigator && navigator.userAgent),\r\n    loc = window && window.location,\r\n    href = loc && loc.href,\r\n    m;\r\n\r\n    o.secure = href && (href.toLowerCase().indexOf(\"https\") === 0);\r\n\r\n    if (ua) {\r\n\r\n        if ((/windows|win32/i).test(ua)) {\r\n            o.os = 'windows';\r\n        } else if ((/macintosh/i).test(ua)) {\r\n            o.os = 'macintosh';\r\n        } else if ((/rhino/i).test(ua)) {\r\n            o.os = 'rhino';\r\n        }\r\n        if ((/KHTML/).test(ua)) {\r\n            o.webkit = 1;\r\n        }\r\n        m = ua.match(/AppleWebKit\\/([^\\s]*)/);\r\n        if (m && m[1]) {\r\n            o.webkit = numberify(m[1]);\r\n            if (/ Mobile\\//.test(ua)) {\r\n                o.mobile = 'Apple'; // iPhone or iPod Touch\r\n                m = ua.match(/OS ([^\\s]*)/);\r\n                if (m && m[1]) {\r\n                    m = numberify(m[1].replace('_', '.'));\r\n                }\r\n                o.ios = m;\r\n                o.ipad = o.ipod = o.iphone = 0;\r\n                m = ua.match(/iPad|iPod|iPhone/);\r\n                if (m && m[0]) {\r\n                    o[m[0].toLowerCase()] = o.ios;\r\n                }\r\n            } else {\r\n                m = ua.match(/NokiaN[^\\/]*|Android \\d\\.\\d|webOS\\/\\d\\.\\d/);\r\n                if (m) {\r\n                    o.mobile = m[0];\r\n                }\r\n                if (/webOS/.test(ua)) {\r\n                    o.mobile = 'WebOS';\r\n                    m = ua.match(/webOS\\/([^\\s]*);/);\r\n                    if (m && m[1]) {\r\n                        o.webos = numberify(m[1]);\r\n                    }\r\n                }\r\n                if (/ Android/.test(ua)) {\r\n                    o.mobile = 'Android';\r\n                    m = ua.match(/Android ([^\\s]*);/);\r\n                    if (m && m[1]) {\r\n                        o.android = numberify(m[1]);\r\n                    }\r\n                }\r\n            }\r\n            m = ua.match(/Chrome\\/([^\\s]*)/);\r\n            if (m && m[1]) {\r\n                o.chrome = numberify(m[1]); // Chrome\r\n            } else {\r\n                m = ua.match(/AdobeAIR\\/([^\\s]*)/);\r\n                if (m) {\r\n                    o.air = m[0]; // Adobe AIR 1.0 or better\r\n                }\r\n            }\r\n        }\r\n        if (!o.webkit) {\r\n            m = ua.match(/Opera[\\s\\/]([^\\s]*)/);\r\n            if (m && m[1]) {\r\n                o.opera = numberify(m[1]);\r\n                m = ua.match(/Version\\/([^\\s]*)/);\r\n                if (m && m[1]) {\r\n                    o.opera = numberify(m[1]); // opera 10+\r\n                }\r\n                m = ua.match(/Opera Mini[^;]*/);\r\n                if (m) {\r\n                    o.mobile = m[0]; // ex: Opera Mini/2.0.4509/1316\r\n                }\r\n            } else { // not opera or webkit\r\n                m = ua.match(/MSIE\\s([^;]*)/);\r\n                if (m && m[1]) {\r\n                    o.ie = numberify(m[1]);\r\n                } else { // not opera, webkit, or ie\r\n                    m = ua.match(/Gecko\\/([^\\s]*)/);\r\n                    if (m) {\r\n                        o.gecko = 1; // Gecko detected, look for revision\r\n                        m = ua.match(/rv:([^\\s\\)]*)/);\r\n                        if (m && m[1]) {\r\n                            o.gecko = numberify(m[1]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return o;\r\n};\r\n\r\nJSX.env.ua = JSX.env.parseUA();\r\n\r\nJSX.isFunction = function(o) {\r\n    return (typeof o === 'function') || OP.toString.apply(o) === FUNCTION_TOSTRING;\r\n};\r\n\r\nJSX._IEEnumFix = (JSX.env.ua.ie) ? function(r, s) {\r\n    var i, fname, f;\r\n    for (i=0;i<ADD.length;i=i+1) {\r\n\r\n        fname = ADD[i];\r\n        f = s[fname];\r\n\r\n        if (L.isFunction(f) && f!=OP[fname]) {\r\n            r[fname]=f;\r\n        }\r\n    }\r\n} : function(){};\r\n\r\nJSX.extend = function(subc, superc, overrides) {\r\n    if (!superc||!subc) {\r\n        throw new Error(\"extend failed, please check that \" +\r\n                        \"all dependencies are included.\");\r\n    }\r\n    var F = function() {}, i;\r\n    F.prototype=superc.prototype;\r\n    subc.prototype=new F();\r\n    subc.prototype.constructor=subc;\r\n    subc.superclass=superc.prototype;\r\n    if (superc.prototype.constructor == OP.constructor) {\r\n        superc.prototype.constructor=superc;\r\n    }\r\n\r\n    if (overrides) {\r\n        for (i in overrides) {\r\n            if (L.hasOwnProperty(overrides, i)) {\r\n                subc.prototype[i]=overrides[i];\r\n            }\r\n        }\r\n\r\n        L._IEEnumFix(subc.prototype, overrides);\r\n    }\r\n};\r\n\r\n/*\r\n * asn1.js - ASN.1 DER encoder classes\r\n *\r\n * Copyright (c) 2013 Kenji Urushima (kenji.urushima@gmail.com)\r\n *\r\n * This software is licensed under the terms of the MIT License.\r\n * http://kjur.github.com/jsrsasign/license\r\n *\r\n * The above copyright and license notice shall be \r\n * included in all copies or substantial portions of the Software.\r\n */\r\n\r\n/**\r\n * @fileOverview\r\n * @name asn1-1.0.js\r\n * @author Kenji Urushima kenji.urushima@gmail.com\r\n * @version 1.0.2 (2013-May-30)\r\n * @since 2.1\r\n * @license <a href=\"http://kjur.github.io/jsrsasign/license/\">MIT License</a>\r\n */\r\n\r\n/** \r\n * kjur's class library name space\r\n * <p>\r\n * This name space provides following name spaces:\r\n * <ul>\r\n * <li>{@link KJUR.asn1} - ASN.1 primitive hexadecimal encoder</li>\r\n * <li>{@link KJUR.asn1.x509} - ASN.1 structure for X.509 certificate and CRL</li>\r\n * <li>{@link KJUR.crypto} - Java Cryptographic Extension(JCE) style MessageDigest/Signature \r\n * class and utilities</li>\r\n * </ul>\r\n * </p> \r\n * NOTE: Please ignore method summary and document of this namespace. This caused by a bug of jsdoc2.\r\n  * @name KJUR\r\n * @namespace kjur's class library name space\r\n */\r\n// if (typeof KJUR == \"undefined\" || !KJUR)\r\nexport const KJUR = {};\r\n\r\n/**\r\n * kjur's ASN.1 class library name space\r\n * <p>\r\n * This is ITU-T X.690 ASN.1 DER encoder class library and\r\n * class structure and methods is very similar to \r\n * org.bouncycastle.asn1 package of \r\n * well known BouncyCaslte Cryptography Library.\r\n *\r\n * <h4>PROVIDING ASN.1 PRIMITIVES</h4>\r\n * Here are ASN.1 DER primitive classes.\r\n * <ul>\r\n * <li>{@link KJUR.asn1.DERBoolean}</li>\r\n * <li>{@link KJUR.asn1.DERInteger}</li>\r\n * <li>{@link KJUR.asn1.DERBitString}</li>\r\n * <li>{@link KJUR.asn1.DEROctetString}</li>\r\n * <li>{@link KJUR.asn1.DERNull}</li>\r\n * <li>{@link KJUR.asn1.DERObjectIdentifier}</li>\r\n * <li>{@link KJUR.asn1.DERUTF8String}</li>\r\n * <li>{@link KJUR.asn1.DERNumericString}</li>\r\n * <li>{@link KJUR.asn1.DERPrintableString}</li>\r\n * <li>{@link KJUR.asn1.DERTeletexString}</li>\r\n * <li>{@link KJUR.asn1.DERIA5String}</li>\r\n * <li>{@link KJUR.asn1.DERUTCTime}</li>\r\n * <li>{@link KJUR.asn1.DERGeneralizedTime}</li>\r\n * <li>{@link KJUR.asn1.DERSequence}</li>\r\n * <li>{@link KJUR.asn1.DERSet}</li>\r\n * </ul>\r\n *\r\n * <h4>OTHER ASN.1 CLASSES</h4>\r\n * <ul>\r\n * <li>{@link KJUR.asn1.ASN1Object}</li>\r\n * <li>{@link KJUR.asn1.DERAbstractString}</li>\r\n * <li>{@link KJUR.asn1.DERAbstractTime}</li>\r\n * <li>{@link KJUR.asn1.DERAbstractStructured}</li>\r\n * <li>{@link KJUR.asn1.DERTaggedObject}</li>\r\n * </ul>\r\n * </p>\r\n * NOTE: Please ignore method summary and document of this namespace. This caused by a bug of jsdoc2.\r\n * @name KJUR.asn1\r\n * @namespace\r\n */\r\nif (typeof KJUR.asn1 == \"undefined\" || !KJUR.asn1) KJUR.asn1 = {};\r\n\r\n/**\r\n * ASN1 utilities class\r\n * @name KJUR.asn1.ASN1Util\r\n * @classs ASN1 utilities class\r\n * @since asn1 1.0.2\r\n */\r\nKJUR.asn1.ASN1Util = new function() {\r\n    this.integerToByteHex = function(i) {\r\n\tvar h = i.toString(16);\r\n\tif ((h.length % 2) == 1) h = '0' + h;\r\n\treturn h;\r\n    };\r\n    this.bigIntToMinTwosComplementsHex = function(bigIntegerValue) {\r\n\tvar h = bigIntegerValue.toString(16);\r\n\tif (h.substr(0, 1) != '-') {\r\n\t    if (h.length % 2 == 1) {\r\n\t\th = '0' + h;\r\n\t    } else {\r\n\t\tif (! h.match(/^[0-7]/)) {\r\n\t\t    h = '00' + h;\r\n\t\t}\r\n\t    }\r\n\t} else {\r\n\t    var hPos = h.substr(1);\r\n\t    var xorLen = hPos.length;\r\n\t    if (xorLen % 2 == 1) {\r\n\t\txorLen += 1;\r\n\t    } else {\r\n\t\tif (! h.match(/^[0-7]/)) {\r\n\t\t    xorLen += 2;\r\n\t\t}\r\n\t    }\r\n\t    var hMask = '';\r\n\t    for (var i = 0; i < xorLen; i++) {\r\n\t\thMask += 'f';\r\n\t    }\r\n\t    var biMask = new BigInteger(hMask, 16);\r\n\t    var biNeg = biMask.xor(bigIntegerValue).add(BigInteger.ONE);\r\n\t    h = biNeg.toString(16).replace(/^-/, '');\r\n\t}\r\n\treturn h;\r\n    };\r\n    /**\r\n     * get PEM string from hexadecimal data and header string\r\n     * @name getPEMStringFromHex\r\n     * @memberOf KJUR.asn1.ASN1Util\r\n     * @function\r\n     * @param {String} dataHex hexadecimal string of PEM body\r\n     * @param {String} pemHeader PEM header string (ex. 'RSA PRIVATE KEY')\r\n     * @return {String} PEM formatted string of input data\r\n     * @description\r\n     * @example\r\n     * var pem  = KJUR.asn1.ASN1Util.getPEMStringFromHex('616161', 'RSA PRIVATE KEY');\r\n     * // value of pem will be:\r\n     * -----BEGIN PRIVATE KEY-----\r\n     * YWFh\r\n     * -----END PRIVATE KEY-----\r\n     */\r\n    this.getPEMStringFromHex = function(dataHex, pemHeader) {\r\n\tvar dataWA = CryptoJS.enc.Hex.parse(dataHex);\r\n\tvar dataB64 = CryptoJS.enc.Base64.stringify(dataWA);\r\n\tvar pemBody = dataB64.replace(/(.{64})/g, \"$1\\r\\n\");\r\n        pemBody = pemBody.replace(/\\r\\n$/, '');\r\n\treturn \"-----BEGIN \" + pemHeader + \"-----\\r\\n\" + \r\n               pemBody + \r\n               \"\\r\\n-----END \" + pemHeader + \"-----\\r\\n\";\r\n    };\r\n};\r\n\r\n// ********************************************************************\r\n//  Abstract ASN.1 Classes\r\n// ********************************************************************\r\n\r\n// ********************************************************************\r\n\r\n/**\r\n * base class for ASN.1 DER encoder object\r\n * @name KJUR.asn1.ASN1Object\r\n * @class base class for ASN.1 DER encoder object\r\n * @property {Boolean} isModified flag whether internal data was changed\r\n * @property {String} hTLV hexadecimal string of ASN.1 TLV\r\n * @property {String} hT hexadecimal string of ASN.1 TLV tag(T)\r\n * @property {String} hL hexadecimal string of ASN.1 TLV length(L)\r\n * @property {String} hV hexadecimal string of ASN.1 TLV value(V)\r\n * @description\r\n */\r\nKJUR.asn1.ASN1Object = function() {\r\n    var isModified = true;\r\n    var hTLV = null;\r\n    var hT = '00'\r\n    var hL = '00';\r\n    var hV = '';\r\n\r\n    /**\r\n     * get hexadecimal ASN.1 TLV length(L) bytes from TLV value(V)\r\n     * @name getLengthHexFromValue\r\n     * @memberOf KJUR.asn1.ASN1Object\r\n     * @function\r\n     * @return {String} hexadecimal string of ASN.1 TLV length(L)\r\n     */\r\n    this.getLengthHexFromValue = function() {\r\n\tif (typeof this.hV == \"undefined\" || this.hV == null) {\r\n\t    throw \"this.hV is null or undefined.\";\r\n\t}\r\n\tif (this.hV.length % 2 == 1) {\r\n\t    throw \"value hex must be even length: n=\" + hV.length + \",v=\" + this.hV;\r\n\t}\r\n\tvar n = this.hV.length / 2;\r\n\tvar hN = n.toString(16);\r\n\tif (hN.length % 2 == 1) {\r\n\t    hN = \"0\" + hN;\r\n\t}\r\n\tif (n < 128) {\r\n\t    return hN;\r\n\t} else {\r\n\t    var hNlen = hN.length / 2;\r\n\t    if (hNlen > 15) {\r\n\t\tthrow \"ASN.1 length too long to represent by 8x: n = \" + n.toString(16);\r\n\t    }\r\n\t    var head = 128 + hNlen;\r\n\t    return head.toString(16) + hN;\r\n\t}\r\n    };\r\n\r\n    /**\r\n     * get hexadecimal string of ASN.1 TLV bytes\r\n     * @name getEncodedHex\r\n     * @memberOf KJUR.asn1.ASN1Object\r\n     * @function\r\n     * @return {String} hexadecimal string of ASN.1 TLV\r\n     */\r\n    this.getEncodedHex = function() {\r\n\tif (this.hTLV == null || this.isModified) {\r\n\t    this.hV = this.getFreshValueHex();\r\n\t    this.hL = this.getLengthHexFromValue();\r\n\t    this.hTLV = this.hT + this.hL + this.hV;\r\n\t    this.isModified = false;\r\n\t    //console.error(\"first time: \" + this.hTLV);\r\n\t}\r\n\treturn this.hTLV;\r\n    };\r\n\r\n    /**\r\n     * get hexadecimal string of ASN.1 TLV value(V) bytes\r\n     * @name getValueHex\r\n     * @memberOf KJUR.asn1.ASN1Object\r\n     * @function\r\n     * @return {String} hexadecimal string of ASN.1 TLV value(V) bytes\r\n     */\r\n    this.getValueHex = function() {\r\n\tthis.getEncodedHex();\r\n\treturn this.hV;\r\n    }\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn '';\r\n    };\r\n};\r\n\r\n// == BEGIN DERAbstractString ================================================\r\n/**\r\n * base class for ASN.1 DER string classes\r\n * @name KJUR.asn1.DERAbstractString\r\n * @class base class for ASN.1 DER string classes\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @property {String} s internal string of value\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>str - specify initial ASN.1 value(V) by a string</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERAbstractString = function(params) {\r\n    KJUR.asn1.DERAbstractString.superclass.constructor.call(this);\r\n    var s = null;\r\n    var hV = null;\r\n\r\n    /**\r\n     * get string value of this string object\r\n     * @name getString\r\n     * @memberOf KJUR.asn1.DERAbstractString\r\n     * @function\r\n     * @return {String} string value of this string object\r\n     */\r\n    this.getString = function() {\r\n\treturn this.s;\r\n    };\r\n\r\n    /**\r\n     * set value by a string\r\n     * @name setString\r\n     * @memberOf KJUR.asn1.DERAbstractString\r\n     * @function\r\n     * @param {String} newS value by a string to set\r\n     */\r\n    this.setString = function(newS) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = newS;\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    /**\r\n     * set value by a hexadecimal string\r\n     * @name setStringHex\r\n     * @memberOf KJUR.asn1.DERAbstractString\r\n     * @function\r\n     * @param {String} newHexString value by a hexadecimal string to set\r\n     */\r\n    this.setStringHex = function(newHexString) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = null;\r\n\tthis.hV = newHexString;\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['str'] != \"undefined\") {\r\n\t    this.setString(params['str']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setStringHex(params['hex']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERAbstractString, KJUR.asn1.ASN1Object);\r\n// == END   DERAbstractString ================================================\r\n\r\n// == BEGIN DERAbstractTime ==================================================\r\n/**\r\n * base class for ASN.1 DER Generalized/UTCTime class\r\n * @name KJUR.asn1.DERAbstractTime\r\n * @class base class for ASN.1 DER Generalized/UTCTime class\r\n * @param {Array} params associative array of parameters (ex. {'str': '130430235959Z'})\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERAbstractTime = function(params) {\r\n    KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);\r\n    var s = null;\r\n    var date = null;\r\n\r\n    // --- PRIVATE METHODS --------------------\r\n    this.localDateToUTC = function(d) {\r\n\tutc = d.getTime() + (d.getTimezoneOffset() * 60000);\r\n\tvar utcDate = new Date(utc);\r\n\treturn utcDate;\r\n    };\r\n\r\n    this.formatDate = function(dateObject, type) {\r\n\tvar pad = this.zeroPadding;\r\n\tvar d = this.localDateToUTC(dateObject);\r\n\tvar year = String(d.getFullYear());\r\n\tif (type == 'utc') year = year.substr(2, 2);\r\n\tvar month = pad(String(d.getMonth() + 1), 2);\r\n\tvar day = pad(String(d.getDate()), 2);\r\n\tvar hour = pad(String(d.getHours()), 2);\r\n\tvar min = pad(String(d.getMinutes()), 2);\r\n\tvar sec = pad(String(d.getSeconds()), 2);\r\n\treturn year + month + day + hour + min + sec + 'Z';\r\n    };\r\n\r\n    this.zeroPadding = function(s, len) {\r\n\tif (s.length >= len) return s;\r\n\treturn new Array(len - s.length + 1).join('0') + s;\r\n    };\r\n\r\n    // --- PUBLIC METHODS --------------------\r\n    /**\r\n     * get string value of this string object\r\n     * @name getString\r\n     * @memberOf KJUR.asn1.DERAbstractTime\r\n     * @function\r\n     * @return {String} string value of this time object\r\n     */\r\n    this.getString = function() {\r\n\treturn this.s;\r\n    };\r\n\r\n    /**\r\n     * set value by a string\r\n     * @name setString\r\n     * @memberOf KJUR.asn1.DERAbstractTime\r\n     * @function\r\n     * @param {String} newS value by a string to set such like \"130430235959Z\"\r\n     */\r\n    this.setString = function(newS) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = newS;\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    /**\r\n     * set value by a Date object\r\n     * @name setByDateValue\r\n     * @memberOf KJUR.asn1.DERAbstractTime\r\n     * @function\r\n     * @param {Integer} year year of date (ex. 2013)\r\n     * @param {Integer} month month of date between 1 and 12 (ex. 12)\r\n     * @param {Integer} day day of month\r\n     * @param {Integer} hour hours of date\r\n     * @param {Integer} min minutes of date\r\n     * @param {Integer} sec seconds of date\r\n     */\r\n    this.setByDateValue = function(year, month, day, hour, min, sec) {\r\n\tvar dateObject = new Date(Date.UTC(year, month - 1, day, hour, min, sec, 0));\r\n\tthis.setByDate(dateObject);\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n};\r\nJSX.extend(KJUR.asn1.DERAbstractTime, KJUR.asn1.ASN1Object);\r\n// == END   DERAbstractTime ==================================================\r\n\r\n// == BEGIN DERAbstractStructured ============================================\r\n/**\r\n * base class for ASN.1 DER structured class\r\n * @name KJUR.asn1.DERAbstractStructured\r\n * @class base class for ASN.1 DER structured class\r\n * @property {Array} asn1Array internal array of ASN1Object\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERAbstractStructured = function(params) {\r\n    KJUR.asn1.DERAbstractString.superclass.constructor.call(this);\r\n    var asn1Array = null;\r\n\r\n    /**\r\n     * set value by array of ASN1Object\r\n     * @name setByASN1ObjectArray\r\n     * @memberOf KJUR.asn1.DERAbstractStructured\r\n     * @function\r\n     * @param {array} asn1ObjectArray array of ASN1Object to set\r\n     */\r\n    this.setByASN1ObjectArray = function(asn1ObjectArray) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.asn1Array = asn1ObjectArray;\r\n    };\r\n\r\n    /**\r\n     * append an ASN1Object to internal array\r\n     * @name appendASN1Object\r\n     * @memberOf KJUR.asn1.DERAbstractStructured\r\n     * @function\r\n     * @param {ASN1Object} asn1Object to add\r\n     */\r\n    this.appendASN1Object = function(asn1Object) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.asn1Array.push(asn1Object);\r\n    };\r\n\r\n    this.asn1Array = new Array();\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['array'] != \"undefined\") {\r\n\t    this.asn1Array = params['array'];\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERAbstractStructured, KJUR.asn1.ASN1Object);\r\n\r\n\r\n// ********************************************************************\r\n//  ASN.1 Object Classes\r\n// ********************************************************************\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Boolean\r\n * @name KJUR.asn1.DERBoolean\r\n * @class class for ASN.1 DER Boolean\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERBoolean = function() {\r\n    KJUR.asn1.DERBoolean.superclass.constructor.call(this);\r\n    this.hT = \"01\";\r\n    this.hTLV = \"0101ff\";\r\n};\r\nJSX.extend(KJUR.asn1.DERBoolean, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Integer\r\n * @name KJUR.asn1.DERInteger\r\n * @class class for ASN.1 DER Integer\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>int - specify initial ASN.1 value(V) by integer value</li>\r\n * <li>bigint - specify initial ASN.1 value(V) by BigInteger object</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERInteger = function(params) {\r\n    KJUR.asn1.DERInteger.superclass.constructor.call(this);\r\n    this.hT = \"02\";\r\n\r\n    /**\r\n     * set value by Tom Wu's BigInteger object\r\n     * @name setByBigInteger\r\n     * @memberOf KJUR.asn1.DERInteger\r\n     * @function\r\n     * @param {BigInteger} bigIntegerValue to set\r\n     */\r\n    this.setByBigInteger = function(bigIntegerValue) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(bigIntegerValue);\r\n    };\r\n\r\n    /**\r\n     * set value by integer value\r\n     * @name setByInteger\r\n     * @memberOf KJUR.asn1.DERInteger\r\n     * @function\r\n     * @param {Integer} integer value to set\r\n     */\r\n    this.setByInteger = function(intValue) {\r\n\tvar bi = new BigInteger(String(intValue), 10);\r\n\tthis.setByBigInteger(bi);\r\n    };\r\n\r\n    /**\r\n     * set value by integer value\r\n     * @name setValueHex\r\n     * @memberOf KJUR.asn1.DERInteger\r\n     * @function\r\n     * @param {String} hexadecimal string of integer value\r\n     * @description\r\n     * <br/>\r\n     * NOTE: Value shall be represented by minimum octet length of\r\n     * two's complement representation.\r\n     */\r\n    this.setValueHex = function(newHexString) {\r\n\tthis.hV = newHexString;\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['bigint'] != \"undefined\") {\r\n\t    this.setByBigInteger(params['bigint']);\r\n\t} else if (typeof params['int'] != \"undefined\") {\r\n\t    this.setByInteger(params['int']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setValueHex(params['hex']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERInteger, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER encoded BitString primitive\r\n * @name KJUR.asn1.DERBitString\r\n * @class class for ASN.1 DER encoded BitString primitive\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description \r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>bin - specify binary string (ex. '10111')</li>\r\n * <li>array - specify array of boolean (ex. [true,false,true,true])</li>\r\n * <li>hex - specify hexadecimal string of ASN.1 value(V) including unused bits</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERBitString = function(params) {\r\n    KJUR.asn1.DERBitString.superclass.constructor.call(this);\r\n    this.hT = \"03\";\r\n\r\n    /**\r\n     * set ASN.1 value(V) by a hexadecimal string including unused bits\r\n     * @name setHexValueIncludingUnusedBits\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {String} newHexStringIncludingUnusedBits\r\n     */\r\n    this.setHexValueIncludingUnusedBits = function(newHexStringIncludingUnusedBits) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = newHexStringIncludingUnusedBits;\r\n    };\r\n\r\n    /**\r\n     * set ASN.1 value(V) by unused bit and hexadecimal string of value\r\n     * @name setUnusedBitsAndHexValue\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {Integer} unusedBits\r\n     * @param {String} hValue\r\n     */\r\n    this.setUnusedBitsAndHexValue = function(unusedBits, hValue) {\r\n\tif (unusedBits < 0 || 7 < unusedBits) {\r\n\t    throw \"unused bits shall be from 0 to 7: u = \" + unusedBits;\r\n\t}\r\n\tvar hUnusedBits = \"0\" + unusedBits;\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = hUnusedBits + hValue;\r\n    };\r\n\r\n    /**\r\n     * set ASN.1 DER BitString by binary string\r\n     * @name setByBinaryString\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {String} binaryString binary value string (i.e. '10111')\r\n     * @description\r\n     * Its unused bits will be calculated automatically by length of \r\n     * 'binaryValue'. <br/>\r\n     * NOTE: Trailing zeros '0' will be ignored.\r\n     */\r\n    this.setByBinaryString = function(binaryString) {\r\n\tbinaryString = binaryString.replace(/0+$/, '');\r\n\tvar unusedBits = 8 - binaryString.length % 8;\r\n\tif (unusedBits == 8) unusedBits = 0;\r\n\tfor (var i = 0; i <= unusedBits; i++) {\r\n\t    binaryString += '0';\r\n\t}\r\n\tvar h = '';\r\n\tfor (var i = 0; i < binaryString.length - 1; i += 8) {\r\n\t    var b = binaryString.substr(i, 8);\r\n\t    var x = parseInt(b, 2).toString(16);\r\n\t    if (x.length == 1) x = '0' + x;\r\n\t    h += x;  \r\n\t}\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = '0' + unusedBits + h;\r\n    };\r\n\r\n    /**\r\n     * set ASN.1 TLV value(V) by an array of boolean\r\n     * @name setByBooleanArray\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {array} booleanArray array of boolean (ex. [true, false, true])\r\n     * @description\r\n     * NOTE: Trailing falses will be ignored.\r\n     */\r\n    this.setByBooleanArray = function(booleanArray) {\r\n\tvar s = '';\r\n\tfor (var i = 0; i < booleanArray.length; i++) {\r\n\t    if (booleanArray[i] == true) {\r\n\t\ts += '1';\r\n\t    } else {\r\n\t\ts += '0';\r\n\t    }\r\n\t}\r\n\tthis.setByBinaryString(s);\r\n    };\r\n\r\n    /**\r\n     * generate an array of false with specified length\r\n     * @name newFalseArray\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {Integer} nLength length of array to generate\r\n     * @return {array} array of boolean faluse\r\n     * @description\r\n     * This static method may be useful to initialize boolean array.\r\n     */\r\n    this.newFalseArray = function(nLength) {\r\n\tvar a = new Array(nLength);\r\n\tfor (var i = 0; i < nLength; i++) {\r\n\t    a[i] = false;\r\n\t}\r\n\treturn a;\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['hex'] != \"undefined\") {\r\n\t    this.setHexValueIncludingUnusedBits(params['hex']);\r\n\t} else if (typeof params['bin'] != \"undefined\") {\r\n\t    this.setByBinaryString(params['bin']);\r\n\t} else if (typeof params['array'] != \"undefined\") {\r\n\t    this.setByBooleanArray(params['array']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERBitString, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER OctetString\r\n * @name KJUR.asn1.DEROctetString\r\n * @class class for ASN.1 DER OctetString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DEROctetString = function(params) {\r\n    KJUR.asn1.DEROctetString.superclass.constructor.call(this, params);\r\n    this.hT = \"04\";\r\n};\r\nJSX.extend(KJUR.asn1.DEROctetString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Null\r\n * @name KJUR.asn1.DERNull\r\n * @class class for ASN.1 DER Null\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERNull = function() {\r\n    KJUR.asn1.DERNull.superclass.constructor.call(this);\r\n    this.hT = \"05\";\r\n    this.hTLV = \"0500\";\r\n};\r\nJSX.extend(KJUR.asn1.DERNull, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER ObjectIdentifier\r\n * @name KJUR.asn1.DERObjectIdentifier\r\n * @class class for ASN.1 DER ObjectIdentifier\r\n * @param {Array} params associative array of parameters (ex. {'oid': '2.5.4.5'})\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>oid - specify initial ASN.1 value(V) by a oid string (ex. 2.5.4.13)</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERObjectIdentifier = function(params) {\r\n    var itox = function(i) {\r\n\tvar h = i.toString(16);\r\n\tif (h.length == 1) h = '0' + h;\r\n\treturn h;\r\n    };\r\n    var roidtox = function(roid) {\r\n\tvar h = '';\r\n\tvar bi = new BigInteger(roid, 10);\r\n\tvar b = bi.toString(2);\r\n\tvar padLen = 7 - b.length % 7;\r\n\tif (padLen == 7) padLen = 0;\r\n\tvar bPad = '';\r\n\tfor (var i = 0; i < padLen; i++) bPad += '0';\r\n\tb = bPad + b;\r\n\tfor (var i = 0; i < b.length - 1; i += 7) {\r\n\t    var b8 = b.substr(i, 7);\r\n\t    if (i != b.length - 7) b8 = '1' + b8;\r\n\t    h += itox(parseInt(b8, 2));\r\n\t}\r\n\treturn h;\r\n    }\r\n\r\n    KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this);\r\n    this.hT = \"06\";\r\n\r\n    /**\r\n     * set value by a hexadecimal string\r\n     * @name setValueHex\r\n     * @memberOf KJUR.asn1.DERObjectIdentifier\r\n     * @function\r\n     * @param {String} newHexString hexadecimal value of OID bytes\r\n     */\r\n    this.setValueHex = function(newHexString) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = null;\r\n\tthis.hV = newHexString;\r\n    };\r\n\r\n    /**\r\n     * set value by a OID string\r\n     * @name setValueOidString\r\n     * @memberOf KJUR.asn1.DERObjectIdentifier\r\n     * @function\r\n     * @param {String} oidString OID string (ex. 2.5.4.13)\r\n     */\r\n    this.setValueOidString = function(oidString) {\r\n\tif (! oidString.match(/^[0-9.]+$/)) {\r\n\t    throw \"malformed oid string: \" + oidString;\r\n\t}\r\n\tvar h = '';\r\n\tvar a = oidString.split('.');\r\n\tvar i0 = parseInt(a[0]) * 40 + parseInt(a[1]);\r\n\th += itox(i0);\r\n\ta.splice(0, 2);\r\n\tfor (var i = 0; i < a.length; i++) {\r\n\t    h += roidtox(a[i]);\r\n\t}\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = null;\r\n\tthis.hV = h;\r\n    };\r\n\r\n    /**\r\n     * set value by a OID name\r\n     * @name setValueName\r\n     * @memberOf KJUR.asn1.DERObjectIdentifier\r\n     * @function\r\n     * @param {String} oidName OID name (ex. 'serverAuth')\r\n     * @since 1.0.1\r\n     * @description\r\n     * OID name shall be defined in 'KJUR.asn1.x509.OID.name2oidList'.\r\n     * Otherwise raise error.\r\n     */\r\n    this.setValueName = function(oidName) {\r\n\tif (typeof KJUR.asn1.x509.OID.name2oidList[oidName] != \"undefined\") {\r\n\t    var oid = KJUR.asn1.x509.OID.name2oidList[oidName];\r\n\t    this.setValueOidString(oid);\r\n\t} else {\r\n\t    throw \"DERObjectIdentifier oidName undefined: \" + oidName;\r\n\t}\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['oid'] != \"undefined\") {\r\n\t    this.setValueOidString(params['oid']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setValueHex(params['hex']);\r\n\t} else if (typeof params['name'] != \"undefined\") {\r\n\t    this.setValueName(params['name']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERObjectIdentifier, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER UTF8String\r\n * @name KJUR.asn1.DERUTF8String\r\n * @class class for ASN.1 DER UTF8String\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERUTF8String = function(params) {\r\n    KJUR.asn1.DERUTF8String.superclass.constructor.call(this, params);\r\n    this.hT = \"0c\";\r\n};\r\nJSX.extend(KJUR.asn1.DERUTF8String, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER NumericString\r\n * @name KJUR.asn1.DERNumericString\r\n * @class class for ASN.1 DER NumericString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERNumericString = function(params) {\r\n    KJUR.asn1.DERNumericString.superclass.constructor.call(this, params);\r\n    this.hT = \"12\";\r\n};\r\nJSX.extend(KJUR.asn1.DERNumericString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER PrintableString\r\n * @name KJUR.asn1.DERPrintableString\r\n * @class class for ASN.1 DER PrintableString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERPrintableString = function(params) {\r\n    KJUR.asn1.DERPrintableString.superclass.constructor.call(this, params);\r\n    this.hT = \"13\";\r\n};\r\nJSX.extend(KJUR.asn1.DERPrintableString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER TeletexString\r\n * @name KJUR.asn1.DERTeletexString\r\n * @class class for ASN.1 DER TeletexString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERTeletexString = function(params) {\r\n    KJUR.asn1.DERTeletexString.superclass.constructor.call(this, params);\r\n    this.hT = \"14\";\r\n};\r\nJSX.extend(KJUR.asn1.DERTeletexString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER IA5String\r\n * @name KJUR.asn1.DERIA5String\r\n * @class class for ASN.1 DER IA5String\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERIA5String = function(params) {\r\n    KJUR.asn1.DERIA5String.superclass.constructor.call(this, params);\r\n    this.hT = \"16\";\r\n};\r\nJSX.extend(KJUR.asn1.DERIA5String, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER UTCTime\r\n * @name KJUR.asn1.DERUTCTime\r\n * @class class for ASN.1 DER UTCTime\r\n * @param {Array} params associative array of parameters (ex. {'str': '130430235959Z'})\r\n * @extends KJUR.asn1.DERAbstractTime\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>str - specify initial ASN.1 value(V) by a string (ex.'130430235959Z')</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * <li>date - specify Date object.</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n * <h4>EXAMPLES</h4>\r\n * @example\r\n * var d1 = new KJUR.asn1.DERUTCTime();\r\n * d1.setString('130430125959Z');\r\n *\r\n * var d2 = new KJUR.asn1.DERUTCTime({'str': '130430125959Z'});\r\n *\r\n * var d3 = new KJUR.asn1.DERUTCTime({'date': new Date(Date.UTC(2015, 0, 31, 0, 0, 0, 0))});\r\n */\r\nKJUR.asn1.DERUTCTime = function(params) {\r\n    KJUR.asn1.DERUTCTime.superclass.constructor.call(this, params);\r\n    this.hT = \"17\";\r\n\r\n    /**\r\n     * set value by a Date object\r\n     * @name setByDate\r\n     * @memberOf KJUR.asn1.DERUTCTime\r\n     * @function\r\n     * @param {Date} dateObject Date object to set ASN.1 value(V)\r\n     */\r\n    this.setByDate = function(dateObject) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.date = dateObject;\r\n\tthis.s = this.formatDate(this.date, 'utc');\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['str'] != \"undefined\") {\r\n\t    this.setString(params['str']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setStringHex(params['hex']);\r\n\t} else if (typeof params['date'] != \"undefined\") {\r\n\t    this.setByDate(params['date']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERUTCTime, KJUR.asn1.DERAbstractTime);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER GeneralizedTime\r\n * @name KJUR.asn1.DERGeneralizedTime\r\n * @class class for ASN.1 DER GeneralizedTime\r\n * @param {Array} params associative array of parameters (ex. {'str': '20130430235959Z'})\r\n * @extends KJUR.asn1.DERAbstractTime\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>str - specify initial ASN.1 value(V) by a string (ex.'20130430235959Z')</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * <li>date - specify Date object.</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERGeneralizedTime = function(params) {\r\n    KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this, params);\r\n    this.hT = \"18\";\r\n\r\n    /**\r\n     * set value by a Date object\r\n     * @name setByDate\r\n     * @memberOf KJUR.asn1.DERGeneralizedTime\r\n     * @function\r\n     * @param {Date} dateObject Date object to set ASN.1 value(V)\r\n     * @example\r\n     * When you specify UTC time, use 'Date.UTC' method like this:<br/>\r\n     * var o = new DERUTCTime();\r\n     * var date = new Date(Date.UTC(2015, 0, 31, 23, 59, 59, 0)); #2015JAN31 23:59:59\r\n     * o.setByDate(date);\r\n     */\r\n    this.setByDate = function(dateObject) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.date = dateObject;\r\n\tthis.s = this.formatDate(this.date, 'gen');\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['str'] != \"undefined\") {\r\n\t    this.setString(params['str']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setStringHex(params['hex']);\r\n\t} else if (typeof params['date'] != \"undefined\") {\r\n\t    this.setByDate(params['date']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERGeneralizedTime, KJUR.asn1.DERAbstractTime);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Sequence\r\n * @name KJUR.asn1.DERSequence\r\n * @class class for ASN.1 DER Sequence\r\n * @extends KJUR.asn1.DERAbstractStructured\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>array - specify array of ASN1Object to set elements of content</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERSequence = function(params) {\r\n    KJUR.asn1.DERSequence.superclass.constructor.call(this, params);\r\n    this.hT = \"30\";\r\n    this.getFreshValueHex = function() {\r\n\tvar h = '';\r\n\tfor (var i = 0; i < this.asn1Array.length; i++) {\r\n\t    var asn1Obj = this.asn1Array[i];\r\n\t    h += asn1Obj.getEncodedHex();\r\n\t}\r\n\tthis.hV = h;\r\n\treturn this.hV;\r\n    };\r\n};\r\nJSX.extend(KJUR.asn1.DERSequence, KJUR.asn1.DERAbstractStructured);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Set\r\n * @name KJUR.asn1.DERSet\r\n * @class class for ASN.1 DER Set\r\n * @extends KJUR.asn1.DERAbstractStructured\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>array - specify array of ASN1Object to set elements of content</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERSet = function(params) {\r\n    KJUR.asn1.DERSet.superclass.constructor.call(this, params);\r\n    this.hT = \"31\";\r\n    this.getFreshValueHex = function() {\r\n\tvar a = new Array();\r\n\tfor (var i = 0; i < this.asn1Array.length; i++) {\r\n\t    var asn1Obj = this.asn1Array[i];\r\n\t    a.push(asn1Obj.getEncodedHex());\r\n\t}\r\n\ta.sort();\r\n\tthis.hV = a.join('');\r\n\treturn this.hV;\r\n    };\r\n};\r\nJSX.extend(KJUR.asn1.DERSet, KJUR.asn1.DERAbstractStructured);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER TaggedObject\r\n * @name KJUR.asn1.DERTaggedObject\r\n * @class class for ASN.1 DER TaggedObject\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * Parameter 'tagNoNex' is ASN.1 tag(T) value for this object.\r\n * For example, if you find '[1]' tag in a ASN.1 dump, \r\n * 'tagNoHex' will be 'a1'.\r\n * <br/>\r\n * As for optional argument 'params' for constructor, you can specify *ANY* of\r\n * following properties:\r\n * <ul>\r\n * <li>explicit - specify true if this is explicit tag otherwise false \r\n *     (default is 'true').</li>\r\n * <li>tag - specify tag (default is 'a0' which means [0])</li>\r\n * <li>obj - specify ASN1Object which is tagged</li>\r\n * </ul>\r\n * @example\r\n * d1 = new KJUR.asn1.DERUTF8String({'str':'a'});\r\n * d2 = new KJUR.asn1.DERTaggedObject({'obj': d1});\r\n * hex = d2.getEncodedHex();\r\n */\r\nKJUR.asn1.DERTaggedObject = function(params) {\r\n    KJUR.asn1.DERTaggedObject.superclass.constructor.call(this);\r\n    this.hT = \"a0\";\r\n    this.hV = '';\r\n    this.isExplicit = true;\r\n    this.asn1Object = null;\r\n\r\n    /**\r\n     * set value by an ASN1Object\r\n     * @name setString\r\n     * @memberOf KJUR.asn1.DERTaggedObject\r\n     * @function\r\n     * @param {Boolean} isExplicitFlag flag for explicit/implicit tag\r\n     * @param {Integer} tagNoHex hexadecimal string of ASN.1 tag\r\n     * @param {ASN1Object} asn1Object ASN.1 to encapsulate\r\n     */\r\n    this.setASN1Object = function(isExplicitFlag, tagNoHex, asn1Object) {\r\n\tthis.hT = tagNoHex;\r\n\tthis.isExplicit = isExplicitFlag;\r\n\tthis.asn1Object = asn1Object;\r\n\tif (this.isExplicit) {\r\n\t    this.hV = this.asn1Object.getEncodedHex();\r\n\t    this.hTLV = null;\r\n\t    this.isModified = true;\r\n\t} else {\r\n\t    this.hV = null;\r\n\t    this.hTLV = asn1Object.getEncodedHex();\r\n\t    this.hTLV = this.hTLV.replace(/^../, tagNoHex);\r\n\t    this.isModified = false;\r\n\t}\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['tag'] != \"undefined\") {\r\n\t    this.hT = params['tag'];\r\n\t}\r\n\tif (typeof params['explicit'] != \"undefined\") {\r\n\t    this.isExplicit = params['explicit'];\r\n\t}\r\n\tif (typeof params['obj'] != \"undefined\") {\r\n\t    this.asn1Object = params['obj'];\r\n\t    this.setASN1Object(this.isExplicit, this.hT, this.asn1Object);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERTaggedObject, KJUR.asn1.ASN1Object);","import {int2char} from \"./jsbn\";\r\n\r\nvar b64map=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\nvar b64pad=\"=\";\r\n\r\nexport function hex2b64(h) {\r\n  var i;\r\n  var c;\r\n  var ret = \"\";\r\n  for(i = 0; i+3 <= h.length; i+=3) {\r\n    c = parseInt(h.substring(i,i+3),16);\r\n    ret += b64map.charAt(c >> 6) + b64map.charAt(c & 63);\r\n  }\r\n  if(i+1 == h.length) {\r\n    c = parseInt(h.substring(i,i+1),16);\r\n    ret += b64map.charAt(c << 2);\r\n  }\r\n  else if(i+2 == h.length) {\r\n    c = parseInt(h.substring(i,i+2),16);\r\n    ret += b64map.charAt(c >> 2) + b64map.charAt((c & 3) << 4);\r\n  }\r\n  while((ret.length & 3) > 0) ret += b64pad;\r\n  return ret;\r\n}\r\n\r\n// convert a base64 string to hex\r\nexport function b64tohex(s) {\r\n  var ret = \"\";\r\n  var i;\r\n  var k = 0; // b64 state, 0-3\r\n  var slop;\r\n  for(i = 0; i < s.length; ++i) {\r\n    if(s.charAt(i) == b64pad) break;\r\n    let v = b64map.indexOf(s.charAt(i));\r\n    if(v < 0) continue;\r\n    if(k == 0) {\r\n      ret += int2char(v >> 2);\r\n      slop = v & 3;\r\n      k = 1;\r\n    }\r\n    else if(k == 1) {\r\n      ret += int2char((slop << 2) | (v >> 4));\r\n      slop = v & 0xf;\r\n      k = 2;\r\n    }\r\n    else if(k == 2) {\r\n      ret += int2char(slop);\r\n      ret += int2char(v >> 2);\r\n      slop = v & 3;\r\n      k = 3;\r\n    }\r\n    else {\r\n      ret += int2char((slop << 2) | (v >> 4));\r\n      ret += int2char(v & 0xf);\r\n      k = 0;\r\n    }\r\n  }\r\n  if(k == 1)\r\n    ret += int2char(slop << 2);\r\n  return ret;\r\n}\r\n\r\n// convert a base64 string to a byte/number array\r\nexport function b64toBA(s) {\r\n  //piggyback on b64tohex for now, optimize later\r\n  var h = b64tohex(s);\r\n  var i;\r\n  var a = [];\r\n  for(i = 0; 2*i < h.length; ++i) {\r\n    a[i] = parseInt(h.substring(2*i,2*i+2),16);\r\n  }\r\n  return a;\r\n}\r\n","import {ASN1} from \"../lib/asn1js/asn1\";\r\nimport {RSAKey} from \"../lib/jsbn/rsa2\";\r\nimport {Base64} from \"../lib/asn1js/base64\";\r\nimport {Hex} from \"../lib/asn1js/hex\";\r\nimport {parseBigInt} from \"../lib/jsbn/rsa\";\r\nimport {KJUR} from \"../lib/jsrsasign/asn1-1.0\";\r\nimport {hex2b64} from \"../lib/jsbn/base64\";\r\nimport {b64tohex} from \"../lib/jsbn/base64\";\r\n/**\r\n * Retrieve the hexadecimal value (as a string) of the current ASN.1 element\r\n * @returns {string}\r\n * @public\r\n */\r\nASN1.prototype.getHexStringValue = function () {\r\n  var hexString = this.toHexString();\r\n  var offset = this.header * 2;\r\n  var length = this.length * 2;\r\n  return hexString.substr(offset, length);\r\n};\r\n\r\n/**\r\n * Method to parse a pem encoded string containing both a public or private key.\r\n * The method will translate the pem encoded string in a der encoded string and\r\n * will parse private key and public key parameters. This method accepts public key\r\n * in the rsaencryption pkcs #1 format (oid: 1.2.840.113549.1.1.1).\r\n *\r\n * @todo Check how many rsa formats use the same format of pkcs #1.\r\n *\r\n * The format is defined as:\r\n * PublicKeyInfo ::= SEQUENCE {\r\n *   algorithm       AlgorithmIdentifier,\r\n *   PublicKey       BIT STRING\r\n * }\r\n * Where AlgorithmIdentifier is:\r\n * AlgorithmIdentifier ::= SEQUENCE {\r\n *   algorithm       OBJECT IDENTIFIER,     the OID of the enc algorithm\r\n *   parameters      ANY DEFINED BY algorithm OPTIONAL (NULL for PKCS #1)\r\n * }\r\n * and PublicKey is a SEQUENCE encapsulated in a BIT STRING\r\n * RSAPublicKey ::= SEQUENCE {\r\n *   modulus           INTEGER,  -- n\r\n *   publicExponent    INTEGER   -- e\r\n * }\r\n * it's possible to examine the structure of the keys obtained from openssl using\r\n * an asn.1 dumper as the one used here to parse the components: http://lapo.it/asn1js/\r\n * @argument {string} pem the pem encoded string, can include the BEGIN/END header/footer\r\n * @private\r\n */\r\nRSAKey.prototype.parseKey = function (pem) {\r\n  try {\r\n    var modulus = 0;\r\n    var public_exponent = 0;\r\n    var reHex = /^\\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\\s*)+$/;\r\n    var der = reHex.test(pem) ? Hex.decode(pem) : Base64.unarmor(pem);\r\n    var asn1 = ASN1.decode(der);\r\n\r\n    //Fixes a bug with OpenSSL 1.0+ private keys\r\n    if(asn1.sub.length === 3){\r\n        asn1 = asn1.sub[2].sub[0];\r\n    }\r\n    if (asn1.sub.length === 9) {\r\n\r\n      // Parse the private key.\r\n      modulus = asn1.sub[1].getHexStringValue(); //bigint\r\n      this.n = parseBigInt(modulus, 16);\r\n\r\n      public_exponent = asn1.sub[2].getHexStringValue(); //int\r\n      this.e = parseInt(public_exponent, 16);\r\n\r\n      var private_exponent = asn1.sub[3].getHexStringValue(); //bigint\r\n      this.d = parseBigInt(private_exponent, 16);\r\n\r\n      var prime1 = asn1.sub[4].getHexStringValue(); //bigint\r\n      this.p = parseBigInt(prime1, 16);\r\n\r\n      var prime2 = asn1.sub[5].getHexStringValue(); //bigint\r\n      this.q = parseBigInt(prime2, 16);\r\n\r\n      var exponent1 = asn1.sub[6].getHexStringValue(); //bigint\r\n      this.dmp1 = parseBigInt(exponent1, 16);\r\n\r\n      var exponent2 = asn1.sub[7].getHexStringValue(); //bigint\r\n      this.dmq1 = parseBigInt(exponent2, 16);\r\n\r\n      var coefficient = asn1.sub[8].getHexStringValue(); //bigint\r\n      this.coeff = parseBigInt(coefficient, 16);\r\n\r\n    }\r\n    else if (asn1.sub.length === 2) {\r\n\r\n      // Parse the public key.\r\n      var bit_string = asn1.sub[1];\r\n      var sequence = bit_string.sub[0];\r\n\r\n      modulus = sequence.sub[0].getHexStringValue();\r\n      this.n = parseBigInt(modulus, 16);\r\n      public_exponent = sequence.sub[1].getHexStringValue();\r\n      this.e = parseInt(public_exponent, 16);\r\n\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  catch (ex) {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Translate rsa parameters in a hex encoded string representing the rsa key.\r\n *\r\n * The translation follow the ASN.1 notation :\r\n * RSAPrivateKey ::= SEQUENCE {\r\n *   version           Version,\r\n *   modulus           INTEGER,  -- n\r\n *   publicExponent    INTEGER,  -- e\r\n *   privateExponent   INTEGER,  -- d\r\n *   prime1            INTEGER,  -- p\r\n *   prime2            INTEGER,  -- q\r\n *   exponent1         INTEGER,  -- d mod (p1)\r\n *   exponent2         INTEGER,  -- d mod (q-1)\r\n *   coefficient       INTEGER,  -- (inverse of q) mod p\r\n * }\r\n * @returns {string}  DER Encoded String representing the rsa private key\r\n * @private\r\n */\r\nRSAKey.prototype.getPrivateBaseKey = function () {\r\n  var options = {\r\n    'array': [\r\n      new KJUR.asn1.DERInteger({'int': 0}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.n}),\r\n      new KJUR.asn1.DERInteger({'int': this.e}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.d}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.p}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.q}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.dmp1}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.dmq1}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.coeff})\r\n    ]\r\n  };\r\n  var seq = new KJUR.asn1.DERSequence(options);\r\n  return seq.getEncodedHex();\r\n};\r\n\r\n/**\r\n * base64 (pem) encoded version of the DER encoded representation\r\n * @returns {string} pem encoded representation without header and footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPrivateBaseKeyB64 = function () {\r\n  return hex2b64(this.getPrivateBaseKey());\r\n};\r\n\r\n/**\r\n * Translate rsa parameters in a hex encoded string representing the rsa public key.\r\n * The representation follow the ASN.1 notation :\r\n * PublicKeyInfo ::= SEQUENCE {\r\n *   algorithm       AlgorithmIdentifier,\r\n *   PublicKey       BIT STRING\r\n * }\r\n * Where AlgorithmIdentifier is:\r\n * AlgorithmIdentifier ::= SEQUENCE {\r\n *   algorithm       OBJECT IDENTIFIER,     the OID of the enc algorithm\r\n *   parameters      ANY DEFINED BY algorithm OPTIONAL (NULL for PKCS #1)\r\n * }\r\n * and PublicKey is a SEQUENCE encapsulated in a BIT STRING\r\n * RSAPublicKey ::= SEQUENCE {\r\n *   modulus           INTEGER,  -- n\r\n *   publicExponent    INTEGER   -- e\r\n * }\r\n * @returns {string} DER Encoded String representing the rsa public key\r\n * @private\r\n */\r\nRSAKey.prototype.getPublicBaseKey = function () {\r\n  var options = {\r\n    'array': [\r\n      new KJUR.asn1.DERObjectIdentifier({'oid': '1.2.840.113549.1.1.1'}), //RSA Encryption pkcs #1 oid\r\n      new KJUR.asn1.DERNull()\r\n    ]\r\n  };\r\n  var first_sequence = new KJUR.asn1.DERSequence(options);\r\n\r\n  options = {\r\n    'array': [\r\n      new KJUR.asn1.DERInteger({'bigint': this.n}),\r\n      new KJUR.asn1.DERInteger({'int': this.e})\r\n    ]\r\n  };\r\n  var second_sequence = new KJUR.asn1.DERSequence(options);\r\n\r\n  options = {\r\n    'hex': '00' + second_sequence.getEncodedHex()\r\n  };\r\n  var bit_string = new KJUR.asn1.DERBitString(options);\r\n\r\n  options = {\r\n    'array': [\r\n      first_sequence,\r\n      bit_string\r\n    ]\r\n  };\r\n  var seq = new KJUR.asn1.DERSequence(options);\r\n  return seq.getEncodedHex();\r\n};\r\n\r\n/**\r\n * base64 (pem) encoded version of the DER encoded representation\r\n * @returns {string} pem encoded representation without header and footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPublicBaseKeyB64 = function () {\r\n  return hex2b64(this.getPublicBaseKey());\r\n};\r\n\r\n/**\r\n * wrap the string in block of width chars. The default value for rsa keys is 64\r\n * characters.\r\n * @param {string} str the pem encoded string without header and footer\r\n * @param {Number} [width=64] - the length the string has to be wrapped at\r\n * @returns {string}\r\n * @private\r\n */\r\nRSAKey.prototype.wordwrap = function (str, width) {\r\n  width = width || 64;\r\n  if (!str) {\r\n    return str;\r\n  }\r\n  var regex = '(.{1,' + width + '})( +|$\\n?)|(.{1,' + width + '})';\r\n  return str.match(RegExp(regex, 'g')).join('\\n');\r\n};\r\n\r\n/**\r\n * Retrieve the pem encoded private key\r\n * @returns {string} the pem encoded private key with header/footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPrivateKey = function () {\r\n  var key = \"-----BEGIN RSA PRIVATE KEY-----\\n\";\r\n  key += this.wordwrap(this.getPrivateBaseKeyB64()) + \"\\n\";\r\n  key += \"-----END RSA PRIVATE KEY-----\";\r\n  return key;\r\n};\r\n\r\n/**\r\n * Retrieve the pem encoded public key\r\n * @returns {string} the pem encoded public key with header/footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPublicKey = function () {\r\n  var key = \"-----BEGIN PUBLIC KEY-----\\n\";\r\n  key += this.wordwrap(this.getPublicBaseKeyB64()) + \"\\n\";\r\n  key += \"-----END PUBLIC KEY-----\";\r\n  return key;\r\n};\r\n\r\n/**\r\n * Check if the object contains the necessary parameters to populate the rsa modulus\r\n * and public exponent parameters.\r\n * @param {Object} [obj={}] - An object that may contain the two public key\r\n * parameters\r\n * @returns {boolean} true if the object contains both the modulus and the public exponent\r\n * properties (n and e)\r\n * @todo check for types of n and e. N should be a parseable bigInt object, E should\r\n * be a parseable integer number\r\n * @private\r\n */\r\nRSAKey.prototype.hasPublicKeyProperty = function (obj) {\r\n  obj = obj || {};\r\n  return (\r\n    obj.hasOwnProperty('n') &&\r\n    obj.hasOwnProperty('e')\r\n  );\r\n};\r\n\r\n/**\r\n * Check if the object contains ALL the parameters of an RSA key.\r\n * @param {Object} [obj={}] - An object that may contain nine rsa key\r\n * parameters\r\n * @returns {boolean} true if the object contains all the parameters needed\r\n * @todo check for types of the parameters all the parameters but the public exponent\r\n * should be parseable bigint objects, the public exponent should be a parseable integer number\r\n * @private\r\n */\r\nRSAKey.prototype.hasPrivateKeyProperty = function (obj) {\r\n  obj = obj || {};\r\n  return (\r\n    obj.hasOwnProperty('n') &&\r\n    obj.hasOwnProperty('e') &&\r\n    obj.hasOwnProperty('d') &&\r\n    obj.hasOwnProperty('p') &&\r\n    obj.hasOwnProperty('q') &&\r\n    obj.hasOwnProperty('dmp1') &&\r\n    obj.hasOwnProperty('dmq1') &&\r\n    obj.hasOwnProperty('coeff')\r\n  );\r\n};\r\n\r\n/**\r\n * Parse the properties of obj in the current rsa object. Obj should AT LEAST\r\n * include the modulus and public exponent (n, e) parameters.\r\n * @param {Object} obj - the object containing rsa parameters\r\n * @private\r\n */\r\nRSAKey.prototype.parsePropertiesFrom = function (obj) {\r\n  this.n = obj.n;\r\n  this.e = obj.e;\r\n\r\n  if (obj.hasOwnProperty('d')) {\r\n    this.d = obj.d;\r\n    this.p = obj.p;\r\n    this.q = obj.q;\r\n    this.dmp1 = obj.dmp1;\r\n    this.dmq1 = obj.dmq1;\r\n    this.coeff = obj.coeff;\r\n  }\r\n};\r\n\r\n/**\r\n * Create a new JSEncryptRSAKey that extends Tom Wu's RSA key object.\r\n * This object is just a decorator for parsing the key parameter\r\n * @param {string|Object} key - The key in string format, or an object containing\r\n * the parameters needed to build a RSAKey object.\r\n * @constructor\r\n */\r\nclass JSEncryptRSAKey extends RSAKey {\r\n  constructor(key) {\r\n    // Call the super constructor.\r\n    super();\r\n    // If a key key was provided.\r\n    if (key) {\r\n      // If this is a string...\r\n      if (typeof key === 'string') {\r\n        this.parseKey(key);\r\n      }\r\n      else if (\r\n          this.hasPrivateKeyProperty(key) ||\r\n          this.hasPublicKeyProperty(key)\r\n      ) {\r\n        // Set the values for the key.\r\n        this.parsePropertiesFrom(key);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * @param {Object} [options = {}] - An object to customize JSEncrypt behaviour\r\n * possible parameters are:\r\n * - default_key_size        {number}  default: 1024 the key size in bit\r\n * - default_public_exponent {string}  default: '010001' the hexadecimal representation of the public exponent\r\n * - log                     {boolean} default: false whether log warn/error or not\r\n * @constructor\r\n */\r\nexport class JSEncrypt{\r\n  constructor (options) {\r\n    options = options || {};\r\n    this.default_key_size = parseInt(options.default_key_size) || 1024;\r\n    this.default_public_exponent = options.default_public_exponent || '010001'; //65537 default openssl public exponent for rsa key type\r\n    this.log = options.log || false;\r\n    // The private and public key.\r\n    this.key = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Method to set the rsa key parameter (one method is enough to set both the public\r\n * and the private key, since the private key contains the public key paramenters)\r\n * Log a warning if logs are enabled\r\n * @param {Object|string} key the pem encoded string or an object (with or without header/footer)\r\n * @public\r\n */\r\nJSEncrypt.prototype.setKey = function (key) {\r\n  if (this.log && this.key) {\r\n    console.warn('A key was already set, overriding existing.');\r\n  }\r\n  this.key = new JSEncryptRSAKey(key);\r\n};\r\n\r\n/**\r\n * Proxy method for setKey, for api compatibility\r\n * @see setKey\r\n * @public\r\n */\r\nJSEncrypt.prototype.setPrivateKey = function (privkey) {\r\n  // Create the key.\r\n  this.setKey(privkey);\r\n};\r\n\r\n/**\r\n * Proxy method for setKey, for api compatibility\r\n * @see setKey\r\n * @public\r\n */\r\nJSEncrypt.prototype.setPublicKey = function (pubkey) {\r\n  // Sets the public key.\r\n  this.setKey(pubkey);\r\n};\r\n\r\n/**\r\n * Proxy method for RSAKey object's decrypt, decrypt the string using the private\r\n * components of the rsa key object. Note that if the object was not set will be created\r\n * on the fly (by the getKey method) using the parameters passed in the JSEncrypt constructor\r\n * @param {string} string base64 encoded crypted string to decrypt\r\n * @return {string} the decrypted string\r\n * @public\r\n */\r\nJSEncrypt.prototype.decrypt = function (string) {\r\n  // Return the decrypted string.\r\n  try {\r\n    return this.getKey().decrypt(b64tohex(string));\r\n  }\r\n  catch (ex) {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Proxy method for RSAKey object's encrypt, encrypt the string using the public\r\n * components of the rsa key object. Note that if the object was not set will be created\r\n * on the fly (by the getKey method) using the parameters passed in the JSEncrypt constructor\r\n * @param {string} string the string to encrypt\r\n * @return {string} the encrypted string encoded in base64\r\n * @public\r\n */\r\nJSEncrypt.prototype.encrypt = function (string) {\r\n  // Return the encrypted string.\r\n  try {\r\n    return hex2b64(this.getKey().encrypt(string));\r\n  }\r\n  catch (ex) {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Getter for the current JSEncryptRSAKey object. If it doesn't exists a new object\r\n * will be created and returned\r\n * @param {callback} [cb] the callback to be called if we want the key to be generated\r\n * in an async fashion\r\n * @returns {JSEncryptRSAKey} the JSEncryptRSAKey object\r\n * @public\r\n */\r\nJSEncrypt.prototype.getKey = function (cb) {\r\n  // Only create new if it does not exist.\r\n  if (!this.key) {\r\n    // Get a new private key.\r\n    this.key = new JSEncryptRSAKey();\r\n    if (cb && {}.toString.call(cb) === '[object Function]') {\r\n      this.key.generateAsync(this.default_key_size, this.default_public_exponent, cb);\r\n      return;\r\n    }\r\n    // Generate the key.\r\n    this.key.generate(this.default_key_size, this.default_public_exponent);\r\n  }\r\n  return this.key;\r\n};\r\n\r\n/**\r\n * Returns the pem encoded representation of the private key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the private key WITH header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPrivateKey = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPrivateKey();\r\n};\r\n\r\n/**\r\n * Returns the pem encoded representation of the private key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the private key WITHOUT header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPrivateKeyB64 = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPrivateBaseKeyB64();\r\n};\r\n\r\n\r\n/**\r\n * Returns the pem encoded representation of the public key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the public key WITH header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPublicKey = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPublicKey();\r\n};\r\n\r\n/**\r\n * Returns the pem encoded representation of the public key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the public key WITHOUT header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPublicKeyB64 = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPublicBaseKeyB64();\r\n};\r\n\r\n","// export * from 'jsencrypt';\r\nexport * from '../../node_modules/jsencrypt/src/jsencrypt.js';","import {EventEmitter} from \"../deps/bp_event.js\";\r\n\r\nexport class BaseRequest {\r\n    constructor(data) {\r\n        this.data = data;\r\n        this.before = (data)=>{return Promise.resolve(data)};\r\n    }\r\n\r\n    send() {\r\n        return this.before(this.data);\r\n    }\r\n\r\n    before(fn) {\r\n        return Promise.resolve\r\n    }\r\n}\r\n\r\nexport class BaseTransport {\r\n    constructor(endpoint, stream_type, config={}) {\r\n        this.stream_type = stream_type;\r\n        this.endpoint = endpoint;\r\n        this.eventSource = new EventEmitter();\r\n        this.dataQueue = [];\r\n    }\r\n\r\n    static canTransfer(stream_type) {\r\n        return BaseTransport.streamTypes().includes(stream_type);\r\n    }\r\n    \r\n    static streamTypes() {\r\n        return [];\r\n    }\r\n\r\n    destroy() {\r\n        this.eventSource.destroy();\r\n    }\r\n\r\n    connect() {\r\n        // TO be impemented\r\n    }\r\n\r\n    disconnect() {\r\n        // TO be impemented\r\n    }\r\n\r\n    reconnect() {\r\n        return this.disconnect().then(()=>{\r\n            return this.connect();\r\n        });\r\n    }\r\n\r\n    setEndpoint(endpoint) {\r\n        this.endpoint = endpoint;\r\n        return this.reconnect();\r\n    }\r\n\r\n    send(data) {\r\n        // TO be impemented\r\n        // return this.prepare(data).send();\r\n    }\r\n\r\n    prepare(data) {\r\n        // TO be impemented\r\n        // return new Request(data);\r\n    }\r\n\r\n    // onData(type, data) {\r\n    //     this.eventSource.dispatchEvent(type, data);\r\n    // }\r\n}","export const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n\r\nexport const CPU_CORES = 1;//navigator.hardwareConcurrency || 3;","import {getTagged} from '../deps/bp_logger.js';\r\nimport {JSEncrypt} from '../deps/jsencrypt.js';\r\nimport {BaseTransport} from \"../core/base_transport.js\";\r\nimport {CPU_CORES} from \"../core/util/browser.js\";\r\n\r\nconst LOG_TAG = \"transport:ws\";\r\nconst Log = getTagged(LOG_TAG);\r\nconst WORKER_COUNT = CPU_CORES;\r\n\r\nexport default class WebsocketTransport extends BaseTransport {\r\n    constructor(endpoint, stream_type, options={\r\n        socket:`${location.protocol.replace('http', 'ws')}//${location.host}/ws/`,\r\n        workers: 1\r\n    }) {\r\n        super(endpoint, stream_type);\r\n        this.proxies = [];\r\n        this.currentProxy = 0;\r\n        this.workers = 1;\r\n        this.socket_url = options.socket;\r\n        this.ready = this.connect();\r\n    }\r\n\r\n    destroy() {\r\n        return this.disconnect().then(()=>{\r\n            return super.destroy();\r\n        });\r\n\r\n    }\r\n\r\n    static canTransfer(stream_type) {\r\n        return WebsocketTransport.streamTypes().includes(stream_type);\r\n    }\r\n\r\n    static streamTypes() {\r\n        return ['hls', 'rtsp'];\r\n    }\r\n\r\n    connect() {\r\n        return this.disconnect().then(()=>{\r\n            let promises = [];\r\n            // TODO: get mirror list\r\n            for (let i=0; i<this.workers; ++i) {\r\n                let proxy = new WebSocketProxy(this.socket_url, this.endpoint, this.stream_type);\r\n\r\n                proxy.set_disconnect_handler((e)=> {\r\n                    this.eventSource.dispatchEvent('disconnected', {code: e.code, reason: e.reason});\r\n                    // TODO: only reconnect on demand\r\n                    if ([1000, 1006, 1013, 1011].includes(e.code)) {\r\n                        setTimeout(()=> {\r\n                            if (this.ready && this.ready.reject) {\r\n                                this.ready.reject();\r\n                            }\r\n                            this.ready = this.connect();\r\n                        }, 3000);\r\n                    }\r\n                });\r\n\r\n                proxy.set_data_handler((data)=> {\r\n                    this.dataQueue.push(new Uint8Array(data));\r\n                    this.eventSource.dispatchEvent('data');\r\n                });\r\n\r\n                promises.push(proxy.connect().then(()=> {\r\n                    this.eventSource.dispatchEvent('connected');\r\n                }).catch((e)=> {\r\n                    this.eventSource.dispatchEvent('error');\r\n                    throw new Error(e);\r\n                }));\r\n                this.proxies.push(proxy);\r\n            }\r\n            return Promise.all(promises);\r\n        });\r\n    }\r\n\r\n    disconnect() {\r\n        let promises = [];\r\n        for (let i=0; i<this.proxies.length; ++i) {\r\n            promises.push(this.proxies[i].close());\r\n        }\r\n        this.proxies= [];\r\n        if (this.proxies.length) {\r\n            return Promise.all(promises);\r\n        } else {\r\n            return Promise.resolve();\r\n        }\r\n    }\r\n\r\n    socket() {\r\n        return this.proxies[(this.currentProxy++)%this.proxies.length];\r\n    }\r\n\r\n    send(_data, fn) {\r\n        let res = this.socket().send(_data);\r\n        if (fn) {\r\n            fn(res.seq);\r\n        }\r\n        return res.promise;\r\n    }\r\n}\r\n\r\nclass WSPProtocol {\r\n    static get PROTO() {return  'WSP';}\r\n\r\n    static get V1_1() {return '1.1';}\r\n\r\n    static get CMD_INIT() {return 'INIT';}\r\n    static get CMD_JOIN() {return  'JOIN';}\r\n    static get CMD_WRAP() {return  'WRAP';}\r\n\r\n\r\n    constructor(ver){\r\n        this.ver = ver;\r\n    }\r\n\r\n    build(cmd, data, payload=''){\r\n        let data_str='';\r\n        if (!data.seq) {\r\n            data.seq = ++WSPProtocol.seq;\r\n        }\r\n        for (let k in data) {\r\n            data_str += `${k}: ${data[k]}\\r\\n`;\r\n        }\r\n        return `${WSPProtocol.PROTO}/${this.ver} ${cmd}\\r\\n${data_str}\\r\\n${payload}`;\r\n    }\r\n\r\n    static parse(data) {\r\n        let payIdx = data.indexOf('\\r\\n\\r\\n');\r\n        let lines = data.substr(0, payIdx).split('\\r\\n');\r\n        let hdr = lines.shift().match(new RegExp(`${WSPProtocol.PROTO}/${WSPProtocol.V1_1}\\\\s+(\\\\d+)\\\\s+(.+)`));\r\n        if (hdr) {\r\n            let res = {\r\n                code: Number(hdr[1]),\r\n                msg:  hdr[2],\r\n                data: {},\r\n                payload: ''\r\n            };\r\n            while (lines.length) {\r\n                let line = lines.shift();\r\n                if (line) {\r\n                    let [k,v] = line.split(':');\r\n                    res.data[k.trim()] = v.trim();\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n            res.payload = data.substr(payIdx+4);\r\n            return res;\r\n        }\r\n        return null;\r\n    }\r\n}\r\nWSPProtocol.seq = 0;\r\n\r\nclass WebSocketProxy {\r\n    static get CHN_CONTROL() {return 'control';}\r\n    static get CHN_DATA() {return  'data';}\r\n\r\n    constructor(wsurl, endpoint, stream_type) {\r\n        this.url = wsurl;\r\n        this.stream_type = stream_type;\r\n        this.endpoint = endpoint;\r\n        this.data_handler = ()=>{};\r\n        this.disconnect_handler = ()=>{};\r\n        this.builder = new WSPProtocol(WSPProtocol.V1_1);\r\n        this.awaitingPromises = {};\r\n        this.seq = 0;\r\n        this.encryptor = new JSEncrypt();\r\n    }\r\n\r\n    set_data_handler(handler) {\r\n        this.data_handler = handler;\r\n    }\r\n\r\n    set_disconnect_handler(handler) {\r\n        this.disconnect_handler = handler;\r\n    }\r\n\r\n    close() {\r\n        Log.log('closing connection');\r\n        return new Promise((resolve)=>{\r\n            this.ctrlChannel.onclose = ()=>{\r\n                if (this.dataChannel) {\r\n                    this.dataChannel.onclose = ()=>{\r\n                        Log.log('closed');\r\n                        resolve();\r\n                    };\r\n                    this.dataChannel.close();\r\n                } else {\r\n                    Log.log('closed');\r\n                    resolve();\r\n                }\r\n            };\r\n            this.ctrlChannel.close();\r\n        });\r\n    }\r\n\r\n    onDisconnect(){\r\n        this.ctrlChannel.onclose=null;\r\n        this.ctrlChannel.close();\r\n        if (this.dataChannel) {\r\n            this.dataChannel.onclose = null;\r\n            this.dataChannel.close();\r\n        }\r\n        this.disconnect_handler(this);\r\n    }\r\n\r\n    initDataChannel(channel_id) {\r\n        return new Promise((resolve, reject)=>{\r\n            this.dataChannel = new WebSocket(this.url + WebSocketProxy.CHN_DATA);\r\n            this.dataChannel.binaryType = 'arraybuffer';\r\n            this.dataChannel.onopen = ()=>{\r\n                let msg = this.builder.build(WSPProtocol.CMD_JOIN, {\r\n                    channel: channel_id\r\n                });\r\n                Log.debug(msg);\r\n                this.dataChannel.send(msg);\r\n            };\r\n            this.dataChannel.onmessage = (ev)=>{\r\n                Log.debug(`[data]\\r\\n${ev.data}`);\r\n                let res = WSPProtocol.parse(ev.data);\r\n                if (!res) {\r\n                    return reject();\r\n                }\r\n\r\n                this.dataChannel.onmessage=(e)=>{\r\n                    // Log.debug('got data');\r\n                    if (this.data_handler) {\r\n                        this.data_handler(e.data);\r\n                    }\r\n                };\r\n                resolve();\r\n            };\r\n            this.dataChannel.onerror = (e)=>{\r\n                Log.error(`[data] ${e.type}`);\r\n                this.dataChannel.close();\r\n            };\r\n            this.dataChannel.onclose = (e)=>{\r\n                Log.error(`[data] ${e.type}. code: ${e.code}, reason: ${e.reason || 'unknown reason'}`);\r\n                this.onDisconnect(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    connect() {\r\n        this.encryptionKey = null;\r\n        return new Promise((resolve, reject)=>{\r\n            this.ctrlChannel = new WebSocket(this.url + WebSocketProxy.CHN_CONTROL);\r\n\r\n            this.connected = false;\r\n\r\n            this.ctrlChannel.onopen = ()=>{\r\n                let headers = {\r\n                    proto: this.stream_type\r\n                };\r\n                if (this.endpoint.socket) {\r\n                    headers.socket = this.endpoint.socket;\r\n                } else {\r\n                    Object.assign(headers, {\r\n                        host:  this.endpoint.host,\r\n                        port:  this.endpoint.port\r\n                    })\r\n                }\r\n                let msg = this.builder.build(WSPProtocol.CMD_INIT, headers);\r\n                Log.debug(msg);\r\n                this.ctrlChannel.send(msg);\r\n            };\r\n\r\n            this.ctrlChannel.onmessage = (ev)=>{\r\n                Log.debug(`[ctrl]\\r\\n${ev.data}`);\r\n\r\n                let res = WSPProtocol.parse(ev.data);\r\n                if (!res) {\r\n                    return reject();\r\n                }\r\n\r\n                if (res.code >= 300) {\r\n                    Log.error(`[ctrl]\\r\\n${res.code}: ${res.msg}`);\r\n                    return reject();\r\n                }\r\n                this.ctrlChannel.onmessage = (e)=> {\r\n                    let res = WSPProtocol.parse(e.data);\r\n                    Log.debug(`[ctrl]\\r\\n${e.data}`);\r\n                    if (res.data.seq in this.awaitingPromises) {\r\n                        if (res.code < 300) {\r\n                            this.awaitingPromises[res.data.seq].resolve(res);\r\n                        } else {\r\n                            this.awaitingPromises[res.data.seq].reject(res);\r\n                        }\r\n                        delete this.awaitingPromises[res.data.seq];\r\n                    }\r\n                };\r\n                this.encryptionKey = res.data.pubkey || null;\r\n                if (this.encryptionKey) {\r\n                    this.encryptor.setPublicKey(this.encryptionKey);\r\n                    // TODO: check errors\r\n                }\r\n                this.initDataChannel(res.data.channel).then(resolve).catch(reject);\r\n            };\r\n\r\n            this.ctrlChannel.onerror = (e)=>{\r\n                Log.error(`[ctrl] ${e.type}`);\r\n                this.ctrlChannel.close();\r\n            };\r\n            this.ctrlChannel.onclose = (e)=>{\r\n                Log.error(`[ctrl] ${e.type}. code: ${e.code} ${e.reason || 'unknown reason'}`);\r\n                this.onDisconnect(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    encrypt(msg) {\r\n        if (this.encryptionKey) {\r\n            let crypted = this.encryptor.encrypt(msg);\r\n            if (crypted === false) {\r\n                throw new Error(\"Encryption failed. Stopping\")\r\n            }\r\n            return crypted;\r\n        }\r\n        return msg;\r\n    }\r\n\r\n    send(payload) {\r\n        if (this.ctrlChannel.readyState != WebSocket.OPEN) {\r\n            this.close();\r\n            // .then(this.connect.bind(this));\r\n            // return;\r\n            throw new Error('disconnected');\r\n        }\r\n        // Log.debug(payload);\r\n        let data = {\r\n            contentLength: payload.length,\r\n            seq: ++WSPProtocol.seq\r\n        };\r\n        return {\r\n            seq:data.seq,\r\n            promise: new Promise((resolve, reject)=>{\r\n                this.awaitingPromises[data.seq] = {resolve, reject};\r\n                let msg = this.builder.build(WSPProtocol.CMD_WRAP, data, payload);\r\n                Log.debug(msg);\r\n                this.ctrlChannel.send(this.encrypt(msg));\r\n            })};\r\n    }\r\n}","import {getTagged} from './deps/bp_logger.js';\r\nimport {Url} from './core/util/url.js';\r\nimport {Remuxer} from './core/remuxer/remuxer.js';\r\nimport DEFAULT_CLIENT from './client/rtsp/client.js';\r\nimport DEFAULT_TRANSPORT from './transport/websocket.js';\r\n\r\nconst Log = getTagged('wsp');\r\n\r\nexport class StreamType {\r\n    static get HLS() {return 'hls';}\r\n    static get RTSP() {return 'rtsp';}\r\n\r\n    static isSupported(type) {\r\n        return [StreamType.HLS, StreamType.RTSP].includes(type);\r\n    }\r\n\r\n    static fromUrl(url) {\r\n        let parsed;\r\n        try {\r\n            parsed = Url.parse(url);\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n        switch (parsed.protocol) {\r\n            case 'rtsp':\r\n                return StreamType.RTSP;\r\n            case 'http':\r\n            case 'https':\r\n                if (url.indexOf('.m3u8')>=0) {\r\n                    return StreamType.HLS;\r\n                } else {\r\n                    return null;\r\n                }\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    static fromMime(mime) {\r\n        switch (mime) {\r\n            case 'application/x-rtsp':\r\n                return StreamType.RTSP;\r\n            case 'application/vnd.apple.mpegurl':\r\n            case 'application/x-mpegurl':\r\n                return StreamType.HLS;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n}\r\n\r\nexport class WSPlayer {\r\n\r\n    constructor(node, opts) {\r\n        if (typeof node == typeof '') {\r\n            this.player = document.getElementById(node);\r\n        } else {\r\n            this.player = node;\r\n        }\r\n\r\n        let modules = opts.modules || {\r\n            client: DEFAULT_CLIENT,\r\n            transport: {\r\n                constructor: DEFAULT_TRANSPORT\r\n            }\r\n        };\r\n        this.errorHandler = opts.errorHandler || null;\r\n        this.queryCredentials = opts.queryCredentials || null;\r\n\r\n        this.modules = {};\r\n        for (let module of modules) {\r\n            let transport = module.transport || DEFAULT_TRANSPORT;\r\n            let client = module.client || DEFAULT_CLIENT;\r\n            if (transport.constructor.canTransfer(client.streamType())) {\r\n                this.modules[client.streamType()] = {\r\n                    client: client,\r\n                    transport: transport\r\n                }\r\n            } else {\r\n                Log.warn(`Client stream type ${client.streamType()} is incompatible with transport types [${transport.streamTypes().join(', ')}]. Skip`)\r\n            }\r\n        }\r\n\r\n        this.type = StreamType.RTSP;\r\n        this.url = null;\r\n        if (opts.url && opts.type) {\r\n            this.url = opts.url;\r\n            this.type = opts.type;\r\n        } else {\r\n            if (!this._checkSource(this.player)) {\r\n                for (let i=0; i<this.player.children.length; ++i) {\r\n                    if (this._checkSource(this.player.children[i])) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            // if (!this.url) {\r\n            //      throw new Error('No playable endpoint found');\r\n            // }\r\n        }\r\n\r\n        if (this.url) {\r\n            this.setSource(this.url, this.type);\r\n        }\r\n\r\n        this.player.addEventListener('play', ()=>{\r\n            if (!this.isPlaying()) {\r\n                this.client.start();\r\n            }\r\n        }, false);\r\n\r\n        this.player.addEventListener('pause', ()=>{\r\n            this.client.stop();\r\n        }, false);\r\n\r\n        this.player.addEventListener('abort', () => {\r\n            // disconnect the transport when the player is closed\r\n            this.client.stop();\r\n            this.transport.disconnect().then(() => {\r\n                this.client.destroy();\r\n            });\r\n        }, false);\r\n    }\r\n\r\n    // TODO: check native support\r\n\r\n    isPlaying() {\r\n        return !(this.player.paused || this.client.paused);\r\n    }\r\n\r\n    static canPlayWithModules(mimeType, modules) {\r\n\r\n        let filteredModules = {};\r\n        for (let module of modules) {\r\n            let transport = module.transport || DEFAULT_TRANSPORT;\r\n            let client = module.client || DEFAULT_CLIENT;\r\n            if (transport.canTransfer(client.streamType())) {\r\n                filteredModules[client.streamType()] = true;\r\n            }\r\n        }\r\n\r\n        for (let type in filteredModules) {\r\n            if (type == StreamType.fromMime(mimeType)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /// TODO: deprecate it?\r\n    static canPlay(resource) {\r\n        return StreamType.fromMime(resource.type) || StreamType.fromUrl(resource.src);\r\n    }\r\n\r\n    canPlayUrl(src) {\r\n        let type = StreamType.fromUrl(src);\r\n        return (type in this.modules);\r\n    }\r\n\r\n    _checkSource(src) {\r\n        if (!src.dataset['ignore'] && src.src && !this.player.canPlayType(src.type) && (StreamType.fromMime(src.type) || StreamType.fromUrl(src.src))) {\r\n            this.url = src.src;\r\n            this.type = src.type ? StreamType.fromMime(src.type) : StreamType.fromUrl(src.src);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async setSource(url, type) {\r\n        if (this.transport) {\r\n            if (this.client) {\r\n                await this.client.detachTransport();\r\n            }\r\n            await this.transport.destroy();\r\n        }\r\n        try {\r\n            this.endpoint = Url.parse(url);\r\n        } catch (e) {\r\n            return;\r\n        }\r\n        this.url = url;\r\n        let transport = this.modules[type].transport;\r\n        this.transport = new transport.constructor(this.endpoint, this.type, transport.options);\r\n\r\n\r\n        let lastType = this.type;\r\n        this.type = (StreamType.isSupported(type)?type:false) || StreamType.fromMime(type);\r\n        if (!this.type) {\r\n            throw new Error(\"Bad stream type\");\r\n        }\r\n\r\n        if (lastType!=this.type || !this.client) {\r\n            if (this.client) {\r\n                await this.client.destroy();\r\n            }\r\n            let client = this.modules[type].client;\r\n            this.client = new client();\r\n        } else {\r\n            this.client.reset();\r\n        }\r\n\r\n        if (this.queryCredentials) {\r\n            this.client.queryCredentials = this.queryCredentials;\r\n        }\r\n        if (this.remuxer) {\r\n            this.remuxer.destroy();\r\n            this.remuxer = null;\r\n        }\r\n        this.remuxer = new Remuxer(this.player);\r\n        this.remuxer.attachClient(this.client);\r\n\r\n        this.client.attachTransport(this.transport);\r\n        this.client.setSource(this.endpoint);\r\n\r\n        if (this.player.autoplay) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    start() {\r\n        if (this.client) {\r\n            this.client.start().catch((e)=>{\r\n                if (this.errorHandler) {\r\n                    this.errorHandler(e);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        if (this.client) {\r\n            this.client.stop();\r\n        }\r\n    }\r\n\r\n    async destroy() {\r\n        if (this.transport) {\r\n            if (this.client) {\r\n                await this.client.detachTransport();\r\n            }\r\n            await this.transport.destroy();\r\n        }\r\n        if (this.client) {\r\n            await this.client.destroy();\r\n        }\r\n        if (this.remuxer) {\r\n            this.remuxer.destroy();\r\n            this.remuxer = null;\r\n        }\r\n    }\r\n\r\n}\r\n","import {LogLevel, getTagged, setDefaultLogLevel} from 'bp_logger';\nimport * as streamedian from 'streamedian/player.js';\nimport WebsocketTransport from 'streamedian/transport/websocket.js';\nimport RTSPClient from 'streamedian/client/rtsp/client.js';\nimport {isSafari} from \"streamedian/core/util/browser.js\";\n\n\nsetDefaultLogLevel(LogLevel.Error);\n\n\nwindow.Streamedian = {\n    logger(tag) {\n        return getTagged(tag)\n    },\n    player(node, opts) {\n        if (!opts.socket) {\n            throw new Error(\"socket parameter is not set\");\n        }\n        let _options = {\n            modules: [\n                {\n                    client: RTSPClient,\n                    transport: {\n                        constructor: WebsocketTransport,\n                        options: {\n                            socket: opts.socket\n                        }\n                    }\n                }\n            ],\n            errorHandler(e) {\n                alert(`Failed to start player: ${e.message}`);\n            },\n            queryCredentials(client) {\n                return new Promise((resolve, reject) => {\n                    let c = prompt('input credentials in format user:password');\n                    if (c) {\n                        client.setCredentials.apply(client, c.split(':'));\n                        resolve();\n                    } else {\n                        reject();\n                    }\n                });\n            }\n        };\n        return new streamedian.WSPlayer(node, _options);\n    }\n};"],"names":["LogLevel","Error","Warn","Log","Debug","DEFAULT_LOG_LEVEL","setDefaultLogLevel","level","Logger","tag","setLevel","lvl","args","Array","prototype","slice","call","unshift","console","level_map","apply","_log","arguments","taggedLoggers","Map","getTagged","has","set","get","Url","url","ret","regex","result","exec","full","protocol","urlpath","parts","split","basename","pop","basepath","join","loginSplit","hostport","userpass","length","user","pass","host","auth","port","protocolDefaultPort","portDefined","location","socket","undefined","parsed","test","listener","Symbol","listeners","DestructibleEventListener","eventListener","entry","fn","removeEventListener","clear","event","selector","addEventListener","e","target","matches","Set","add","ev","delete","size","dispatchEvent","EventEmitter","element","document","createElement","destroy","on","data","CustomEvent","detail","EventSourceWrapper","eventSource","MP4","types","avc1","avcC","btrt","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","sdtp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","i","hasOwnProperty","charCodeAt","videoHdlr","Uint8Array","audioHdlr","HDLR_TYPES","STTS","STSC","STCO","STSZ","VMHD","SMHD","STSD","majorBrand","avc1Brand","minorVersion","FTYP","box","DINF","type","payload","len","byteLength","timescale","duration","track","sequenceNumber","sn","baseMediaDecodeTime","tracks","boxes","concat","bytes","samples","flags","dependsOn","isDependedOn","hasRedundancy","sps","pps","push","avcc","width","height","configlen","config","audiosamplerate","channelCount","id","volume","sampleDependencyTable","offset","arraylen","array","sample","cts","isLeading","paddingValue","isNonSync","degradPrio","init","movie","LOG_TAG","MSEBuffer","parent","codec","mediaSource","players","cleaning","queue","cleanResolvers","cleanRanges","debug","sourceBuffer","addSourceBuffer","buffered","currentTime","start","resolver","shift","doCleanup","feedNext","readyState","sourceBuffers","removeSourceBuffer","updating","promises","Promise","resolve","reject","remove","end","onupdateend","all","is_live","doAppend","range","removeBound","removeStart","removeEnd","err","error","MSE","ErrorNotes","code","forEach","video","stop","endOfStream","appendBuffer","name","initCleanup","message","codecs","window","MediaSource","isTypeSupported","MediaError","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","playing","map","idx","onplaying","onpause","paused","reset","play","buffers","setLive","pause","values","buffer","then","clearLiveSeekableRange","src","URL","createObjectURL","setupEvents","resolved","mediaReady","_sourceOpen","_sourceEnded","_sourceClose","ready","mimeCodec","feed","track_id","BaseRemuxer","scaleFactor","params","timeOffset","readyToDecode","seq","tsAlign","timestamp","unit","pts","dts","initPTS","initDTS","shouldInitialize","Math","min","unscaled","initialized","mp4track","sampleFunction","setupSample","sort","dtsSortFunc","a","b","gop","groupBy","xs","key","reduce","rv","x","AACRemuxer","codecstring","CODEC_AAC","units","nextAacPts","lastPts","firstDTS","firstPTS","getTrackID","fragmented","setConfig","channels","samplerate","MP4_TIMESCALE","expectedSampleDuration","aac","getSize","mp4Sample","lastDTS","nextDts","delta","round","scaled","abs","log","max","getData","ExpGolomb","bytesAvailable","word","bitsAvailable","position","workingBytes","availableBytes","subarray","DataView","byteOffset","getUint32","count","skipBytes","loadWord","bits","valu","logger","readBits","leadingZeroCount","skipLZ","skipBits","clz","readUEG","appendByteArray","buffer1","buffer2","tmp","base64ToArrayBuffer","base64","binary_string","atob","hexToByteArray","hex","bufView","parseInt","substr","bitSlice","bytearray","byteLen","ceil","res","startByte","endByte","bitOffset","nBitOffset","endOffset","tail","BitArray","bitpos","byte","getUint8","bytepos","finished","NALU","nalu","ntype","TYPES","IDR","SEI","SPS","PPS","NDR","nri","sliceType","idata","getNri","header","view","setUint32","setUint8","H264Parser","remuxer","firstFound","readSPS","codecarray","h","toString","parceSliceHeader","isKeyframe","parsePPS","parseSPS","byte_idx","pay_type","pay_size","sz","uuid","from","EOSEQ","EOSTR","decoder","first_mb","slice_type","ppsid","frame_num","readUByte","lastScale","nextScale","deltaScale","j","readEG","frameCropLeftOffset","frameCropRightOffset","frameCropTopOffset","frameCropBottomOffset","sarScale","profileIdc","profileCompat","levelIdc","numRefFramesInPicOrderCntCycle","picWidthInMbsMinus1","picHeightInMapUnitsMinus1","frameMbsOnlyFlag","scalingListCount","skipUEG","chromaFormatIdc","readBoolean","skipScalingList","picOrderCntType","skipEG","sarRatio","aspectRatioIdc","unitsInTick","readUInt","timeScale","fixedFrameRate","frameDuration","H264Remuxer","lastSampleDuration","lastDurations","lastGopDTS","firstUnit","h264","arr","setSPS","warn","setPPS","groupedGop","groupByDts","Object","group","preUnit","curUnit","naluData","appendData","_get","parseNAL","getPayloadBase","sampleDuration","toMS","avgDuration","navigator","userAgent","toLowerCase","indexOf","StreamType","VIDEO","AUDIO","PayloadType","H264","AAC","Remuxer","mediaElement","mse","mseEventSource","mse_ready","errorListener","mseClose","bind","closeListener","errorDecodeListener","mseErrorDecode","initSegments","streams","enabled","initMSEHandlers","detachClient","TrackConverters","TrackTimescale","TrackScaleFactor","client","seekable","initmse","initPts","Infinity","initDts","track_type","isSupported","initSegment","initMSE","setCodec","onSamples","keys","pay","getPayload","flush","qidx","sampleQueues","chunk","remux","clientEventSource","samplesListener","audioConfigListener","onTracks","State","stateMachine","transitions","StateMachine","storage","currentState","states","activate","finishTransition","deactivate","state","fromName","toName","ReferenceError","promise","stateName","_promisify","catch","failHandler","SDPParser","version","origin","sessionName","timing","sessionBlock","media","mediaMap","content","dataString","success","currentMediaBlock","line","replace","charAt","_parseVersion","_parseOrigin","_parseSessionName","_parseTiming","rtpmap","_parseMediaDescription","_parseAttribute","match","username","sessionid","sessionversion","nettype","addresstype","unicastaddress","proto","fmt","index","mediaType","pt","m","separator","attribute","mode","Number","control","attrs","toUpperCase","clock","encparams","ptype","string_map","fmtp","param","trim","RTSPStream","rtpChannel","stopKeepAlive","keepaliveInterval","keepaliveTime","forgetRTPChannel","lastSetupPromise","obj","sendSetup","session","sendTeardown","sdp","getSessionBlock","isAbsolute","contentBase","ctrl","methods","includes","sendRequest","getSetupURL","clearInterval","setInterval","sendKeepalive","RTSPError","reconnect","_cmd","_params","assign","getControlURL","RTSPClient","STATE_SETUP","interleaveChannelIndex","interleavedChannels","Date","toUTCString","Session","_data","headers","transport","interleaved","sessionParamsChunks","sessionParams","kv","useRTPChannel","startKeepAlive","safeAdd","y","lsw","msw","bitRotateLeft","num","cnt","md5cmn","q","s","t","md5ff","c","d","md5gg","md5hh","md5ii","binlMD5","olda","oldb","oldc","oldd","binl2rstr","input","output","length32","String","fromCharCode","rstr2binl","length8","rstrMD5","rstrHMACMD5","bkey","ipad","opad","hash","rstr2hex","hexTab","str2rstrUTF8","unescape","encodeURIComponent","rawMD5","hexMD5","rawHMACMD5","k","hexHMACMD5","md5","string","raw","RTP","pkt","padding","has_extension","csrc","marker","sequence","getUint16","ssrc","csrcs","pktIndex","extension","ehl","header_data","headerLength","padLength","getMediaBlockByPayloadType","RTPFactory","tsOffsets","last","overflow","rtp","tsOffset","RTSPMessage","_rtsp_version","_host","_payload","requestString","lines","body","statusLine","RegExp","lineIdx","v","MessageBuilder","RTSP_1_0","NALUAsm","fragmented_nalu","rawData","nal_start_idx","don","STAP_B","parseNALHeader","getInt8","parseSingleNALUPacket","fu_header","is_start","is_end","payload_type","FU_B","FU_A","parseFragmentationUnit","STAP_A","parseAggregationPacket","hdr","AACFrame","AACAsm","sizeLength","indexLength","indexDeltaLength","CTSDeltaLength","DTSDeltaLength","RandomAccessIndication","StreamStateIndication","AuxiliaryDataSizeLength","configHeaderLength","auHeadersLengthPadded","ts","getTimestampMS","auHeadersLengthInBits","frames","frameOffset","ctsPresent","dtsPresent","aacData","RTPPayloadParser","h264parser","RTPH264Parser","aacparser","RTPAACParser","parse","naluasm","onNALUFragment","scale","asm","conf","onAACFragment","BaseClient","options","defineProperties","sourceUrl","value","writable","connected","_onData","dataQueue","onData","_onConnect","onConnected","_onDisconnect","onDisconnected","detachTransport","source","endpoint","flushInterval","password","AACParser","bytesOrBits","prof","sfi","SampleRates","parseAudioSpecificConfig","RTSPSession","sessionId","sendPlay","STATE_PLAY","STATE_PLAYING","supports","STATE_PAUSE","STATE_PAUSED","STATE_TEARDOWN","clientSM","RTSPClientSM","ontracks","startStreamFlush","setSource","AuthError","msg","payParser","rtp_channels","sessions","addState","STATE_INITIAL","STATE_OPTIONS","sendOptions","onOptions","STATE_DESCRIBE","sendDescribe","onDescribe","onSetup","STATE_STREAMS","started","transitionTo","addTransition","shouldReconnect","rtpFactory","channel","onRTP","packet","sendPause","authenticator","rtpBuffer","stream","lastTimestamp","method","cSeq","CSeq","USER_AGENT","send","build","_method","response","substring","chunks","ep","queryCredentials","parsedChunks","ha1","realm","ha2","nonce","btoa","getMediaBlockList","lastPromise","getMediaBlock","setupPromise","rtp_info","val","sps_pps","has_config","generic","parseStreamMuxConfig","sessionPromises","hardLimit","ellipsis","DOM","tagName","className","text","str","createTextNode","Stream","enc","pos","hexDigits","hexByte","high_byte","low_byte","parseStringISO","reTime","n","unusedBit","lenBit","skip","ASN1","sub","tagClass","tagConstructed","tagNumber","posContent","reSeemsASCII","parseOctetString","parseInteger","parseBitString","parseOID","parseStringUTF","parseStringBMP","parseTime","typeName","indent","writeln","print","toPrettyString","node","asn1","head","innerHTML","preview","appendChild","oids","oid","w","toDOM","onclick","current","re","hexDump","root","hexNode","onmouseover","onmouseout","selected","fakeHover","fakeOut","toHexDOM_sub","posStart","posEnd","first","toHexDOM","decodeLength","buf","hasContent","p","subTag","subLength","exception","decode","streamStart","expected","write","Arcfour","S","ARC4init","ARC4next","next","prng_newstate","rng_psize","rng_state","rng_pool","rng_pptr","crypto","getRandomValues","z","Uint32Array","onMouseMoveListener","detachEvent","mouseCoordinates","attachEvent","rng_get_byte","random","floor","rng_get_bytes","ba","SecureRandom","nextBytes","dbits","BigInteger","fromNumber","fromString","nbi","am1","am2","xl","xh","l","am3","j_lm","appName","am","DB","DM","DV","BI_FP","FV","pow","F1","F2","BI_RM","BI_RC","rr","vv","int2char","intAt","bnpCopyTo","r","bnpFromInt","nbv","fromInt","bnpFromString","fromRadix","mi","sh","clamp","ZERO","subTo","bnpClamp","bnToString","negate","toRadix","km","bnNegate","bnAbs","bnCompareTo","nbits","bnBitLength","bnpDLShiftTo","bnpDRShiftTo","bnpLShiftTo","bs","cbs","bm","ds","bnpRShiftTo","bnpSubTo","bnpMultiplyTo","bnpSquareTo","bnpDivRemTo","pm","copyTo","ms","nsh","lShiftTo","ys","y0","yt","d1","d2","dlShiftTo","compareTo","ONE","qd","drShiftTo","rShiftTo","bnMod","divRemTo","Classic","cConvert","mod","cRevert","cReduce","cMulTo","multiplyTo","cSqrTo","squareTo","convert","revert","mulTo","sqrTo","bnpInvDigit","Montgomery","mp","invDigit","mpl","mph","um","mt2","montConvert","montRevert","montReduce","u0","montSqrTo","montMulTo","bnpIsEven","bnpExp","r2","g","bnModPowInt","isEven","exp","bitLength","modPowInt","bnClone","bnIntValue","bnByteValue","bnShortValue","bnpChunkSize","LN2","bnSigNum","bnpToRadix","signum","cs","chunkSize","intValue","bnpFromRadix","dMultiply","dAddOffset","bnpFromNumber","testBit","bitwiseTo","shiftLeft","op_or","isProbablePrime","bnToByteArray","bnEquals","bnMin","bnMax","bnpBitwiseTo","op","f","op_and","bnAnd","bnOr","op_xor","bnXor","op_andnot","bnAndNot","bnNot","bnShiftLeft","bnShiftRight","lbit","bnGetLowestSetBit","cbit","bnBitCount","bnTestBit","bnpChangeBit","bnSetBit","changeBit","bnClearBit","bnFlipBit","bnpAddTo","bnAdd","addTo","bnSubtract","bnMultiply","bnSquare","bnDivide","bnRemainder","bnDivideAndRemainder","bnpDMultiply","bnpDAddOffset","NullExp","nNop","nMulTo","nSqrTo","bnPow","bnpMultiplyLowerTo","bnpMultiplyUpperTo","Barrett","q3","mu","divide","barrettConvert","barrettRevert","barrettReduce","multiplyUpperTo","multiplyLowerTo","barrettSqrTo","barrettMulTo","bnModPow","k1","g2","is1","bnGCD","clone","getLowestSetBit","bnpModInt","bnModInverse","ac","u","subtract","lowprimes","lplim","bnIsProbablePrime","modInt","millerRabin","bnpMillerRabin","n1","shiftRight","modPow","byteValue","shortValue","toByteArray","equals","and","or","xor","andNot","not","bitCount","setBit","clearBit","flipBit","multiply","remainder","divideAndRemainder","modInverse","gcd","square","parseBigInt","pkcs1pad2","rng","RSAKey","dmp1","dmq1","coeff","RSASetPublic","N","E","RSADoPublic","RSAEncrypt","doPublic","setPublic","encrypt","pkcs1unpad2","RSASetPrivate","D","RSASetPrivateEx","P","Q","DP","DQ","C","RSAGenerate","B","qs","ee","p1","q1","phi","RSADoPrivate","xp","xq","RSADecrypt","ctext","doPrivate","setPrivate","setPrivateEx","generate","decrypt","Base64","b64","ignore","out","char_count","unarmor","Hex","JSX","env","L","OP","FUNCTION_TOSTRING","ADD","parseUA","agent","numberify","parseFloat","nav","o","ie","opera","gecko","webkit","chrome","mobile","air","iphone","ipod","ios","android","webos","caja","cajaVersion","secure","os","ua","loc","href","isFunction","_IEEnumFix","fname","extend","subc","superc","overrides","F","constructor","superclass","KJUR","ASN1Util","integerToByteHex","bigIntToMinTwosComplementsHex","bigIntegerValue","hPos","xorLen","hMask","biMask","biNeg","getPEMStringFromHex","dataHex","pemHeader","dataWA","CryptoJS","dataB64","stringify","pemBody","ASN1Object","hV","getLengthHexFromValue","hN","hNlen","getEncodedHex","hTLV","isModified","getFreshValueHex","hL","hT","getValueHex","DERAbstractString","getString","setString","newS","stohex","setStringHex","newHexString","DERAbstractTime","localDateToUTC","utc","getTime","getTimezoneOffset","utcDate","formatDate","dateObject","pad","zeroPadding","year","getFullYear","month","getMonth","day","getDate","hour","getHours","getMinutes","sec","getSeconds","setByDateValue","UTC","setByDate","DERAbstractStructured","setByASN1ObjectArray","asn1ObjectArray","asn1Array","appendASN1Object","asn1Object","DERBoolean","DERInteger","setByBigInteger","setByInteger","bi","setValueHex","DERBitString","setHexValueIncludingUnusedBits","newHexStringIncludingUnusedBits","setUnusedBitsAndHexValue","unusedBits","hValue","hUnusedBits","setByBinaryString","binaryString","setByBooleanArray","booleanArray","newFalseArray","nLength","DEROctetString","DERNull","DERObjectIdentifier","itox","roidtox","roid","padLen","bPad","b8","setValueOidString","oidString","i0","splice","setValueName","oidName","x509","OID","name2oidList","DERUTF8String","DERNumericString","DERPrintableString","DERTeletexString","DERIA5String","DERUTCTime","date","DERGeneralizedTime","DERSequence","asn1Obj","DERSet","DERTaggedObject","isExplicit","setASN1Object","isExplicitFlag","tagNoHex","b64map","b64pad","hex2b64","b64tohex","slop","getHexStringValue","hexString","toHexString","parseKey","pem","modulus","public_exponent","reHex","der","private_exponent","prime1","prime2","exponent1","exponent2","coefficient","bit_string","ex","getPrivateBaseKey","getPrivateBaseKeyB64","getPublicBaseKey","first_sequence","second_sequence","getPublicBaseKeyB64","wordwrap","getPrivateKey","getPublicKey","hasPublicKeyProperty","hasPrivateKeyProperty","parsePropertiesFrom","JSEncryptRSAKey","JSEncrypt","default_key_size","default_public_exponent","setKey","setPrivateKey","privkey","setPublicKey","pubkey","getKey","cb","generateAsync","getPrivateKeyB64","getPublicKeyB64","BaseRequest","before","BaseTransport","stream_type","disconnect","connect","streamTypes","isSafari","WebsocketTransport","workers","proxies","currentProxy","socket_url","proxy","WebSocketProxy","set_disconnect_handler","reason","setTimeout","set_data_handler","close","WSPProtocol","ver","cmd","data_str","PROTO","payIdx","V1_1","wsurl","data_handler","disconnect_handler","builder","awaitingPromises","encryptor","handler","ctrlChannel","onclose","dataChannel","channel_id","WebSocket","CHN_DATA","binaryType","onopen","CMD_JOIN","onmessage","onerror","onDisconnect","encryptionKey","CHN_CONTROL","CMD_INIT","initDataChannel","crypted","OPEN","contentLength","CMD_WRAP","HLS","RTSP","mime","WSPlayer","opts","player","getElementById","modules","DEFAULT_CLIENT","DEFAULT_TRANSPORT","errorHandler","module","canTransfer","streamType","_checkSource","children","isPlaying","fromUrl","dataset","canPlayType","fromMime","lastType","attachClient","attachTransport","autoplay","mimeType","filteredModules","resource","Streamedian","_options","alert","prompt","setCredentials","streamedian"],"mappings":"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"}